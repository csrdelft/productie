{"remainingRequest":"/home/travis/build/csrdelft/csrdelft.nl/node_modules/babel-loader/lib/index.js??ref--1-1!/home/travis/build/csrdelft/csrdelft.nl/node_modules/eslint-loader/index.js!/home/travis/build/csrdelft/csrdelft.nl/resources/assets/js/forum.js","dependencies":[{"path":"/home/travis/build/csrdelft/csrdelft.nl/resources/assets/js/forum.js","mtime":1545951539341},{"path":"/home/travis/build/csrdelft/csrdelft.nl/node_modules/cache-loader/dist/cjs.js","mtime":1545951596970},{"path":"/home/travis/build/csrdelft/csrdelft.nl/node_modules/babel-loader/lib/index.js","mtime":1545951596898},{"path":"/home/travis/build/csrdelft/csrdelft.nl/node_modules/eslint-loader/index.js","mtime":1545951596454}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.saveConceptForumBericht = saveConceptForumBericht;\nexports.forumBewerken = forumBewerken;\n\nvar _jquery = require('jquery');\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _bbcode = require('./bbcode');\n\nvar _context = require('./context');\n\nvar _bbcodeSet = require('./bbcode-set');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction toggleForumConceptBtn(enable) {\n\tvar $concept = (0, _jquery2.default)('#forumConcept');\n\tif (typeof enable === 'undefined') {\n\t\t$concept.attr('disabled', !$concept.prop('disabled'));\n\t} else {\n\t\t$concept.attr('disabled', !enable);\n\t}\n}\n\nfunction saveConceptForumBericht() {\n\ttoggleForumConceptBtn(false);\n\tvar $concept = (0, _jquery2.default)('#forumConcept');\n\tvar $textarea = (0, _jquery2.default)('#forumBericht');\n\tvar $titel = (0, _jquery2.default)('#nieuweTitel');\n\tif ($textarea.val() !== $textarea.attr('origvalue')) {\n\t\t_jquery2.default.post($concept.attr('data-url'), {\n\t\t\tforumBericht: $textarea.val(),\n\t\t\ttitel: $titel.length === 1 ? $titel.val() : ''\n\t\t}).done(function () {\n\t\t\t$textarea.attr('origvalue', $textarea.val());\n\t\t}).fail(function (error) {\n\t\t\talert(error);\n\t\t});\n\t}\n\tsetTimeout(toggleForumConceptBtn, 3000);\n}\n\nvar bewerkContainer = null;\nvar bewerkContainerInnerHTML = null;\n\n/**\n * @see inline in forumBewerken\n */\nfunction restorePost() {\n\tbewerkContainer.html(bewerkContainerInnerHTML);\n\t(0, _jquery2.default)('#bewerk-melding').slideUp(200, function () {\n\t\t(0, _jquery2.default)(this).remove();\n\t});\n\t(0, _jquery2.default)('#forumPosten').css('visibility', 'visible');\n}\n\nfunction submitPost(event) {\n\tevent.preventDefault();\n\tvar form = (0, _jquery2.default)('#forumEditForm');\n\t_jquery2.default.ajax({\n\t\ttype: 'POST',\n\t\tcache: false,\n\t\turl: form.attr('action'),\n\t\tdata: form.serialize()\n\t}).done(function (data) {\n\t\trestorePost();\n\t\t(0, _context.domUpdate)(data);\n\t}).fail(function (jqXHR) {\n\t\treturn alert(jqXHR.responseJSON);\n\t});\n}\n\n/**\n * Een post bewerken in het forum.\n * Haal een post op, bouw een formuliertje met javascript.\n *\n * @see blade_templates/forum/partial/post_lijst.blade.php\n */\nfunction forumBewerken(postId) {\n\t_jquery2.default.ajax({\n\t\turl: '/forum/tekst/' + postId,\n\t\tmethod: 'POST'\n\t}).done(function (data) {\n\t\tif (document.getElementById('forumEditForm')) {\n\t\t\trestorePost();\n\t\t}\n\t\tbewerkContainer = (0, _jquery2.default)('#post' + postId);\n\t\tbewerkContainerInnerHTML = bewerkContainer.html();\n\t\tvar bewerkForm = '<form id=\"forumEditForm\" class=\"Formulier\" action=\"/forum/bewerken/' + postId + '\" method=\"post\">' + '<div id=\"bewerkPreview\" class=\"preview forumBericht\"></div>' + '<textarea name=\"forumBericht\" id=\"forumBewerkBericht\" class=\"FormElement BBCodeField\" rows=\"8\"></textarea>' + 'Reden van bewerking: <input type=\"text\" name=\"reden\" id=\"forumBewerkReden\"/><br /><br />' + '<div class=\"float-right\"><a href=\"/wiki/cie:diensten:forum\" target=\"_blank\">Opmaakhulp</a></div>' + '<input type=\"submit\" class=\"opslaan\" value=\"Opslaan\" /> ' + '<input type=\"button\" class=\"voorbeeld\" value=\"Voorbeeld\" /> ' + '<input type=\"button\" class=\"annuleren\" value=\"Annuleren\" /> ' + '</form>';\n\t\tbewerkContainer.html(bewerkForm);\n\t\tbewerkContainer.find('form').on('submit', submitPost);\n\t\tbewerkContainer.find('input.voorbeeld').on('click', _bbcode.CsrBBPreview.bind(null, 'forumBewerkBericht', 'bewerkPreview'));\n\t\tbewerkContainer.find('input.annuleren').on('click', restorePost);\n\n\t\tvar $forumBewerkBericht = (0, _jquery2.default)('#forumBewerkBericht');\n\t\t$forumBewerkBericht.val(data);\n\t\t$forumBewerkBericht.autosize();\n\t\t$forumBewerkBericht.markItUp(_bbcodeSet.bbCodeSet);\n\t\t(0, _jquery2.default)(bewerkContainer).parent().children('td.auteur:first').append('<div id=\"bewerk-melding\" class=\"alert alert-warning\">Als u dingen aanpast zet er dan even bij w&aacute;t u aanpast! Gebruik bijvoorbeeld [s]...[/s]</div>');\n\t\t(0, _jquery2.default)('#bewerk-melding').slideDown(200);\n\t\t(0, _jquery2.default)('#forumPosten').css('visibility', 'hidden');\n\t});\n\treturn false;\n}\n\nfunction forumCiteren(postId) {\n\t_jquery2.default.ajax({\n\t\turl: '/forum/citeren/' + postId,\n\t\tmethod: 'POST'\n\t}).done(function (data) {\n\t\tvar bericht = (0, _jquery2.default)('#forumBericht');\n\t\tbericht.val(bericht.val() + data);\n\t\t(0, _jquery2.default)(window).scrollTo('#reageren');\n\t});\n\t// We returnen altijd false, dan wordt de href= van <a> niet meer uitgevoerd.\n\t// Het werkt dan dus nog wel als javascript uit staat.\n\treturn false;\n}\n\nfunction statsGrafiek() {\n\tvar detailsDiv = (0, _jquery2.default)('#stats_grafiek_details'),\n\t    overviewDiv = (0, _jquery2.default)('#stats_grafiek_overview');\n\n\tif (!detailsDiv.length || !overviewDiv.length) {\n\t\treturn;\n\t}\n\n\t_jquery2.default.post('/forum/grafiekdata').done(function (data) {\n\n\t\t// helper for returning the weekends in a period\n\n\t\tfunction weekendAreas(axes) {\n\n\t\t\tvar markings = [];\n\t\t\tvar d = new Date(axes.xaxis.min);\n\n\t\t\t// go to the first Saturday\n\n\t\t\td.setUTCDate(d.getUTCDate() - (d.getUTCDay() + 1) % 7);\n\t\t\td.setUTCSeconds(0);\n\t\t\td.setUTCMinutes(0);\n\t\t\td.setUTCHours(0);\n\n\t\t\tvar i = d.getTime();\n\n\t\t\t// when we don't set yaxis, the rectangle automatically\n\t\t\t// extends to infinity upwards and downwards\n\n\t\t\tdo {\n\t\t\t\tmarkings.push({\n\t\t\t\t\txaxis: {\n\t\t\t\t\t\tfrom: i, to: i + 2 * 24 * 60 * 60 * 1000\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ti += 7 * 24 * 60 * 60 * 1000;\n\t\t\t} while (i < axes.xaxis.max);\n\n\t\t\treturn markings;\n\t\t}\n\n\t\tvar options = {\n\t\t\tgrid: {\n\t\t\t\tmarkings: weekendAreas,\n\t\t\t\tbackgroundColor: '#FFFFFF'\n\t\t\t},\n\t\t\tselection: {\n\t\t\t\tmode: 'x'\n\t\t\t},\n\t\t\txaxis: {\n\t\t\t\tmode: 'time',\n\t\t\t\ttimeformat: '%d %b', // 20%y\n\t\t\t\tmonthNames: ['jan', 'feb', 'mrt', 'apr', 'mei', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'],\n\t\t\t\ttickLength: 5\n\t\t\t},\n\t\t\tseries: {\n\t\t\t\tlines: {\n\t\t\t\t\tshow: true,\n\t\t\t\t\tlineWidth: 1\n\t\t\t\t},\n\t\t\t\tshadowSize: 0\n\t\t\t}\n\t\t};\n\n\t\t// toon totaal alleen in overview\n\t\tvar totaal = [data[0]];\n\t\tdata.splice(0, 1);\n\n\t\toptions['legend'] = {\n\t\t\tshow: false\n\t\t};\n\t\tvar overview = _jquery2.default.plot(overviewDiv, totaal, options);\n\n\t\toptions['legend'] = {\n\t\t\tsorted: function sorted(a, b) {\n\t\t\t\t// sort alphabetically in ascending order\n\t\t\t\treturn a.label === b.label ? 0 : a.label > b.label ? 1 : -1;\n\t\t\t}\n\t\t};\n\t\tvar plot = _jquery2.default.plot(detailsDiv, data, options);\n\n\t\tvar getMaxY = function getMaxY(rangeFrom, rangeTo) {\n\t\t\tvar maxy = 0;\n\t\t\t_jquery2.default.each(data, function (key, val) {\n\t\t\t\t_jquery2.default.each(val['data'], function () {\n\t\t\t\t\tif (this[0] > rangeFrom && this[0] < rangeTo) {\n\t\t\t\t\t\tmaxy = this[1] > maxy ? this[1] : maxy;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn maxy;\n\t\t};\n\n\t\t// now connect the two\n\n\t\tdetailsDiv.bind('plotselected', function (event, ranges) {\n\n\t\t\t// do the zooming\n\t\t\t_jquery2.default.each(plot.getXAxes(), function (_, axis) {\n\t\t\t\taxis.options.min = ranges.xaxis.from;\n\t\t\t\taxis.options.max = ranges.xaxis.to;\n\t\t\t});\n\n\t\t\t// update scale\n\t\t\tvar maxy = 1.05 * getMaxY(ranges.xaxis.from, ranges.xaxis.to);\n\n\t\t\t_jquery2.default.each(plot.getYAxes(), function (_, axis) {\n\t\t\t\taxis.options.min = 0;\n\t\t\t\taxis.options.max = maxy;\n\t\t\t});\n\n\t\t\tplot.setupGrid();\n\t\t\tplot.draw();\n\t\t\tplot.clearSelection();\n\n\t\t\t// don't fire event on the overview to prevent eternal loop\n\t\t\toverview.setSelection(ranges, true);\n\t\t});\n\n\t\toverviewDiv.bind('plotselected', function (event, ranges) {\n\t\t\tplot.setSelection(ranges);\n\t\t});\n\t}).fail(alert);\n}\n\n(0, _jquery2.default)(function () {\n\n\tvar $textarea = (0, _jquery2.default)('#forumBericht');\n\tvar $concept = (0, _jquery2.default)('#forumConcept');\n\n\t// The last value that we pinged\n\tvar lastPing = null;\n\tif ($concept.length === 1) {\n\n\t\t/*var ping = */\n\t\tsetInterval(function () {\n\t\t\tvar pingValue = $textarea.val() !== $textarea.attr('origvalue');\n\t\t\tif (pingValue !== false || lastPing !== false) {\n\t\t\t\t_jquery2.default.post($concept.attr('data-url'), {\n\t\t\t\t\tping: pingValue\n\t\t\t\t}).done(_context.domUpdate);\n\t\t\t\tlastPing = pingValue;\n\t\t\t}\n\t\t}, 60000);\n\t\t/*var autosave;\n     $textarea.focusin(function () {\n     autosave = setInterval(saveConceptForumBericht, 3000);\n     });\n     $textarea.focusout(function () {\n     clearInterval(autosave);\n     });*/\n\t}\n\n\t// naar juiste forumreactie scrollen door hash toe te voegen\n\tif (!window.location.hash && window.location.pathname.substr(0, 15) === '/forum/reactie/') {\n\t\tvar reactieid = parseInt(window.location.pathname.substr(15), 10);\n\t\twindow.location.hash = '#' + reactieid;\n\t}\n\n\t$textarea.on('keyup', function (event) {\n\t\tif (event.keyCode === 13) {\n\t\t\t// enter\n\t\t\t(0, _bbcode.CsrBBPreview)('forumBericht', 'berichtPreview');\n\t\t}\n\t});\n\n\t(0, _jquery2.default)('#nieuweTitel').on('focusin', function () {\n\t\treturn (0, _jquery2.default)('#draad-melding').slideDown(200);\n\t});\n\n\t(0, _jquery2.default)('.togglePasfoto').on('click', function () {\n\t\t(0, _jquery2.default)(this).parent().find('.forumpasfoto').toggleClass('verborgen');\n\t});\n\n\t(0, _jquery2.default)('.auteur').hoverIntent(function () {\n\t\t(0, _jquery2.default)(this).find('a.forummodknop').css('opacity', '1');\n\t}, function () {\n\t\t(0, _jquery2.default)(this).find('a.forummodknop').css('opacity', '0');\n\t});\n\n\t(0, _jquery2.default)('a.citeren').on('click', function () {\n\t\tvar postid = (0, _jquery2.default)(this).attr('data-citeren');\n\t\tforumCiteren(postid);\n\t});\n\n\tstatsGrafiek();\n});",{"version":3,"sources":["resources/assets/js/forum.js"],"names":["saveConceptForumBericht","forumBewerken","toggleForumConceptBtn","enable","$concept","attr","prop","$textarea","$titel","val","$","post","forumBericht","titel","length","done","fail","error","alert","setTimeout","bewerkContainer","bewerkContainerInnerHTML","restorePost","html","slideUp","remove","css","submitPost","event","preventDefault","form","ajax","type","cache","url","data","serialize","jqXHR","responseJSON","postId","method","document","getElementById","bewerkForm","find","on","CsrBBPreview","bind","$forumBewerkBericht","autosize","markItUp","bbCodeSet","parent","children","append","slideDown","forumCiteren","bericht","window","scrollTo","statsGrafiek","detailsDiv","overviewDiv","weekendAreas","axes","markings","d","Date","xaxis","min","setUTCDate","getUTCDate","getUTCDay","setUTCSeconds","setUTCMinutes","setUTCHours","i","getTime","push","from","to","max","options","grid","backgroundColor","selection","mode","timeformat","monthNames","tickLength","series","lines","show","lineWidth","shadowSize","totaal","splice","overview","plot","sorted","a","b","label","getMaxY","rangeFrom","rangeTo","maxy","each","key","ranges","getXAxes","_","axis","getYAxes","setupGrid","draw","clearSelection","setSelection","lastPing","setInterval","pingValue","ping","domUpdate","location","hash","pathname","substr","reactieid","parseInt","keyCode","toggleClass","hoverIntent","postid"],"mappings":"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","file":"forum.js","sourceRoot":"/home/travis/build/csrdelft/csrdelft.nl","sourcesContent":["import $ from 'jquery';\nimport {CsrBBPreview} from './bbcode';\nimport {domUpdate} from './context';\nimport {bbCodeSet} from './bbcode-set';\n\nfunction toggleForumConceptBtn(enable) {\n\tlet $concept = $('#forumConcept');\n\tif (typeof enable === 'undefined') {\n\t\t$concept.attr('disabled', !$concept.prop('disabled'));\n\t} else {\n\t\t$concept.attr('disabled', !enable);\n\t}\n}\n\nexport function saveConceptForumBericht() {\n\ttoggleForumConceptBtn(false);\n\tlet $concept = $('#forumConcept');\n\tlet $textarea = $('#forumBericht');\n\tlet $titel = $('#nieuweTitel');\n\tif ($textarea.val() !== $textarea.attr('origvalue')) {\n\t\t$.post($concept.attr('data-url'), {\n\t\t\tforumBericht: $textarea.val(),\n\t\t\ttitel: ($titel.length === 1 ? $titel.val() : ''),\n\t\t}).done(function () {\n\t\t\t$textarea.attr('origvalue', $textarea.val());\n\t\t}).fail(function (error) {\n\t\t\talert(error);\n\t\t});\n\t}\n\tsetTimeout(toggleForumConceptBtn, 3000);\n}\n\nlet bewerkContainer = null;\nlet bewerkContainerInnerHTML = null;\n\n/**\n * @see inline in forumBewerken\n */\nfunction restorePost() {\n\tbewerkContainer.html(bewerkContainerInnerHTML);\n\t$('#bewerk-melding').slideUp(200, function () {\n\t\t$(this).remove();\n\t});\n\t$('#forumPosten').css('visibility', 'visible');\n}\n\nfunction submitPost(event) {\n\tevent.preventDefault();\n\tlet form = $('#forumEditForm');\n\t$.ajax({\n\t\ttype: 'POST',\n\t\tcache: false,\n\t\turl: form.attr('action'),\n\t\tdata: form.serialize(),\n\t}).done((data) => {\n\t\trestorePost();\n\t\tdomUpdate(data);\n\t}).fail((jqXHR) => alert(jqXHR.responseJSON));\n}\n\n/**\n * Een post bewerken in het forum.\n * Haal een post op, bouw een formuliertje met javascript.\n *\n * @see blade_templates/forum/partial/post_lijst.blade.php\n */\nexport function forumBewerken(postId) {\n\t$.ajax({\n\t\turl: '/forum/tekst/' + postId,\n\t\tmethod: 'POST',\n\t}).done((data) => {\n\t\tif (document.getElementById('forumEditForm')) {\n\t\t\trestorePost();\n\t\t}\n\t\tbewerkContainer = $('#post' + postId);\n\t\tbewerkContainerInnerHTML = bewerkContainer.html();\n\t\tlet bewerkForm = `<form id=\"forumEditForm\" class=\"Formulier\" action=\"/forum/bewerken/${postId}\" method=\"post\">` +\n\t\t\t'<div id=\"bewerkPreview\" class=\"preview forumBericht\"></div>' +\n\t\t\t'<textarea name=\"forumBericht\" id=\"forumBewerkBericht\" class=\"FormElement BBCodeField\" rows=\"8\"></textarea>' +\n\t\t\t'Reden van bewerking: <input type=\"text\" name=\"reden\" id=\"forumBewerkReden\"/><br /><br />' +\n\t\t\t'<div class=\"float-right\"><a href=\"/wiki/cie:diensten:forum\" target=\"_blank\">Opmaakhulp</a></div>' +\n\t\t\t'<input type=\"submit\" class=\"opslaan\" value=\"Opslaan\" /> ' +\n\t\t\t'<input type=\"button\" class=\"voorbeeld\" value=\"Voorbeeld\" /> ' +\n\t\t\t'<input type=\"button\" class=\"annuleren\" value=\"Annuleren\" /> ' +\n\t\t\t'</form>';\n\t\tbewerkContainer.html(bewerkForm);\n\t\tbewerkContainer.find('form').on('submit', submitPost);\n\t\tbewerkContainer.find('input.voorbeeld').on('click', CsrBBPreview.bind(null, 'forumBewerkBericht', 'bewerkPreview'));\n\t\tbewerkContainer.find('input.annuleren').on('click', restorePost);\n\n\t\tlet $forumBewerkBericht = $('#forumBewerkBericht');\n\t\t$forumBewerkBericht.val(data);\n\t\t$forumBewerkBericht.autosize();\n\t\t$forumBewerkBericht.markItUp(bbCodeSet);\n\t\t$(bewerkContainer).parent().children('td.auteur:first').append('<div id=\"bewerk-melding\" class=\"alert alert-warning\">Als u dingen aanpast zet er dan even bij w&aacute;t u aanpast! Gebruik bijvoorbeeld [s]...[/s]</div>');\n\t\t$('#bewerk-melding').slideDown(200);\n\t\t$('#forumPosten').css('visibility', 'hidden');\n\t});\n\treturn false;\n}\n\nfunction forumCiteren(postId) {\n\t$.ajax({\n\t\turl: '/forum/citeren/' + postId,\n\t\tmethod: 'POST',\n\t}).done((data) => {\n\t\tlet bericht = $('#forumBericht');\n\t\tbericht.val(bericht.val() + data);\n\t\t$(window).scrollTo('#reageren');\n\t});\n\t// We returnen altijd false, dan wordt de href= van <a> niet meer uitgevoerd.\n\t// Het werkt dan dus nog wel als javascript uit staat.\n\treturn false;\n}\n\nfunction statsGrafiek() {\n\tconst detailsDiv = $('#stats_grafiek_details'),\n\t\toverviewDiv = $('#stats_grafiek_overview');\n\n\tif (!detailsDiv.length || !overviewDiv.length) {\n\t\treturn;\n\t}\n\n\t$.post('/forum/grafiekdata').done(function (data) {\n\n\t\t// helper for returning the weekends in a period\n\n\t\tfunction weekendAreas(axes) {\n\n\t\t\tlet markings = [];\n\t\t\tlet d = new Date(axes.xaxis.min);\n\n\t\t\t// go to the first Saturday\n\n\t\t\td.setUTCDate(d.getUTCDate() - ((d.getUTCDay() + 1) % 7));\n\t\t\td.setUTCSeconds(0);\n\t\t\td.setUTCMinutes(0);\n\t\t\td.setUTCHours(0);\n\n\t\t\tlet i = d.getTime();\n\n\t\t\t// when we don't set yaxis, the rectangle automatically\n\t\t\t// extends to infinity upwards and downwards\n\n\t\t\tdo {\n\t\t\t\tmarkings.push({\n\t\t\t\t\txaxis: {\n\t\t\t\t\t\tfrom: i, to: i + 2 * 24 * 60 * 60 * 1000,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\ti += 7 * 24 * 60 * 60 * 1000;\n\t\t\t} while (i < axes.xaxis.max);\n\n\t\t\treturn markings;\n\t\t}\n\n\n\t\tlet options = {\n\t\t\tgrid: {\n\t\t\t\tmarkings: weekendAreas,\n\t\t\t\tbackgroundColor: '#FFFFFF',\n\t\t\t},\n\t\t\tselection: {\n\t\t\t\tmode: 'x',\n\t\t\t},\n\t\t\txaxis: {\n\t\t\t\tmode: 'time',\n\t\t\t\ttimeformat: '%d %b', // 20%y\n\t\t\t\tmonthNames: ['jan', 'feb', 'mrt', 'apr', 'mei', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'],\n\t\t\t\ttickLength: 5,\n\t\t\t},\n\t\t\tseries: {\n\t\t\t\tlines: {\n\t\t\t\t\tshow: true,\n\t\t\t\t\tlineWidth: 1,\n\t\t\t\t},\n\t\t\t\tshadowSize: 0,\n\t\t\t},\n\t\t};\n\n\t\t// toon totaal alleen in overview\n\t\tlet totaal = [data[0]];\n\t\tdata.splice(0, 1);\n\n\t\toptions['legend'] = {\n\t\t\tshow: false,\n\t\t};\n\t\tlet overview = $.plot(overviewDiv, totaal, options);\n\n\t\toptions['legend'] = {\n\t\t\tsorted(a, b) {\n\t\t\t\t// sort alphabetically in ascending order\n\t\t\t\treturn a.label === b.label ? 0 : (a.label > b.label ? 1 : -1);\n\t\t\t},\n\t\t};\n\t\tlet plot = $.plot(detailsDiv, data, options);\n\n\t\tconst getMaxY = function (rangeFrom, rangeTo) {\n\t\t\tlet maxy = 0;\n\t\t\t$.each(data, function (key, val) {\n\t\t\t\t$.each(val['data'], function () {\n\t\t\t\t\tif (this[0] > rangeFrom && this[0] < rangeTo) {\n\t\t\t\t\t\tmaxy = this[1] > maxy ? this[1] : maxy;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn maxy;\n\t\t};\n\n\t\t// now connect the two\n\n\t\tdetailsDiv.bind('plotselected', (event, ranges) => {\n\n\t\t\t// do the zooming\n\t\t\t$.each(plot.getXAxes(), function (_, axis) {\n\t\t\t\taxis.options.min = ranges.xaxis.from;\n\t\t\t\taxis.options.max = ranges.xaxis.to;\n\t\t\t});\n\n\t\t\t// update scale\n\t\t\tlet maxy = 1.05 * getMaxY(ranges.xaxis.from, ranges.xaxis.to);\n\n\t\t\t$.each(plot.getYAxes(), (_, axis) => {\n\t\t\t\taxis.options.min = 0;\n\t\t\t\taxis.options.max = maxy;\n\t\t\t});\n\n\t\t\tplot.setupGrid();\n\t\t\tplot.draw();\n\t\t\tplot.clearSelection();\n\n\t\t\t// don't fire event on the overview to prevent eternal loop\n\t\t\toverview.setSelection(ranges, true);\n\t\t});\n\n\t\toverviewDiv.bind('plotselected', function (event, ranges) {\n\t\t\tplot.setSelection(ranges);\n\t\t});\n\n\t}).fail(alert);\n\n}\n\n$(function () {\n\n\tlet $textarea = $('#forumBericht');\n\tlet $concept = $('#forumConcept');\n\n\t// The last value that we pinged\n\tlet lastPing = null;\n\tif ($concept.length === 1) {\n\n\t\t/*var ping = */\n\t\tsetInterval(() => {\n\t\t\tlet pingValue = $textarea.val() !== $textarea.attr('origvalue');\n\t\t\tif (pingValue !== false || lastPing !== false) {\n\t\t\t\t$.post($concept.attr('data-url'), {\n\t\t\t\t\tping: pingValue,\n\t\t\t\t}).done(domUpdate);\n\t\t\t\tlastPing = pingValue;\n\t\t\t}\n\t\t}, 60000);\n\t\t/*var autosave;\n     $textarea.focusin(function () {\n     autosave = setInterval(saveConceptForumBericht, 3000);\n     });\n     $textarea.focusout(function () {\n     clearInterval(autosave);\n     });*/\n\t}\n\n\t// naar juiste forumreactie scrollen door hash toe te voegen\n\tif (!window.location.hash && window.location.pathname.substr(0, 15) === '/forum/reactie/') {\n\t\tlet reactieid = parseInt(window.location.pathname.substr(15), 10);\n\t\twindow.location.hash = '#' + reactieid;\n\t}\n\n\t$textarea.on('keyup', (event) => {\n\t\tif (event.keyCode === 13) { // enter\n\t\t\tCsrBBPreview('forumBericht', 'berichtPreview');\n\t\t}\n\t});\n\n\t$('#nieuweTitel').on('focusin', () => $('#draad-melding').slideDown(200));\n\n\t$('.togglePasfoto').on('click', function () {\n\t\t$(this).parent().find('.forumpasfoto').toggleClass('verborgen');\n\t});\n\n\t$('.auteur').hoverIntent(function () {$(this).find('a.forummodknop').css('opacity', '1');}, function () {$(this).find('a.forummodknop').css('opacity', '0');});\n\n\t$('a.citeren').on('click', function () {\n\t\tlet postid = $(this).attr('data-citeren');\n\t\tforumCiteren(postid);\n\t});\n\n\tstatsGrafiek();\n});\n"]}]}