{"remainingRequest":"/home/travis/build/csrdelft/csrdelft.nl/node_modules/babel-loader/lib/index.js??ref--1-1!/home/travis/build/csrdelft/csrdelft.nl/resources/assets/js/lib/jquery.markitup.js","dependencies":[{"path":"/home/travis/build/csrdelft/csrdelft.nl/resources/assets/js/lib/jquery.markitup.js","mtime":1545950542036},{"path":"/home/travis/build/csrdelft/csrdelft.nl/node_modules/cache-loader/dist/cjs.js","mtime":1545950603485},{"path":"/home/travis/build/csrdelft/csrdelft.nl/node_modules/babel-loader/lib/index.js","mtime":1545950603465}],"contextDependencies":[],"result":["'use strict';\n\n// ----------------------------------------------------------------------------\n// markItUp! Universal MarkUp Engine, JQuery plugin\n// v 1.1.x\n// Dual licensed under the MIT and GPL licenses.\n// ----------------------------------------------------------------------------\n// Copyright (C) 2007-2012 Jay Salvat\n// http://markitup.jaysalvat.com/\n// ----------------------------------------------------------------------------\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n// ----------------------------------------------------------------------------\n(function ($) {\n\t$.fn.markItUp = function (settings, extraSettings) {\n\t\tvar method, params, options, selection, ctrlKey, shiftKey, altKey;ctrlKey = shiftKey = altKey = false;\n\n\t\tif (typeof settings == 'string') {\n\t\t\tmethod = settings;\n\t\t\tparams = extraSettings;\n\t\t}\n\n\t\toptions = { id: '',\n\t\t\tnameSpace: '',\n\t\t\troot: '',\n\t\t\tpreviewHandler: false,\n\t\t\tpreviewInWindow: '', // 'width=800, height=600, resizable=yes, scrollbars=yes'\n\t\t\tpreviewInElement: '',\n\t\t\tpreviewAutoRefresh: true,\n\t\t\tpreviewPosition: 'after',\n\t\t\tpreviewTemplatePath: '~/templates/preview.html',\n\t\t\tpreviewParser: false,\n\t\t\tpreviewParserPath: '',\n\t\t\tpreviewParserVar: 'data',\n\t\t\tresizeHandle: true,\n\t\t\tbeforeInsert: '',\n\t\t\tafterInsert: '',\n\t\t\tonEnter: {},\n\t\t\tonShiftEnter: {},\n\t\t\tonCtrlEnter: {},\n\t\t\tonTab: {},\n\t\t\tmarkupSet: [{/* set */}]\n\t\t};\n\t\t$.extend(options, settings, extraSettings);\n\n\t\t// compute markItUp! path\n\t\tif (!options.root) {\n\t\t\t$('script').each(function (a, tag) {\n\t\t\t\tvar miuScript;\n\t\t\t\tmiuScript = $(tag).get(0).src.match(/(.*)jquery\\.markitup(\\.pack)?\\.js$/);\n\t\t\t\tif (miuScript !== null) {\n\t\t\t\t\toptions.root = miuScript[1];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Quick patch to keep compatibility with jQuery 1.9\n\t\tvar uaMatch = function uaMatch(ua) {\n\t\t\tua = ua.toLowerCase();\n\n\t\t\tvar match = /(chrome)[ \\/]([\\w.]+)/.exec(ua) || /(webkit)[ \\/]([\\w.]+)/.exec(ua) || /(opera)(?:.*version|)[ \\/]([\\w.]+)/.exec(ua) || /(msie) ([\\w.]+)/.exec(ua) || ua.indexOf(\"compatible\") < 0 && /(mozilla)(?:.*? rv:([\\w.]+)|)/.exec(ua) || [];\n\n\t\t\treturn {\n\t\t\t\tbrowser: match[1] || \"\",\n\t\t\t\tversion: match[2] || \"0\"\n\t\t\t};\n\t\t};\n\t\tvar matched = uaMatch(navigator.userAgent);\n\t\tvar browser = {};\n\n\t\tif (matched.browser) {\n\t\t\tbrowser[matched.browser] = true;\n\t\t\tbrowser.version = matched.version;\n\t\t}\n\t\tif (browser.chrome) {\n\t\t\tbrowser.webkit = true;\n\t\t} else if (browser.webkit) {\n\t\t\tbrowser.safari = true;\n\t\t}\n\n\t\treturn this.each(function () {\n\t\t\tvar $$, textarea, levels, scrollPosition, caretPosition, caretOffset, clicked, hash, header, footer, previewWindow, template, iFrame, abort;\n\t\t\t$$ = $(this);\n\t\t\ttextarea = this;\n\t\t\tlevels = [];\n\t\t\tabort = false;\n\t\t\tscrollPosition = caretPosition = 0;\n\t\t\tcaretOffset = -1;\n\n\t\t\toptions.previewParserPath = localize(options.previewParserPath);\n\t\t\toptions.previewTemplatePath = localize(options.previewTemplatePath);\n\n\t\t\tif (method) {\n\t\t\t\tswitch (method) {\n\t\t\t\t\tcase 'remove':\n\t\t\t\t\t\tremove();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'insert':\n\t\t\t\t\t\tmarkup(params);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t$.error('Method ' + method + ' does not exist on jQuery.markItUp');\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// apply the computed path to ~/\n\t\t\tfunction localize(data, inText) {\n\t\t\t\tif (inText) {\n\t\t\t\t\treturn data.replace(/(\"|')~\\//g, \"$1\" + options.root);\n\t\t\t\t}\n\t\t\t\treturn data.replace(/^~\\//, options.root);\n\t\t\t}\n\n\t\t\t// init and build editor\n\t\t\tfunction init() {\n\t\t\t\tvar id = '',\n\t\t\t\t    nameSpace = '',\n\t\t\t\t    resizeHandle;\n\t\t\t\tif (options.id) {\n\t\t\t\t\tid = 'id=\"' + options.id + '\"';\n\t\t\t\t} else if ($$.attr(\"id\")) {\n\t\t\t\t\tid = 'id=\"markItUp' + $$.attr(\"id\").substr(0, 1).toUpperCase() + $$.attr(\"id\").substr(1) + '\"';\n\t\t\t\t}\n\t\t\t\tif (options.nameSpace) {\n\t\t\t\t\tnameSpace = 'class=\"' + options.nameSpace + '\"';\n\t\t\t\t}\n\t\t\t\t$$.wrap('<div ' + nameSpace + '></div>');\n\t\t\t\t$$.wrap('<div ' + id + ' class=\"markItUp\"></div>');\n\t\t\t\t$$.wrap('<div class=\"markItUpContainer\"></div>');\n\t\t\t\t$$.addClass(\"markItUpEditor\");\n\n\t\t\t\t// add the header before the textarea\n\t\t\t\theader = $('<div class=\"markItUpHeader\"></div>').insertBefore($$);\n\t\t\t\t$(dropMenus(options.markupSet)).appendTo(header);\n\n\t\t\t\t// add the footer after the textarea\n\t\t\t\tfooter = $('<div class=\"markItUpFooter\"></div>').insertAfter($$);\n\n\t\t\t\t// add the resize handle after textarea\n\t\t\t\tif (options.resizeHandle === true && browser.safari !== true) {\n\t\t\t\t\tresizeHandle = $('<div class=\"markItUpResizeHandle\"></div>').insertAfter($$).bind(\"mousedown.markItUp\", function (e) {\n\t\t\t\t\t\tvar h = $$.height(),\n\t\t\t\t\t\t    y = e.clientY,\n\t\t\t\t\t\t    mouseMove,\n\t\t\t\t\t\t    _mouseUp;\n\t\t\t\t\t\tmouseMove = function mouseMove(e) {\n\t\t\t\t\t\t\t$$.css(\"height\", Math.max(20, e.clientY + h - y) + \"px\");\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t};\n\t\t\t\t\t\t_mouseUp = function mouseUp(e) {\n\t\t\t\t\t\t\t$(\"html\").unbind(\"mousemove.markItUp\", mouseMove).unbind(\"mouseup.markItUp\", _mouseUp);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t};\n\t\t\t\t\t\t$(\"html\").bind(\"mousemove.markItUp\", mouseMove).bind(\"mouseup.markItUp\", _mouseUp);\n\t\t\t\t\t});\n\t\t\t\t\tfooter.append(resizeHandle);\n\t\t\t\t}\n\n\t\t\t\t// listen key events\n\t\t\t\t$$.bind('keydown.markItUp', keyPressed).bind('keyup', keyPressed);\n\n\t\t\t\t// bind an event to catch external calls\n\t\t\t\t$$.bind(\"insertion.markItUp\", function (e, settings) {\n\t\t\t\t\tif (settings.target !== false) {\n\t\t\t\t\t\tget();\n\t\t\t\t\t}\n\t\t\t\t\tif (textarea === $.markItUp.focused) {\n\t\t\t\t\t\tmarkup(settings);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// remember the last focus\n\t\t\t\t$$.bind('focus.markItUp', function () {\n\t\t\t\t\t$.markItUp.focused = this;\n\t\t\t\t});\n\n\t\t\t\tif (options.previewInElement) {\n\t\t\t\t\trefreshPreview();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// recursively build header with dropMenus from markupset\n\t\t\tfunction dropMenus(markupSet) {\n\t\t\t\tvar ul = $('<ul></ul>'),\n\t\t\t\t    i = 0,\n\t\t\t\t    li;\n\t\t\t\t$('li:hover > ul', ul).css('display', 'block');\n\t\t\t\t$.each(markupSet, function () {\n\t\t\t\t\tvar button = this,\n\t\t\t\t\t    t = '',\n\t\t\t\t\t    title,\n\t\t\t\t\t    li,\n\t\t\t\t\t    j;\n\t\t\t\t\ttitle = button.key ? (button.name || '') + ' [Ctrl+' + button.key + ']' : button.name || '';\n\t\t\t\t\tvar key = button.key ? 'accesskey=\"' + button.key + '\"' : '';\n\t\t\t\t\tif (button.separator) {\n\t\t\t\t\t\tli = $('<li class=\"markItUpSeparator\">' + (button.separator || '') + '</li>').appendTo(ul);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tfor (j = levels.length - 1; j >= 0; j--) {\n\t\t\t\t\t\t\tt += levels[j] + \"-\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tli = $('<li class=\"markItUpButton markItUpButton' + t + i + ' ' + (button.className || '') + '\"><a href=\"\" ' + key + ' title=\"' + title + '\">' + (button.name || '') + '</a></li>').bind(\"contextmenu.markItUp\", function () {\n\t\t\t\t\t\t\t// prevent contextmenu on mac and allow ctrl+click\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}).bind('click.markItUp', function (e) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}).bind(\"focusin.markItUp\", function () {\n\t\t\t\t\t\t\t$$.focus();\n\t\t\t\t\t\t}).bind('mouseup', function () {\n\t\t\t\t\t\t\tif (button.call) {\n\t\t\t\t\t\t\t\teval(button.call)();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\tmarkup(button);\n\t\t\t\t\t\t\t}, 1);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}).bind('mouseenter.markItUp', function () {\n\t\t\t\t\t\t\t$('> ul', this).show();\n\t\t\t\t\t\t\t$(document).one('click', function () {\n\t\t\t\t\t\t\t\t// close dropmenu if click outside\n\t\t\t\t\t\t\t\t$('ul ul', header).hide();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}).bind('mouseleave.markItUp', function () {\n\t\t\t\t\t\t\t$('> ul', this).hide();\n\t\t\t\t\t\t}).appendTo(ul);\n\t\t\t\t\t\tif (button.dropMenu) {\n\t\t\t\t\t\t\tlevels.push(i);\n\t\t\t\t\t\t\t$(li).addClass('markItUpDropMenu').append(dropMenus(button.dropMenu));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlevels.pop();\n\t\t\t\treturn ul;\n\t\t\t}\n\n\t\t\t// markItUp! markups\n\t\t\tfunction magicMarkups(string) {\n\t\t\t\tif (string) {\n\t\t\t\t\tstring = string.toString();\n\t\t\t\t\tstring = string.replace(/\\(\\!\\(([\\s\\S]*?)\\)\\!\\)/g, function (x, a) {\n\t\t\t\t\t\tvar b = a.split('|!|');\n\t\t\t\t\t\tif (altKey === true) {\n\t\t\t\t\t\t\treturn b[1] !== undefined ? b[1] : b[0];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn b[1] === undefined ? \"\" : b[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t// [![prompt]!], [![prompt:!:value]!]\n\t\t\t\t\tstring = string.replace(/\\[\\!\\[([\\s\\S]*?)\\]\\!\\]/g, function (x, a) {\n\t\t\t\t\t\tvar b = a.split(':!:');\n\t\t\t\t\t\tif (abort === true) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar value = prompt(b[0], b[1] ? b[1] : '');\n\t\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\t\tabort = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t});\n\t\t\t\t\treturn string;\n\t\t\t\t}\n\t\t\t\treturn \"\";\n\t\t\t}\n\n\t\t\t// prepare action\n\t\t\tfunction prepare(action) {\n\t\t\t\tif ($.isFunction(action)) {\n\t\t\t\t\taction = action(hash);\n\t\t\t\t}\n\t\t\t\treturn magicMarkups(action);\n\t\t\t}\n\n\t\t\t// build block to insert\n\t\t\tfunction build(string) {\n\t\t\t\tvar openWith = prepare(clicked.openWith);\n\t\t\t\tvar placeHolder = prepare(clicked.placeHolder);\n\t\t\t\tvar replaceWith = prepare(clicked.replaceWith);\n\t\t\t\tvar closeWith = prepare(clicked.closeWith);\n\t\t\t\tvar openBlockWith = prepare(clicked.openBlockWith);\n\t\t\t\tvar closeBlockWith = prepare(clicked.closeBlockWith);\n\t\t\t\tvar multiline = clicked.multiline;\n\t\t\t\tvar block;\n\n\t\t\t\tif (replaceWith !== \"\") {\n\t\t\t\t\tblock = openWith + replaceWith + closeWith;\n\t\t\t\t} else if (selection === '' && placeHolder !== '') {\n\t\t\t\t\tblock = openWith + placeHolder + closeWith;\n\t\t\t\t} else {\n\t\t\t\t\tstring = string || selection;\n\n\t\t\t\t\tvar lines = [string],\n\t\t\t\t\t    blocks = [];\n\n\t\t\t\t\tif (multiline === true) {\n\t\t\t\t\t\tlines = string.split(/\\r?\\n/);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var l = 0; l < lines.length; l++) {\n\t\t\t\t\t\tvar line = lines[l];\n\t\t\t\t\t\tvar trailingSpaces;\n\t\t\t\t\t\tif (trailingSpaces = line.match(/ *$/)) {\n\t\t\t\t\t\t\tblocks.push(openWith + line.replace(/ *$/g, '') + closeWith + trailingSpaces);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tblocks.push(openWith + line + closeWith);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tblock = blocks.join(\"\\n\");\n\t\t\t\t}\n\n\t\t\t\tblock = openBlockWith + block + closeBlockWith;\n\n\t\t\t\treturn { block: block,\n\t\t\t\t\topenBlockWith: openBlockWith,\n\t\t\t\t\topenWith: openWith,\n\t\t\t\t\treplaceWith: replaceWith,\n\t\t\t\t\tplaceHolder: placeHolder,\n\t\t\t\t\tcloseWith: closeWith,\n\t\t\t\t\tcloseBlockWith: closeBlockWith\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// define markup to insert\n\t\t\tfunction markup(button) {\n\t\t\t\tvar len, j, n, i, lines, string, start;\n\t\t\t\thash = clicked = button;\n\t\t\t\tget();\n\t\t\t\t$.extend(hash, { line: \"\",\n\t\t\t\t\troot: options.root,\n\t\t\t\t\ttextarea: textarea,\n\t\t\t\t\tselection: selection || '',\n\t\t\t\t\tcaretPosition: caretPosition,\n\t\t\t\t\tctrlKey: ctrlKey,\n\t\t\t\t\tshiftKey: shiftKey,\n\t\t\t\t\taltKey: altKey\n\t\t\t\t});\n\t\t\t\t// callbacks before insertion\n\t\t\t\tprepare(options.beforeInsert);\n\t\t\t\tprepare(clicked.beforeInsert);\n\t\t\t\tif (ctrlKey === true && shiftKey === true || button.multiline === true) {\n\t\t\t\t\tprepare(clicked.beforeMultiInsert);\n\t\t\t\t}\n\t\t\t\t$.extend(hash, { line: 1 });\n\n\t\t\t\tif (ctrlKey === true && shiftKey === true) {\n\t\t\t\t\tlines = selection.split(/\\r?\\n/);\n\t\t\t\t\tfor (j = 0, n = lines.length, i = 0; i < n; i++) {\n\t\t\t\t\t\tif ($.trim(lines[i]) !== '') {\n\t\t\t\t\t\t\t$.extend(hash, { line: ++j, selection: lines[i] });\n\t\t\t\t\t\t\tlines[i] = build(lines[i]).block;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlines[i] = \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstring = { block: lines.join('\\n') };\n\t\t\t\t\tstart = caretPosition;\n\t\t\t\t\tlen = string.block.length + (browser.opera ? n - 1 : 0);\n\t\t\t\t} else if (ctrlKey === true) {\n\t\t\t\t\tstring = build(selection);\n\t\t\t\t\tstart = caretPosition + string.openWith.length;\n\t\t\t\t\tlen = string.block.length - string.openWith.length - string.closeWith.length;\n\t\t\t\t\tlen = len - (string.block.match(/ $/) ? 1 : 0);\n\t\t\t\t\tlen -= fixIeBug(string.block);\n\t\t\t\t} else if (shiftKey === true) {\n\t\t\t\t\tstring = build(selection);\n\t\t\t\t\tstart = caretPosition;\n\t\t\t\t\tlen = string.block.length;\n\t\t\t\t\tlen -= fixIeBug(string.block);\n\t\t\t\t} else {\n\t\t\t\t\tstring = build(selection);\n\t\t\t\t\tstart = caretPosition + string.block.length;\n\t\t\t\t\tlen = 0;\n\t\t\t\t\tstart -= fixIeBug(string.block);\n\t\t\t\t}\n\t\t\t\tif (selection === '' && string.replaceWith === '') {\n\t\t\t\t\tcaretOffset += fixOperaBug(string.block);\n\n\t\t\t\t\tstart = caretPosition + string.openBlockWith.length + string.openWith.length;\n\t\t\t\t\tlen = string.block.length - string.openBlockWith.length - string.openWith.length - string.closeWith.length - string.closeBlockWith.length;\n\n\t\t\t\t\tcaretOffset = $$.val().substring(caretPosition, $$.val().length).length;\n\t\t\t\t\tcaretOffset -= fixOperaBug($$.val().substring(0, caretPosition));\n\t\t\t\t}\n\t\t\t\t$.extend(hash, { caretPosition: caretPosition, scrollPosition: scrollPosition });\n\n\t\t\t\tif (string.block !== selection && abort === false) {\n\t\t\t\t\tinsert(string.block);\n\t\t\t\t\tset(start, len);\n\t\t\t\t} else {\n\t\t\t\t\tcaretOffset = -1;\n\t\t\t\t}\n\t\t\t\tget();\n\n\t\t\t\t$.extend(hash, { line: '', selection: selection });\n\n\t\t\t\t// callbacks after insertion\n\t\t\t\tif (ctrlKey === true && shiftKey === true || button.multiline === true) {\n\t\t\t\t\tprepare(clicked.afterMultiInsert);\n\t\t\t\t}\n\t\t\t\tprepare(clicked.afterInsert);\n\t\t\t\tprepare(options.afterInsert);\n\n\t\t\t\t// refresh preview if opened\n\t\t\t\tif (previewWindow && options.previewAutoRefresh) {\n\t\t\t\t\trefreshPreview();\n\t\t\t\t}\n\n\t\t\t\t// reinit keyevent\n\t\t\t\tshiftKey = altKey = ctrlKey = abort = false;\n\t\t\t}\n\n\t\t\t// Substract linefeed in Opera\n\t\t\tfunction fixOperaBug(string) {\n\t\t\t\tif (browser.opera) {\n\t\t\t\t\treturn string.length - string.replace(/\\n*/g, '').length;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\t// Substract linefeed in IE\n\t\t\tfunction fixIeBug(string) {\n\t\t\t\tif (browser.msie) {\n\t\t\t\t\treturn string.length - string.replace(/\\r*/g, '').length;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\t// add markup\n\t\t\tfunction insert(block) {\n\t\t\t\tif (document.selection) {\n\t\t\t\t\tvar newSelection = document.selection.createRange();\n\t\t\t\t\tnewSelection.text = block;\n\t\t\t\t} else {\n\t\t\t\t\ttextarea.value = textarea.value.substring(0, caretPosition) + block + textarea.value.substring(caretPosition + selection.length, textarea.value.length);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set a selection\n\t\t\tfunction set(start, len) {\n\t\t\t\tif (textarea.createTextRange) {\n\t\t\t\t\t// quick fix to make it work on Opera 9.5\n\t\t\t\t\tif (browser.opera && browser.version >= 9.5 && len == 0) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\trange = textarea.createTextRange();\n\t\t\t\t\trange.collapse(true);\n\t\t\t\t\trange.moveStart('character', start);\n\t\t\t\t\trange.moveEnd('character', len);\n\t\t\t\t\trange.select();\n\t\t\t\t} else if (textarea.setSelectionRange) {\n\t\t\t\t\ttextarea.setSelectionRange(start, start + len);\n\t\t\t\t}\n\t\t\t\ttextarea.scrollTop = scrollPosition;\n\t\t\t\ttextarea.focus();\n\t\t\t}\n\n\t\t\t// get the selection\n\t\t\tfunction get() {\n\t\t\t\ttextarea.focus();\n\n\t\t\t\tscrollPosition = textarea.scrollTop;\n\t\t\t\tif (document.selection) {\n\t\t\t\t\tselection = document.selection.createRange().text;\n\t\t\t\t\tif (browser.msie) {\n\t\t\t\t\t\t// ie\n\t\t\t\t\t\tvar range = document.selection.createRange(),\n\t\t\t\t\t\t    rangeCopy = range.duplicate();\n\t\t\t\t\t\trangeCopy.moveToElementText(textarea);\n\t\t\t\t\t\tcaretPosition = -1;\n\t\t\t\t\t\twhile (rangeCopy.inRange(range)) {\n\t\t\t\t\t\t\trangeCopy.moveStart('character');\n\t\t\t\t\t\t\tcaretPosition++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// opera\n\t\t\t\t\t\tcaretPosition = textarea.selectionStart;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// gecko & webkit\n\t\t\t\t\tcaretPosition = textarea.selectionStart;\n\n\t\t\t\t\tselection = textarea.value.substring(caretPosition, textarea.selectionEnd);\n\t\t\t\t}\n\t\t\t\treturn selection;\n\t\t\t}\n\n\t\t\t// open preview window\n\t\t\tfunction preview() {\n\t\t\t\tif (typeof options.previewHandler === 'function') {\n\t\t\t\t\tpreviewWindow = true;\n\t\t\t\t} else if (options.previewInElement) {\n\t\t\t\t\tpreviewWindow = $(options.previewInElement);\n\t\t\t\t} else if (!previewWindow || previewWindow.closed) {\n\t\t\t\t\tif (options.previewInWindow) {\n\t\t\t\t\t\tpreviewWindow = window.open('', 'preview', options.previewInWindow);\n\t\t\t\t\t\t$(window).unload(function () {\n\t\t\t\t\t\t\tpreviewWindow.close();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tiFrame = $('<iframe class=\"markItUpPreviewFrame\"></iframe>');\n\t\t\t\t\t\tif (options.previewPosition == 'after') {\n\t\t\t\t\t\t\tiFrame.insertAfter(footer);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tiFrame.insertBefore(header);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpreviewWindow = iFrame[iFrame.length - 1].contentWindow || frame[iFrame.length - 1];\n\t\t\t\t\t}\n\t\t\t\t} else if (altKey === true) {\n\t\t\t\t\tif (iFrame) {\n\t\t\t\t\t\tiFrame.remove();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpreviewWindow.close();\n\t\t\t\t\t}\n\t\t\t\t\tpreviewWindow = iFrame = false;\n\t\t\t\t}\n\t\t\t\tif (!options.previewAutoRefresh) {\n\t\t\t\t\trefreshPreview();\n\t\t\t\t}\n\t\t\t\tif (options.previewInWindow) {\n\t\t\t\t\tpreviewWindow.focus();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// refresh Preview window\n\t\t\tfunction refreshPreview() {\n\t\t\t\trenderPreview();\n\t\t\t}\n\n\t\t\tfunction renderPreview() {\n\t\t\t\tvar phtml;\n\t\t\t\tif (options.previewHandler && typeof options.previewHandler === 'function') {\n\t\t\t\t\toptions.previewHandler($$.val());\n\t\t\t\t} else if (options.previewParser && typeof options.previewParser === 'function') {\n\t\t\t\t\tvar data = options.previewParser($$.val());\n\t\t\t\t\twriteInPreview(localize(data, 1));\n\t\t\t\t} else if (options.previewParserPath !== '') {\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\tdataType: 'text',\n\t\t\t\t\t\tglobal: false,\n\t\t\t\t\t\turl: options.previewParserPath,\n\t\t\t\t\t\tdata: options.previewParserVar + '=' + encodeURIComponent($$.val()),\n\t\t\t\t\t\tsuccess: function success(data) {\n\t\t\t\t\t\t\twriteInPreview(localize(data, 1));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (!template) {\n\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\turl: options.previewTemplatePath,\n\t\t\t\t\t\t\tdataType: 'text',\n\t\t\t\t\t\t\tglobal: false,\n\t\t\t\t\t\t\tsuccess: function success(data) {\n\t\t\t\t\t\t\t\twriteInPreview(localize(data, 1).replace(/<!-- content -->/g, $$.val()));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfunction writeInPreview(data) {\n\t\t\t\tif (options.previewInElement) {\n\t\t\t\t\t$(options.previewInElement).html(data);\n\t\t\t\t} else if (previewWindow && previewWindow.document) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tsp = previewWindow.document.documentElement.scrollTop;\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tsp = 0;\n\t\t\t\t\t}\n\t\t\t\t\tpreviewWindow.document.open();\n\t\t\t\t\tpreviewWindow.document.write(data);\n\t\t\t\t\tpreviewWindow.document.close();\n\t\t\t\t\tpreviewWindow.document.documentElement.scrollTop = sp;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set keys pressed\n\t\t\tfunction keyPressed(e) {\n\t\t\t\tshiftKey = e.shiftKey;\n\t\t\t\taltKey = e.altKey;\n\t\t\t\tctrlKey = !(e.altKey && e.ctrlKey) ? e.ctrlKey || e.metaKey : false;\n\n\t\t\t\tif (e.type === 'keydown') {\n\t\t\t\t\tif (ctrlKey === true) {\n\t\t\t\t\t\tli = $('a[accesskey=\"' + (e.keyCode == 13 ? '\\\\n' : String.fromCharCode(e.keyCode)) + '\"]', header).parent('li');\n\t\t\t\t\t\tif (li.length !== 0) {\n\t\t\t\t\t\t\tctrlKey = false;\n\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\tli.triggerHandler('mouseup');\n\t\t\t\t\t\t\t}, 1);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (e.keyCode === 13 || e.keyCode === 10) {\n\t\t\t\t\t\t// Enter key\n\t\t\t\t\t\tif (ctrlKey === true) {\n\t\t\t\t\t\t\t// Enter + Ctrl\n\t\t\t\t\t\t\tctrlKey = false;\n\t\t\t\t\t\t\tmarkup(options.onCtrlEnter);\n\t\t\t\t\t\t\treturn options.onCtrlEnter.keepDefault;\n\t\t\t\t\t\t} else if (shiftKey === true) {\n\t\t\t\t\t\t\t// Enter + Shift\n\t\t\t\t\t\t\tshiftKey = false;\n\t\t\t\t\t\t\tmarkup(options.onShiftEnter);\n\t\t\t\t\t\t\treturn options.onShiftEnter.keepDefault;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// only Enter\n\t\t\t\t\t\t\tmarkup(options.onEnter);\n\t\t\t\t\t\t\treturn options.onEnter.keepDefault;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (e.keyCode === 9) {\n\t\t\t\t\t\t// Tab key\n\t\t\t\t\t\tif (shiftKey == true || ctrlKey == true || altKey == true) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (caretOffset !== -1) {\n\t\t\t\t\t\t\tget();\n\t\t\t\t\t\t\tcaretOffset = $$.val().length - caretOffset;\n\t\t\t\t\t\t\tset(caretOffset, 0);\n\t\t\t\t\t\t\tcaretOffset = -1;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmarkup(options.onTab);\n\t\t\t\t\t\t\treturn options.onTab.keepDefault;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction remove() {\n\t\t\t\t$$.unbind(\".markItUp\").removeClass('markItUpEditor');\n\t\t\t\t$$.parent('div').parent('div.markItUp').parent('div').replaceWith($$);\n\t\t\t\t$$.data('markItUp', null);\n\t\t\t}\n\n\t\t\tinit();\n\t\t});\n\t};\n\n\t$.fn.markItUpRemove = function () {\n\t\treturn this.each(function () {\n\t\t\t$(this).markItUp('remove');\n\t\t});\n\t};\n\n\t$.markItUp = function (settings) {\n\t\tvar options = { target: false };\n\t\t$.extend(options, settings);\n\t\tif (options.target) {\n\t\t\treturn $(options.target).each(function () {\n\t\t\t\t$(this).focus();\n\t\t\t\t$(this).trigger('insertion', [options]);\n\t\t\t});\n\t\t} else {\n\t\t\t$('textarea').trigger('insertion', [options]);\n\t\t}\n\t};\n})(jQuery);",{"version":3,"sources":["resources/assets/js/lib/jquery.markitup.js"],"names":["$","fn","markItUp","settings","extraSettings","method","params","options","selection","ctrlKey","shiftKey","altKey","id","nameSpace","root","previewHandler","previewInWindow","previewInElement","previewAutoRefresh","previewPosition","previewTemplatePath","previewParser","previewParserPath","previewParserVar","resizeHandle","beforeInsert","afterInsert","onEnter","onShiftEnter","onCtrlEnter","onTab","markupSet","extend","each","a","tag","miuScript","get","src","match","uaMatch","ua","toLowerCase","exec","indexOf","browser","version","matched","navigator","userAgent","chrome","webkit","safari","$$","textarea","levels","scrollPosition","caretPosition","caretOffset","clicked","hash","header","footer","previewWindow","template","iFrame","abort","localize","remove","markup","error","data","inText","replace","init","attr","substr","toUpperCase","wrap","addClass","insertBefore","dropMenus","appendTo","insertAfter","bind","e","h","height","y","clientY","mouseMove","mouseUp","css","Math","max","unbind","append","keyPressed","target","focused","refreshPreview","ul","i","li","button","t","title","j","key","name","separator","length","className","preventDefault","focus","call","eval","setTimeout","show","document","one","hide","dropMenu","push","pop","magicMarkups","string","toString","x","b","split","undefined","value","prompt","prepare","action","isFunction","build","openWith","placeHolder","replaceWith","closeWith","openBlockWith","closeBlockWith","multiline","block","lines","blocks","l","line","trailingSpaces","join","len","n","start","beforeMultiInsert","trim","opera","fixIeBug","fixOperaBug","val","substring","insert","set","afterMultiInsert","msie","newSelection","createRange","text","createTextRange","range","collapse","moveStart","moveEnd","select","setSelectionRange","scrollTop","rangeCopy","duplicate","moveToElementText","inRange","selectionStart","selectionEnd","preview","closed","window","open","unload","close","contentWindow","frame","renderPreview","phtml","writeInPreview","ajax","type","dataType","global","url","encodeURIComponent","success","html","sp","documentElement","write","metaKey","keyCode","String","fromCharCode","parent","triggerHandler","keepDefault","removeClass","markItUpRemove","trigger","jQuery"],"mappings":"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","file":"jquery.markitup.js","sourceRoot":"/home/travis/build/csrdelft/csrdelft.nl","sourcesContent":["// ----------------------------------------------------------------------------\n// markItUp! Universal MarkUp Engine, JQuery plugin\n// v 1.1.x\n// Dual licensed under the MIT and GPL licenses.\n// ----------------------------------------------------------------------------\n// Copyright (C) 2007-2012 Jay Salvat\n// http://markitup.jaysalvat.com/\n// ----------------------------------------------------------------------------\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n// ----------------------------------------------------------------------------\n(function($) {\n\t$.fn.markItUp = function(settings, extraSettings) {\n\t\tvar method, params, options, selection, ctrlKey, shiftKey, altKey; ctrlKey = shiftKey = altKey = false;\n\n\t\tif (typeof settings == 'string') {\n\t\t\tmethod = settings;\n\t\t\tparams = extraSettings;\n\t\t}\n\n\t\toptions = {\tid:\t\t\t\t\t\t'',\n\t\t\t\t\tnameSpace:\t\t\t\t'',\n\t\t\t\t\troot:\t\t\t\t\t'',\n\t\t\t\t\tpreviewHandler:\t\t\tfalse,\n\t\t\t\t\tpreviewInWindow:\t\t'', // 'width=800, height=600, resizable=yes, scrollbars=yes'\n\t\t\t\t\tpreviewInElement:\t\t'',\n\t\t\t\t\tpreviewAutoRefresh:\t\ttrue,\n\t\t\t\t\tpreviewPosition:\t\t'after',\n\t\t\t\t\tpreviewTemplatePath:\t'~/templates/preview.html',\n\t\t\t\t\tpreviewParser:\t\t\tfalse,\n\t\t\t\t\tpreviewParserPath:\t\t'',\n\t\t\t\t\tpreviewParserVar:\t\t'data',\n\t\t\t\t\tresizeHandle:\t\t\ttrue,\n\t\t\t\t\tbeforeInsert:\t\t\t'',\n\t\t\t\t\tafterInsert:\t\t\t'',\n\t\t\t\t\tonEnter:\t\t\t\t{},\n\t\t\t\t\tonShiftEnter:\t\t\t{},\n\t\t\t\t\tonCtrlEnter:\t\t\t{},\n\t\t\t\t\tonTab:\t\t\t\t\t{},\n\t\t\t\t\tmarkupSet:\t\t\t[\t{ /* set */ } ]\n\t\t\t\t};\n\t\t$.extend(options, settings, extraSettings);\n\n\t\t// compute markItUp! path\n\t\tif (!options.root) {\n\t\t\t$('script').each(function(a, tag) {\n\t\t\t\tvar miuScript;\n\t\t\t\tmiuScript = $(tag).get(0).src.match(/(.*)jquery\\.markitup(\\.pack)?\\.js$/);\n\t\t\t\tif (miuScript !== null) {\n\t\t\t\t\toptions.root = miuScript[1];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Quick patch to keep compatibility with jQuery 1.9\n\t\tvar uaMatch = function(ua) {\n\t\t\tua = ua.toLowerCase();\n\n\t\t\tvar match = /(chrome)[ \\/]([\\w.]+)/.exec(ua) ||\n\t\t\t\t/(webkit)[ \\/]([\\w.]+)/.exec(ua) ||\n\t\t\t\t/(opera)(?:.*version|)[ \\/]([\\w.]+)/.exec(ua) ||\n\t\t\t\t/(msie) ([\\w.]+)/.exec(ua) ||\n\t\t\t\tua.indexOf(\"compatible\") < 0 && /(mozilla)(?:.*? rv:([\\w.]+)|)/.exec(ua) ||\n\t\t\t\t[];\n\n\t\t\treturn {\n\t\t\t\tbrowser: match[ 1 ] || \"\",\n\t\t\t\tversion: match[ 2 ] || \"0\"\n\t\t\t};\n\t\t};\n\t\tvar matched = uaMatch( navigator.userAgent );\n\t\tvar browser = {};\n\n\t\tif (matched.browser) {\n\t\t\tbrowser[matched.browser] = true;\n\t\t\tbrowser.version = matched.version;\n\t\t}\n\t\tif (browser.chrome) {\n\t\t\tbrowser.webkit = true;\n\t\t} else if (browser.webkit) {\n\t\t\tbrowser.safari = true;\n\t\t}\n\n\t\treturn this.each(function() {\n\t\t\tvar $$, textarea, levels, scrollPosition, caretPosition, caretOffset,\n\t\t\t\tclicked, hash, header, footer, previewWindow, template, iFrame, abort;\n\t\t\t$$ = $(this);\n\t\t\ttextarea = this;\n\t\t\tlevels = [];\n\t\t\tabort = false;\n\t\t\tscrollPosition = caretPosition = 0;\n\t\t\tcaretOffset = -1;\n\n\t\t\toptions.previewParserPath = localize(options.previewParserPath);\n\t\t\toptions.previewTemplatePath = localize(options.previewTemplatePath);\n\n\t\t\tif (method) {\n\t\t\t\tswitch(method) {\n\t\t\t\t\tcase 'remove':\n\t\t\t\t\t\tremove();\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'insert':\n\t\t\t\t\t\tmarkup(params);\n\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t$.error('Method ' +  method + ' does not exist on jQuery.markItUp');\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// apply the computed path to ~/\n\t\t\tfunction localize(data, inText) {\n\t\t\t\tif (inText) {\n\t\t\t\t\treturn \tdata.replace(/(\"|')~\\//g, \"$1\"+options.root);\n\t\t\t\t}\n\t\t\t\treturn \tdata.replace(/^~\\//, options.root);\n\t\t\t}\n\n\t\t\t// init and build editor\n\t\t\tfunction init() {\n\t\t\t\tvar id = '', nameSpace = '', resizeHandle;\n\t\t\t\tif (options.id) {\n\t\t\t\t\tid = 'id=\"'+options.id+'\"';\n\t\t\t\t} else if ($$.attr(\"id\")) {\n\t\t\t\t\tid = 'id=\"markItUp'+($$.attr(\"id\").substr(0, 1).toUpperCase())+($$.attr(\"id\").substr(1))+'\"';\n\n\t\t\t\t}\n\t\t\t\tif (options.nameSpace) {\n\t\t\t\t\tnameSpace = 'class=\"'+options.nameSpace+'\"';\n\t\t\t\t}\n\t\t\t\t$$.wrap('<div '+nameSpace+'></div>');\n\t\t\t\t$$.wrap('<div '+id+' class=\"markItUp\"></div>');\n\t\t\t\t$$.wrap('<div class=\"markItUpContainer\"></div>');\n\t\t\t\t$$.addClass(\"markItUpEditor\");\n\n\t\t\t\t// add the header before the textarea\n\t\t\t\theader = $('<div class=\"markItUpHeader\"></div>').insertBefore($$);\n\t\t\t\t$(dropMenus(options.markupSet)).appendTo(header);\n\n\t\t\t\t// add the footer after the textarea\n\t\t\t\tfooter = $('<div class=\"markItUpFooter\"></div>').insertAfter($$);\n\n\t\t\t\t// add the resize handle after textarea\n\t\t\t\tif (options.resizeHandle === true && browser.safari !== true) {\n\t\t\t\t\tresizeHandle = $('<div class=\"markItUpResizeHandle\"></div>')\n\t\t\t\t\t\t.insertAfter($$)\n\t\t\t\t\t\t.bind(\"mousedown.markItUp\", function(e) {\n\t\t\t\t\t\t\tvar h = $$.height(), y = e.clientY, mouseMove, mouseUp;\n\t\t\t\t\t\t\tmouseMove = function(e) {\n\t\t\t\t\t\t\t\t$$.css(\"height\", Math.max(20, e.clientY+h-y)+\"px\");\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tmouseUp = function(e) {\n\t\t\t\t\t\t\t\t$(\"html\").unbind(\"mousemove.markItUp\", mouseMove).unbind(\"mouseup.markItUp\", mouseUp);\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t$(\"html\").bind(\"mousemove.markItUp\", mouseMove).bind(\"mouseup.markItUp\", mouseUp);\n\t\t\t\t\t});\n\t\t\t\t\tfooter.append(resizeHandle);\n\t\t\t\t}\n\n\t\t\t\t// listen key events\n\t\t\t\t$$.bind('keydown.markItUp', keyPressed).bind('keyup', keyPressed);\n\n\t\t\t\t// bind an event to catch external calls\n\t\t\t\t$$.bind(\"insertion.markItUp\", function(e, settings) {\n\t\t\t\t\tif (settings.target !== false) {\n\t\t\t\t\t\tget();\n\t\t\t\t\t}\n\t\t\t\t\tif (textarea === $.markItUp.focused) {\n\t\t\t\t\t\tmarkup(settings);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// remember the last focus\n\t\t\t\t$$.bind('focus.markItUp', function() {\n\t\t\t\t\t$.markItUp.focused = this;\n\t\t\t\t});\n\n\t\t\t\tif (options.previewInElement) {\n\t\t\t\t\trefreshPreview();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// recursively build header with dropMenus from markupset\n\t\t\tfunction dropMenus(markupSet) {\n\t\t\t\tvar ul = $('<ul></ul>'), i = 0, li;\n\t\t\t\t$('li:hover > ul', ul).css('display', 'block');\n\t\t\t\t$.each(markupSet, function() {\n\t\t\t\t\tvar button = this, t = '', title, li, j;\n\t\t\t\t\ttitle = (button.key) ? (button.name||'')+' [Ctrl+'+button.key+']' : (button.name||'');\n\t\t\t\t\tvar key   = (button.key) ? 'accesskey=\"'+button.key+'\"' : '';\n\t\t\t\t\tif (button.separator) {\n\t\t\t\t\t\tli = $('<li class=\"markItUpSeparator\">'+(button.separator||'')+'</li>').appendTo(ul);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tfor (j = levels.length -1; j >= 0; j--) {\n\t\t\t\t\t\t\tt += levels[j]+\"-\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tli = $('<li class=\"markItUpButton markItUpButton'+t+(i)+' '+(button.className||'')+'\"><a href=\"\" '+key+' title=\"'+title+'\">'+(button.name||'')+'</a></li>')\n\t\t\t\t\t\t.bind(\"contextmenu.markItUp\", function() { // prevent contextmenu on mac and allow ctrl+click\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}).bind('click.markItUp', function(e) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}).bind(\"focusin.markItUp\", function(){\n                            $$.focus();\n\t\t\t\t\t\t}).bind('mouseup', function() {\n\t\t\t\t\t\t\tif (button.call) {\n\t\t\t\t\t\t\t\teval(button.call)();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsetTimeout(function() { markup(button) },1);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}).bind('mouseenter.markItUp', function() {\n\t\t\t\t\t\t\t\t$('> ul', this).show();\n\t\t\t\t\t\t\t\t$(document).one('click', function() { // close dropmenu if click outside\n\t\t\t\t\t\t\t\t\t\t$('ul ul', header).hide();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}).bind('mouseleave.markItUp', function() {\n\t\t\t\t\t\t\t\t$('> ul', this).hide();\n\t\t\t\t\t\t}).appendTo(ul);\n\t\t\t\t\t\tif (button.dropMenu) {\n\t\t\t\t\t\t\tlevels.push(i);\n\t\t\t\t\t\t\t$(li).addClass('markItUpDropMenu').append(dropMenus(button.dropMenu));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlevels.pop();\n\t\t\t\treturn ul;\n\t\t\t}\n\n\t\t\t// markItUp! markups\n\t\t\tfunction magicMarkups(string) {\n\t\t\t\tif (string) {\n\t\t\t\t\tstring = string.toString();\n\t\t\t\t\tstring = string.replace(/\\(\\!\\(([\\s\\S]*?)\\)\\!\\)/g,\n\t\t\t\t\t\tfunction(x, a) {\n\t\t\t\t\t\t\tvar b = a.split('|!|');\n\t\t\t\t\t\t\tif (altKey === true) {\n\t\t\t\t\t\t\t\treturn (b[1] !== undefined) ? b[1] : b[0];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn (b[1] === undefined) ? \"\" : b[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\t// [![prompt]!], [![prompt:!:value]!]\n\t\t\t\t\tstring = string.replace(/\\[\\!\\[([\\s\\S]*?)\\]\\!\\]/g,\n\t\t\t\t\t\tfunction(x, a) {\n\t\t\t\t\t\t\tvar b = a.split(':!:');\n\t\t\t\t\t\t\tif (abort === true) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar value = prompt(b[0], (b[1]) ? b[1] : '');\n\t\t\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\t\t\tabort = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn value;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\treturn string;\n\t\t\t\t}\n\t\t\t\treturn \"\";\n\t\t\t}\n\n\t\t\t// prepare action\n\t\t\tfunction prepare(action) {\n\t\t\t\tif ($.isFunction(action)) {\n\t\t\t\t\taction = action(hash);\n\t\t\t\t}\n\t\t\t\treturn magicMarkups(action);\n\t\t\t}\n\n\t\t\t// build block to insert\n\t\t\tfunction build(string) {\n\t\t\t\tvar openWith \t\t\t= prepare(clicked.openWith);\n\t\t\t\tvar placeHolder \t\t= prepare(clicked.placeHolder);\n\t\t\t\tvar replaceWith \t\t= prepare(clicked.replaceWith);\n\t\t\t\tvar closeWith \t\t\t= prepare(clicked.closeWith);\n\t\t\t\tvar openBlockWith \t\t= prepare(clicked.openBlockWith);\n\t\t\t\tvar closeBlockWith \t\t= prepare(clicked.closeBlockWith);\n\t\t\t\tvar multiline \t\t\t= clicked.multiline;\n\t\t\t\tvar block;\n\n\t\t\t\tif (replaceWith !== \"\") {\n\t\t\t\t\tblock = openWith + replaceWith + closeWith;\n\t\t\t\t} else if (selection === '' && placeHolder !== '') {\n\t\t\t\t\tblock = openWith + placeHolder + closeWith;\n\t\t\t\t} else {\n\t\t\t\t\tstring = string || selection;\n\n\t\t\t\t\tvar lines = [string], blocks = [];\n\n\t\t\t\t\tif (multiline === true) {\n\t\t\t\t\t\tlines = string.split(/\\r?\\n/);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var l = 0; l < lines.length; l++) {\n\t\t\t\t\t\tvar line = lines[l];\n\t\t\t\t\t\tvar trailingSpaces;\n\t\t\t\t\t\tif (trailingSpaces = line.match(/ *$/)) {\n\t\t\t\t\t\t\tblocks.push(openWith + line.replace(/ *$/g, '') + closeWith + trailingSpaces);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tblocks.push(openWith + line + closeWith);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tblock = blocks.join(\"\\n\");\n\t\t\t\t}\n\n\t\t\t\tblock = openBlockWith + block + closeBlockWith;\n\n\t\t\t\treturn {\tblock:block,\n\t\t\t\t\t\t\topenBlockWith:openBlockWith,\n\t\t\t\t\t\t\topenWith:openWith,\n\t\t\t\t\t\t\treplaceWith:replaceWith,\n\t\t\t\t\t\t\tplaceHolder:placeHolder,\n\t\t\t\t\t\t\tcloseWith:closeWith,\n\t\t\t\t\t\t\tcloseBlockWith:closeBlockWith\n\t\t\t\t\t};\n\t\t\t}\n\n\t\t\t// define markup to insert\n\t\t\tfunction markup(button) {\n\t\t\t\tvar len, j, n, i, lines, string, start;\n\t\t\t\thash = clicked = button;\n\t\t\t\tget();\n\t\t\t\t$.extend(hash, {\tline:\"\",\n\t\t\t\t\t\t \t\t\troot:options.root,\n\t\t\t\t\t\t\t\t\ttextarea:textarea,\n\t\t\t\t\t\t\t\t\tselection:(selection||''),\n\t\t\t\t\t\t\t\t\tcaretPosition:caretPosition,\n\t\t\t\t\t\t\t\t\tctrlKey:ctrlKey,\n\t\t\t\t\t\t\t\t\tshiftKey:shiftKey,\n\t\t\t\t\t\t\t\t\taltKey:altKey\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t// callbacks before insertion\n\t\t\t\tprepare(options.beforeInsert);\n\t\t\t\tprepare(clicked.beforeInsert);\n\t\t\t\tif ((ctrlKey === true && shiftKey === true) || button.multiline === true) {\n\t\t\t\t\tprepare(clicked.beforeMultiInsert);\n\t\t\t\t}\n\t\t\t\t$.extend(hash, { line:1 });\n\n\t\t\t\tif ((ctrlKey === true && shiftKey === true)) {\n\t\t\t\t\tlines = selection.split(/\\r?\\n/);\n\t\t\t\t\tfor (j = 0, n = lines.length, i = 0; i < n; i++) {\n\t\t\t\t\t\tif ($.trim(lines[i]) !== '') {\n\t\t\t\t\t\t\t$.extend(hash, { line:++j, selection:lines[i] } );\n\t\t\t\t\t\t\tlines[i] = build(lines[i]).block;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlines[i] = \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstring = { block:lines.join('\\n')};\n\t\t\t\t\tstart = caretPosition;\n\t\t\t\t\tlen = string.block.length + ((browser.opera) ? n-1 : 0);\n\t\t\t\t} else if (ctrlKey === true) {\n\t\t\t\t\tstring = build(selection);\n\t\t\t\t\tstart = caretPosition + string.openWith.length;\n\t\t\t\t\tlen = string.block.length - string.openWith.length - string.closeWith.length;\n\t\t\t\t\tlen = len - (string.block.match(/ $/) ? 1 : 0);\n\t\t\t\t\tlen -= fixIeBug(string.block);\n\t\t\t\t} else if (shiftKey === true) {\n\t\t\t\t\tstring = build(selection);\n\t\t\t\t\tstart = caretPosition;\n\t\t\t\t\tlen = string.block.length;\n\t\t\t\t\tlen -= fixIeBug(string.block);\n\t\t\t\t} else {\n\t\t\t\t\tstring = build(selection);\n\t\t\t\t\tstart = caretPosition + string.block.length ;\n\t\t\t\t\tlen = 0;\n\t\t\t\t\tstart -= fixIeBug(string.block);\n\t\t\t\t}\n\t\t\t\tif ((selection === '' && string.replaceWith === '')) {\n\t\t\t\t\tcaretOffset += fixOperaBug(string.block);\n\n\t\t\t\t\tstart = caretPosition + string.openBlockWith.length + string.openWith.length;\n\t\t\t\t\tlen = string.block.length - string.openBlockWith.length - string.openWith.length - string.closeWith.length - string.closeBlockWith.length;\n\n\t\t\t\t\tcaretOffset = $$.val().substring(caretPosition,  $$.val().length).length;\n\t\t\t\t\tcaretOffset -= fixOperaBug($$.val().substring(0, caretPosition));\n\t\t\t\t}\n\t\t\t\t$.extend(hash, { caretPosition:caretPosition, scrollPosition:scrollPosition } );\n\n\t\t\t\tif (string.block !== selection && abort === false) {\n\t\t\t\t\tinsert(string.block);\n\t\t\t\t\tset(start, len);\n\t\t\t\t} else {\n\t\t\t\t\tcaretOffset = -1;\n\t\t\t\t}\n\t\t\t\tget();\n\n\t\t\t\t$.extend(hash, { line:'', selection:selection });\n\n\t\t\t\t// callbacks after insertion\n\t\t\t\tif ((ctrlKey === true && shiftKey === true) || button.multiline === true) {\n\t\t\t\t\tprepare(clicked.afterMultiInsert);\n\t\t\t\t}\n\t\t\t\tprepare(clicked.afterInsert);\n\t\t\t\tprepare(options.afterInsert);\n\n\t\t\t\t// refresh preview if opened\n\t\t\t\tif (previewWindow && options.previewAutoRefresh) {\n\t\t\t\t\trefreshPreview();\n\t\t\t\t}\n\n\t\t\t\t// reinit keyevent\n\t\t\t\tshiftKey = altKey = ctrlKey = abort = false;\n\t\t\t}\n\n\t\t\t// Substract linefeed in Opera\n\t\t\tfunction fixOperaBug(string) {\n\t\t\t\tif (browser.opera) {\n\t\t\t\t\treturn string.length - string.replace(/\\n*/g, '').length;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\t// Substract linefeed in IE\n\t\t\tfunction fixIeBug(string) {\n\t\t\t\tif (browser.msie) {\n\t\t\t\t\treturn string.length - string.replace(/\\r*/g, '').length;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\t// add markup\n\t\t\tfunction insert(block) {\n\t\t\t\tif (document.selection) {\n\t\t\t\t\tvar newSelection = document.selection.createRange();\n\t\t\t\t\tnewSelection.text = block;\n\t\t\t\t} else {\n\t\t\t\t\ttextarea.value =  textarea.value.substring(0, caretPosition)  + block + textarea.value.substring(caretPosition + selection.length, textarea.value.length);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set a selection\n\t\t\tfunction set(start, len) {\n\t\t\t\tif (textarea.createTextRange){\n\t\t\t\t\t// quick fix to make it work on Opera 9.5\n\t\t\t\t\tif (browser.opera && browser.version >= 9.5 && len == 0) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\trange = textarea.createTextRange();\n\t\t\t\t\trange.collapse(true);\n\t\t\t\t\trange.moveStart('character', start);\n\t\t\t\t\trange.moveEnd('character', len);\n\t\t\t\t\trange.select();\n\t\t\t\t} else if (textarea.setSelectionRange ){\n\t\t\t\t\ttextarea.setSelectionRange(start, start + len);\n\t\t\t\t}\n\t\t\t\ttextarea.scrollTop = scrollPosition;\n\t\t\t\ttextarea.focus();\n\t\t\t}\n\n\t\t\t// get the selection\n\t\t\tfunction get() {\n\t\t\t\ttextarea.focus();\n\n\t\t\t\tscrollPosition = textarea.scrollTop;\n\t\t\t\tif (document.selection) {\n\t\t\t\t\tselection = document.selection.createRange().text;\n\t\t\t\t\tif (browser.msie) { // ie\n\t\t\t\t\t\tvar range = document.selection.createRange(), rangeCopy = range.duplicate();\n\t\t\t\t\t\trangeCopy.moveToElementText(textarea);\n\t\t\t\t\t\tcaretPosition = -1;\n\t\t\t\t\t\twhile(rangeCopy.inRange(range)) {\n\t\t\t\t\t\t\trangeCopy.moveStart('character');\n\t\t\t\t\t\t\tcaretPosition ++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else { // opera\n\t\t\t\t\t\tcaretPosition = textarea.selectionStart;\n\t\t\t\t\t}\n\t\t\t\t} else { // gecko & webkit\n\t\t\t\t\tcaretPosition = textarea.selectionStart;\n\n\t\t\t\t\tselection = textarea.value.substring(caretPosition, textarea.selectionEnd);\n\t\t\t\t}\n\t\t\t\treturn selection;\n\t\t\t}\n\n\t\t\t// open preview window\n\t\t\tfunction preview() {\n\t\t\t\tif (typeof options.previewHandler === 'function') {\n\t\t\t\t\tpreviewWindow = true;\n\t\t\t\t} else if (options.previewInElement) {\n\t\t\t\t\tpreviewWindow = $(options.previewInElement);\n\t\t\t\t} else if (!previewWindow || previewWindow.closed) {\n\t\t\t\t\tif (options.previewInWindow) {\n\t\t\t\t\t\tpreviewWindow = window.open('', 'preview', options.previewInWindow);\n\t\t\t\t\t\t$(window).unload(function() {\n\t\t\t\t\t\t\tpreviewWindow.close();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tiFrame = $('<iframe class=\"markItUpPreviewFrame\"></iframe>');\n\t\t\t\t\t\tif (options.previewPosition == 'after') {\n\t\t\t\t\t\t\tiFrame.insertAfter(footer);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tiFrame.insertBefore(header);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpreviewWindow = iFrame[iFrame.length - 1].contentWindow || frame[iFrame.length - 1];\n\t\t\t\t\t}\n\t\t\t\t} else if (altKey === true) {\n\t\t\t\t\tif (iFrame) {\n\t\t\t\t\t\tiFrame.remove();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpreviewWindow.close();\n\t\t\t\t\t}\n\t\t\t\t\tpreviewWindow = iFrame = false;\n\t\t\t\t}\n\t\t\t\tif (!options.previewAutoRefresh) {\n\t\t\t\t\trefreshPreview();\n\t\t\t\t}\n\t\t\t\tif (options.previewInWindow) {\n\t\t\t\t\tpreviewWindow.focus();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// refresh Preview window\n\t\t\tfunction refreshPreview() {\n \t\t\t\trenderPreview();\n\t\t\t}\n\n\t\t\tfunction renderPreview() {\n\t\t\t\tvar phtml;\n\t\t\t\tif (options.previewHandler && typeof options.previewHandler === 'function') {\n\t\t\t\t\toptions.previewHandler( $$.val() );\n\t\t\t\t} else if (options.previewParser && typeof options.previewParser === 'function') {\n\t\t\t\t\tvar data = options.previewParser( $$.val() );\n\t\t\t\t\twriteInPreview(localize(data, 1) );\n\t\t\t\t} else if (options.previewParserPath !== '') {\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\tdataType: 'text',\n\t\t\t\t\t\tglobal: false,\n\t\t\t\t\t\turl: options.previewParserPath,\n\t\t\t\t\t\tdata: options.previewParserVar+'='+encodeURIComponent($$.val()),\n\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\twriteInPreview( localize(data, 1) );\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (!template) {\n\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\turl: options.previewTemplatePath,\n\t\t\t\t\t\t\tdataType: 'text',\n\t\t\t\t\t\t\tglobal: false,\n\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\twriteInPreview( localize(data, 1).replace(/<!-- content -->/g, $$.val()) );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfunction writeInPreview(data) {\n\t\t\t\tif (options.previewInElement) {\n\t\t\t\t\t$(options.previewInElement).html(data);\n\t\t\t\t} else if (previewWindow && previewWindow.document) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tsp = previewWindow.document.documentElement.scrollTop\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tsp = 0;\n\t\t\t\t\t}\n\t\t\t\t\tpreviewWindow.document.open();\n\t\t\t\t\tpreviewWindow.document.write(data);\n\t\t\t\t\tpreviewWindow.document.close();\n\t\t\t\t\tpreviewWindow.document.documentElement.scrollTop = sp;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set keys pressed\n\t\t\tfunction keyPressed(e) {\n\t\t\t\tshiftKey = e.shiftKey;\n\t\t\t\taltKey = e.altKey;\n\t\t\t\tctrlKey = (!(e.altKey && e.ctrlKey)) ? (e.ctrlKey || e.metaKey) : false;\n\n\t\t\t\tif (e.type === 'keydown') {\n\t\t\t\t\tif (ctrlKey === true) {\n\t\t\t\t\t\tli = $('a[accesskey=\"'+((e.keyCode == 13) ? '\\\\n' : String.fromCharCode(e.keyCode))+'\"]', header).parent('li');\n\t\t\t\t\t\tif (li.length !== 0) {\n\t\t\t\t\t\t\tctrlKey = false;\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tli.triggerHandler('mouseup');\n\t\t\t\t\t\t\t},1);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (e.keyCode === 13 || e.keyCode === 10) { // Enter key\n\t\t\t\t\t\tif (ctrlKey === true) {  // Enter + Ctrl\n\t\t\t\t\t\t\tctrlKey = false;\n\t\t\t\t\t\t\tmarkup(options.onCtrlEnter);\n\t\t\t\t\t\t\treturn options.onCtrlEnter.keepDefault;\n\t\t\t\t\t\t} else if (shiftKey === true) { // Enter + Shift\n\t\t\t\t\t\t\tshiftKey = false;\n\t\t\t\t\t\t\tmarkup(options.onShiftEnter);\n\t\t\t\t\t\t\treturn options.onShiftEnter.keepDefault;\n\t\t\t\t\t\t} else { // only Enter\n\t\t\t\t\t\t\tmarkup(options.onEnter);\n\t\t\t\t\t\t\treturn options.onEnter.keepDefault;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (e.keyCode === 9) { // Tab key\n\t\t\t\t\t\tif (shiftKey == true || ctrlKey == true || altKey == true) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (caretOffset !== -1) {\n\t\t\t\t\t\t\tget();\n\t\t\t\t\t\t\tcaretOffset = $$.val().length - caretOffset;\n\t\t\t\t\t\t\tset(caretOffset, 0);\n\t\t\t\t\t\t\tcaretOffset = -1;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmarkup(options.onTab);\n\t\t\t\t\t\t\treturn options.onTab.keepDefault;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction remove() {\n\t\t\t\t$$.unbind(\".markItUp\").removeClass('markItUpEditor');\n\t\t\t\t$$.parent('div').parent('div.markItUp').parent('div').replaceWith($$);\n\t\t\t\t$$.data('markItUp', null);\n\t\t\t}\n\n\t\t\tinit();\n\t\t});\n\t};\n\n\t$.fn.markItUpRemove = function() {\n\t\treturn this.each(function() {\n\t\t\t\t$(this).markItUp('remove');\n\t\t\t}\n\t\t);\n\t};\n\n\t$.markItUp = function(settings) {\n\t\tvar options = { target:false };\n\t\t$.extend(options, settings);\n\t\tif (options.target) {\n\t\t\treturn $(options.target).each(function() {\n\t\t\t\t$(this).focus();\n\t\t\t\t$(this).trigger('insertion', [options]);\n\t\t\t});\n\t\t} else {\n\t\t\t$('textarea').trigger('insertion', [options]);\n\t\t}\n\t};\n})(jQuery);\n"]}]}