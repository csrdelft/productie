{"version":3,"sources":["webpack:///./js/lib/bbcode.ts"],"names":["initBbPreviewBtn","el","previewId","dataset","bbpreviewBtn","Error","source","document","querySelector","target","addEventListener","CsrBBPreviewEl","initBbPreview","bbpreview","event","key","params","bbcode","value","trim","innerHTML","style","display","a","post","Object","assign","data","encodeURIComponent","then","response","catch","error","alert","loadBbImage","content","getAttribute","onerror","setAttribute","width","height","classList","replace","src","_a","_b","foto","indexOf","video","parentElement","contains","hasAnchor","closest","length","parent","replaceChild","targetUrl","link","appendChild","activeerLidHints","textarea","editor","textcomplete","register","match","label","search","template","index","on","dropdown","items","activate","term","callback","ajax","encodeURI","done","fail"],"mappings":"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","file":"js/bbcode.3ab3e95d4b2d7de0d465.chunk.js","sourcesContent":["import axios from 'axios';\nimport $ from 'jquery';\nimport { Textarea, Textcomplete } from 'textcomplete';\nimport { init } from '../ctx';\nimport { html, preloadImage } from './util';\nexport const initBbPreviewBtn = (el) => {\n    const previewId = el.dataset.bbpreviewBtn;\n    if (!previewId) {\n        throw new Error('Geen previewId gevonden');\n    }\n    const source = document.querySelector('#' + previewId);\n    const target = document.querySelector('#preview_' + previewId);\n    if (!source || !target) {\n        throw new Error('Bbpreview van niet bestaande elementen');\n    }\n    el.addEventListener('click', () => CsrBBPreviewEl(source, target));\n};\nexport const initBbPreview = (el) => {\n    const previewId = el.dataset.bbpreview;\n    if (!previewId) {\n        throw new Error('Geen previewId gevonden');\n    }\n    const target = document.querySelector('#preview_' + previewId);\n    if (!target) {\n        throw new Error('Geen target gevonden voor bbpreview');\n    }\n    el.addEventListener('keyup', (event) => {\n        if (event.key === 'Enter') { // enter\n            CsrBBPreviewEl(el, target);\n        }\n    });\n};\nexport const CsrBBPreviewEl = (source, target, params = {}) => {\n    const bbcode = source.value;\n    if (bbcode.trim() === '') {\n        target.innerHTML = '';\n        target.style.display = 'none';\n        return;\n    }\n    axios.post('/tools/bbcode', Object.assign({ data: encodeURIComponent(bbcode) }, params)).then((response) => {\n        target.innerHTML = response.data;\n        init(target);\n        target.style.display = 'block';\n    }).catch((error) => {\n        alert(error);\n    });\n};\nexport const loadBbImage = (el) => {\n    const content = html `<img\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bb-img\"\n\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"${el.getAttribute('title')}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"${el.getAttribute('style')}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsrc=\"${el.getAttribute('src')}\"/>`;\n    content.onerror = () => {\n        el.setAttribute('title', 'Afbeelding bestaat niet of is niet toegankelijk!');\n        el.setAttribute('src', '/plaetjes/famfamafm/picture_error.png');\n        el.style.width = '16px';\n        el.style.height = '16px';\n        el.classList.replace('bb-img-loading', 'bb-img');\n    };\n    const src = el.getAttribute('src');\n    if (!src) {\n        throw new Error('Bb image heeft geen src');\n    }\n    preloadImage(src, () => {\n        var _a, _b;\n        const foto = src.indexOf('/plaetjes/fotoalbum/') >= 0;\n        const video = (_b = (_a = el.parentElement) === null || _a === void 0 ? void 0 : _a.parentElement) === null || _b === void 0 ? void 0 : _b.classList.contains('bb-video-preview');\n        const hasAnchor = $(el).closest('a').length !== 0;\n        const parent = el.parentElement;\n        if (!parent) {\n            throw new Error(\"BBimage heeft geen parent.\");\n        }\n        if (foto || video || hasAnchor) {\n            parent.replaceChild(content, el);\n        }\n        else {\n            const targetUrl = el.getAttribute('bb-href') == null ? el.getAttribute('src') : el.getAttribute('bb-href');\n            const link = html `<a class=\"lightbox-link\" href=\"${targetUrl}\" data-lightbox=\"page-lightbox\"></a>`;\n            link.appendChild(content);\n            parent.replaceChild(link, el);\n        }\n    });\n};\nexport function activeerLidHints(textarea) {\n    const editor = new Textarea(textarea);\n    const textcomplete = new Textcomplete(editor);\n    textcomplete.register([{\n            // @...\n            match: /(^|\\s|])@((?:[^ ]+ ?){1,5})$/,\n            replace(data) {\n                return '$1[lid=' + data.label + ']';\n            },\n            search,\n            template,\n        }, {\n            // [citaat=... of [lid=...\n            index: 3,\n            match: /(^|\\s|])\\[(citaat|lid)=(?:[0-9]{4}|([^\\]]+))$/,\n            search,\n            template,\n            replace(data) {\n                return '$1[$2=' + data.label;\n            },\n        }]);\n    textcomplete.on('rendered', () => {\n        if (textcomplete.dropdown.items.length >= 1) {\n            // Activeer eerste keuze standaard\n            textcomplete.dropdown.items[0].activate();\n        }\n    });\n}\nfunction search(term, callback) {\n    if (!term || term.length === 1) {\n        callback([]);\n    }\n    else {\n        $.ajax('/tools/naamsuggesties?vorm=user&zoekin=voorkeur&q=' + encodeURI(term))\n            .done((data) => {\n            callback(data);\n        })\n            .fail(() => {\n            callback([]);\n        });\n    }\n}\nfunction template(data) {\n    return data.value;\n}\n"],"sourceRoot":""}