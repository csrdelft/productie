(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{238:function(e,t,i){"use strict";i.r(t);var a=i(12),s=i.n(a),o=i(191),r=i(184),n=i(188),g=i(0),l=i.n(g),d=i(3),c=i(9);t.default=e=>class extends e{constructor(e,t){super(e,t),this.tagMode=!1,this.root=t.root,this.tagContainer=Object(r.a)('<div class="tag-container"></div>'),this.previewElement.appendChild(this.tagContainer);const i=Object(r.a)('<i class="fa fa-smile"></i>'),a=Object(r.a)('<span class="j-gallery-icon"></span>',{children:[i]});Object(n.a)(a,{style:{color:t.backgroundColor,background:t.textColor,transform:"translateY(-8px)"},content:"Leden etiketteren"}),this.appendControlsElements([a]),window.addEventListener("keydown",e=>{"Delete"===e.key?this.activeTag&&this.removeTag(this.activeTag):"Escape"===e.key&&(e.preventDefault(),this.tagMode&&(this.tagFormDiv?this.exitTagForm():this.moveTagDivs()))}),window.addEventListener("resize",()=>{this.moveTagDivs(),this.tagMode?(this.duringTagMode(),this.tagFormDiv&&this.moveTagForm()):this.tagFormDiv&&this.exitTagForm()}),a.addEventListener("click",()=>{this.tagMode?(this.tagMode=!1,i.classList.replace("fa-toggle-on","fa-toggle-off"),this.hideTags(),this.tagFormDiv&&this.exitTagForm(),this.imageElement.style.cursor="",this.left.style.display="block",this.right.style.display="block"):(this.tagMode=!0,i.classList.replace("fa-toggle-off","fa-toggle-on"),this.duringTagMode())}),a.addEventListener("mouseenter",()=>{this.tagMode?i.classList.replace("fa-toggle-off","fa-toggle-on"):i.classList.replace("fa-toggle-on","fa-toggle-off")}),a.addEventListener("mouseleave",()=>{i.classList.remove("fa-toggle-on","fa-toggle-off"),i.classList.add("fa-smile")});const s=Object(c.b)(".j-gallery-screen-icon",this.getElement());if(!s)throw new Error("Geen screenIcon gevonden");s.addEventListener("click",()=>{this.preview.size!==o.a.contain?this.tagContainer.querySelectorAll(".fototag").forEach(e=>e.classList.add("verborgen")):this.tagContainer.querySelectorAll(".fototag").forEach(e=>e.classList.remove("verborgen"))})}get imageElement(){return Object(c.b)(".j-gallery-preview-content",this.previewElement)}get left(){return Object(c.b)(".j-gallery-left",this.previewElement)}get right(){return Object(c.b)(".j-gallery-right",this.previewElement)}goToItem(e){return this.currentItem=e,super.goToItem(e).then(()=>{this.tagMode&&this.duringTagMode(),this.loadTags()})}moveTagDivs(){this.tagContainer.querySelectorAll(".fototag").forEach(e=>{var t;return this.moveTag(e,JSON.parse(null!==(t=e.dataset.tag)&&void 0!==t?t:"{}"))})}moveTag(e,t){const i=this.getScreenPos(t);e.style.height=i.size+"px",e.style.left=i.x-i.size/2+"px",e.style.top=i.y-i.size/2+"px",e.style.width=i.size+"px"}moveTagForm(){var e;if(!this.tagFormDiv)return;const t=this.getScreenPos(JSON.parse(null!==(e=this.tagFormDiv.dataset.tagPosition)&&void 0!==e?e:"{}"));this.tagFormDiv.style.left=t.x-t.size/2+"px",this.tagFormDiv.style.top=t.y+t.size+"px"}getUrl(){return this.currentItem.fullUrl.replace(this.root,"")}loadTags(){this.tagContainer.innerHTML="";const e=this.getUrl(),t=new FormData;t.append("foto",Object(d.a)(decodeURI(e))),s.a.post("/fotoalbum/gettags"+Object(d.b)(e),t).then(e=>this.drawTags(e.data))}drawTags(e){if(this.tagContainer.innerHTML="",Array.isArray(e))for(const t of e)this.drawTag(t)}getScreenPos(e){if(null==this.imageElement)return{size:0,x:0,y:0};const t=this.imageElement.parentElement;if(!t)throw new Error("ImageElement niet in DOM");const i=this.imageElement.clientWidth,a=this.imageElement.clientHeight,s=(t.clientWidth-i)/2,o=(t.clientHeight-a)/2;return{size:(i+a)/200*e.size,x:e.x*i/100+s,y:e.y*a/100+o}}removeTag(e){var t;if(confirm("Etiket verwijderen?")){const i=JSON.parse(null!==(t=e.dataset.tag)&&void 0!==t?t:"{}"),a=new FormData;a.append("refuuid",i.refuuid),a.append("keyword",i.keyword),s.a.post("/fotoalbum/removetag",a).then(e=>this.drawTags(e.data))}}drawTag(e){const t=this.getScreenPos(e),i=Object(r.a)(`<div id="${e.keyword}" class="fototag" title="${e.name}"></div>`,{style:{height:t.size+"px",left:t.x-t.size/2+"px",top:t.y-t.size/2+"px",width:t.size+"px"}});this.tagContainer.appendChild(i),this.tagMode&&i.classList.add("showborder"),i.dataset.tag=JSON.stringify(e),i.addEventListener("click",()=>{this.activeTag&&this.activeTag.classList.remove("active"),this.activeTag=i,i.classList.add("active")});const a=Object(r.a)('<div id="tagMenu" class="dropdown-menu" role="menu"></div>',{style:{position:"fixed",top:"0",left:"0"}}),s=Object(r.a)('<a id="btnDelTag" tabindex="-1" class="dropdown-item"><i class="fa fa-user-times"></i>&nbsp;Etiket verwijderen</a>');return a.appendChild(s),i.appendChild(a),s.addEventListener("click",()=>this.removeTag(i)),i.addEventListener("contextmenu",e=>{e.preventDefault(),a.style.display="block",a.style.transform=`translate(${e.clientX}px, ${e.clientY}px)`},!0),document.addEventListener("mouseup",()=>{a.style.display="none"}),this.preview.size!==o.a.contain?i.classList.add("verborgen"):i.classList.remove("verborgen"),i}showTags(){this.tagContainer.querySelectorAll(".fototag").forEach(e=>e.classList.add("showborder"))}hideTags(){this.tagContainer.querySelectorAll(".fototag").forEach(e=>e.classList.remove("showborder"))}exitTagForm(){this.tagFormDiv&&this.tagFormDiv.remove(),this.tagFormDiv=null}duringTagMode(){this.preview.size!==o.a.contain&&alert("Je kunt niet inzoomen tijdens het etiketteren, dat werkt nog niet."),this.tagFormDiv&&this.exitTagForm(),this.showTags();const e=this.previewElement.querySelector(".j-gallery-left"),t=this.previewElement.querySelector(".j-gallery-right");e.style.display="none",t.style.display="none";const i=this.imageElement;i.style.cursor="crosshair",i.removeEventListener("click",this.newTagStart.bind(this)),i.addEventListener("click",this.newTagStart.bind(this))}addTag(e){const t=this.getUrl(),i=new FormData;i.append("foto",Object(d.a)(decodeURI(t))),i.append("x",Math.round(e.x).toString()),i.append("y",Math.round(e.y).toString()),i.append("size",Math.round(e.size).toString()),s.a.post("/fotoalbum/addtag"+Object(d.b)(t),i).then(t=>{"object"==typeof t.data?this.drawTags(t.data):this.drawTagForm(t.data,e)})}drawTagForm(e,t){const i=this.getScreenPos(t);this.tagFormDiv=Object(r.a)(e,{style:{left:i.x-i.size/2+"px",position:"absolute",top:i.y+i.size/2+"px",zIndex:"10000"}}),this.getElement().appendChild(this.tagFormDiv);const a=this.tagFormDiv.querySelectorAll("script");for(const e of a)l.a.globalEval(e.innerText);this.tagFormDiv.dataset.tagPosition=JSON.stringify(t);const s=this.tagFormDiv.querySelector("form");if(!s)throw new Error("tag div bevat geen form");l()(s).data("submitCallback",e=>{this.tagFormDiv&&this.exitTagForm(),"object"==typeof e?this.drawTags(e):this.drawTagForm(e,t)}),setTimeout(()=>{if(this.tagFormDiv){const e=this.tagFormDiv.querySelector('input[name="uid"]');if(!e)throw new Error("tagFormDiv bevat input met name uid");e.dispatchEvent(new Event("focus"))}})}newTagStart(e){const t=this.imageElement,i=e.target,a=l()(i).offset();if(!a)throw new Error("Tag target heeft geen offset");const s=t.clientWidth,o=t.clientHeight,r={keyword:"New",name:"",size:7,x:100*(e.pageX-a.left)/s,y:100*(e.pageY-a.top)/o};this.tagFormDiv&&this.exitTagForm(),this.addTag(r);const n=this.drawTag(r);n.removeEventListener("click.tag",()=>({})),n.style.cursor="nw-resize";const g=this.imageElement;let d=0,c=0;const h=e=>{if(r.size+=100*(e.pageX-d)/g.clientWidth,r.size+=100*(e.pageY-c)/g.clientHeight,d=e.pageX,c=e.pageY,r.size<1?r.size=1:r.size>99&&(r.size=99),this.tagFormDiv){this.tagFormDiv.querySelector('input[name="size"]').value=String(Math.round(r.size))}this.moveTag(n,r),n.dataset.size=String(r.size)};document.addEventListener("mouseup",()=>document.removeEventListener("mousemove",h)),n.addEventListener("mousedown",e=>{d=e.pageX,c=e.pageY,document.addEventListener("mousemove",h)})}}}}]);
//# sourceMappingURL=fotoalbum-with-tags.42a276ee8e8d6a85a209.chunk.js.map