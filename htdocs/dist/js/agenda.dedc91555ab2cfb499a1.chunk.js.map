{"version":3,"sources":["webpack:///./js/page/agenda.ts"],"names":["fmt","date","format","calendarEl","document","getElementById","Error","jaar","maand","weergave","creator","dataset","defaultView","week","dag","agenda","editable","options","plugins","height","nowIndicator","locale","customButtons","nieuw","text","click","datum","calendar","getDate","begin_moment","eind_moment","bewerken","setOption","refetchEvents","setTimeout","button","querySelector","classList","add","remove","eventDataTransform","event","header","left","center","right","defaultDate","Date","Number","firstDay","events","selectable","select","selectionInfo","start","end","eventClick","info","a","get","id","getFullYear","then","response","card","data","style","zIndex","position","addEventListener","body","append","init","el","placement","clickListener","e","contains","target","removeEventListener","dropInfo","post","resizeInfo","addHandler","render","on"],"mappings":"0FAAA,gKAeA,MACMA,EAAOC,GAAS,IAAOA,GAAMC,OADZ,uBAEjBC,EAAaC,SAASC,eAAe,UAC3C,GAAkB,MAAdF,EACA,MAAM,IAAIG,MAAM,gCAEpB,MAAM,KAAEC,EAAI,MAAEC,EAAK,SAAEC,EAAQ,QAAEC,GAAYP,EAAWQ,QACtD,GAAY,MAARJ,GAAyB,MAATC,GAA6B,MAAZC,GAA+B,MAAXC,EACrD,MAAM,IAAIJ,MAAM,4BAEpB,MAAMM,EAAc,CAChBJ,MAAO,eACPK,KAAM,eACNC,IAAK,cACLC,OAAQ,aACVN,GACF,IAAIO,GAAW,EACf,MAAMC,EAAU,CACZC,QAAS,CAAC,IAAe,IAAgB,IAAY,KACrDC,OAAQ,OACRC,cAAc,EACdR,cACAS,OAAQ,IACRC,cAAe,CACXC,MAAO,CACHC,KAAM,QACNC,MAAO,KACH,MAAMC,EAAQ1B,EAAI2B,EAASC,WAC3B,YAAY,OAAQ,oBAAqB,CACrCC,aAAcH,EACdI,YAAaJ,IACd,EAAO,OAGlBK,SAAU,CACNP,KAAM,WACN,QACIR,GAAYA,EACZW,EAASK,UAAU,WAAYhB,GAC/BW,EAASK,UAAU,aAAchB,GACjCW,EAASM,gBAETC,WAAW,KACP,MAAMC,EAAShC,EAAWiC,cAAc,uBACpCpB,EACAmB,EAAOE,UAAUC,IAAI,oBAGrBH,EAAOE,UAAUE,OAAO,yBAM5CC,mBAAqBC,KACM,IAAnBA,EAAMzB,WACNyB,EAAMzB,SAAWA,GAEdyB,GAEXC,OAAQ,CACJC,KAAM,kDACNC,OAAQ,QACRC,MAAO,qCAEXC,YAAa,IAAIC,KAAKC,OAAOzC,GAAOyC,OAAOxC,GAAS,GACpDyC,SAAU,EACVC,OAAQ,eACRC,WAAYnC,GAAwB,SAAZN,EACxB0C,OAASC,IACL,YAAY,OAAQ,oBAAqB,CACrCxB,aAAc7B,EAAIqD,EAAcC,OAChCxB,YAAa9B,EAAIqD,EAAcE,OAChC,EAAO,MAEdC,WAAaC,IACT,EAAAC,EAAMC,IAAI,mBAAmBF,EAAKhB,MAAMmB,WAAYH,EAAKhB,MAAMa,MAAMO,iBAAkBC,KAAMC,IACzF,MAAMC,EAAO,YAAUD,EAASE,MAAM,GACtCD,EAAKE,MAAMC,OAAS,MACpBH,EAAKE,MAAME,SAAW,WACtBJ,EAAK5B,cAAc,UAAUiC,iBAAiB,QAAS,KACnDL,EAAKzB,UACE,IAEXnC,SAASkE,KAAKC,OAAOP,GACrB,IAAIQ,KAAKR,GAET,IAAI,UAAOP,EAAKgB,GAAIT,EAAM,CAAEU,UAAW,WAEvCxC,WAAW,KACP,MAAMyC,EAAiBC,IACdZ,EAAKa,SAASD,EAAEE,UACjBd,EAAKzB,SACLnC,SAASkE,KAAKS,oBAAoB,QAASJ,KAGnDvE,SAASkE,KAAKD,iBAAiB,QAASM,QAIpD,UAAUK,GACN,EAAAtB,EAAMuB,KAAK,uBAAuBD,EAASvC,MAAMmB,GAAM,CACnD/B,aAAc7B,EAAIgF,EAASvC,MAAMa,OACjCxB,YAAa9B,EAAIgF,EAASvC,MAAMc,OACjCO,KAAK,IAAMnC,EAASM,kBAE3B,YAAYiD,GACR,EAAAxB,EAAMuB,KAAK,uBAAuBC,EAAWzC,MAAMmB,GAAM,CACrD/B,aAAc7B,EAAIkF,EAAWzC,MAAMa,OACnCxB,YAAa9B,EAAIkF,EAAWzC,MAAMc,OACnCO,KAAK,IAAMnC,EAASM,mBAK/B,GAFA,IAAIkD,WAAW,gBAAkBV,GAAOA,EAAGJ,iBAAiB,QAAS,IAAMnC,WAAW,IAAMP,EAASM,mBAErF,SAAZvB,EAAoB,CACpB,MAAMgC,EAASzB,EAAQyB,OACvBA,EAAOG,MAAQ,kBAAoBH,EAAOG,MAE9C,MAAMlB,EAAW,IAAI,IAASxB,EAAYc,GAC1CU,EAASyD,SACT,IAAEhF,SAASkE,MAAMe,GAAG,aAAc,IAAM1D,EAASM","file":"js/agenda.dedc91555ab2cfb499a1.chunk.js","sourcesContent":["import { Calendar } from '@fullcalendar/core';\n// @ts-ignore\nimport nlLocale from '@fullcalendar/core/locales/nl';\nimport dayGridPlugin from '@fullcalendar/daygrid';\nimport interaction from '@fullcalendar/interaction';\nimport listPlugin from '@fullcalendar/list';\nimport timeGridPlugin from '@fullcalendar/timegrid';\nimport axios from 'axios';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport Popper from 'popper.js';\nimport ctx from '../ctx';\nimport { ajaxRequest } from '../lib/ajax';\nimport { domUpdate } from '../lib/domUpdate';\nimport { htmlParse } from '../lib/util';\nconst dateTimeFormat = 'YYYY-MM-DD HH:mm:ss';\nconst fmt = (date) => moment(date).format(dateTimeFormat);\nconst calendarEl = document.getElementById('agenda');\nif (calendarEl == null) {\n    throw new Error('Agenda element niet gevonden');\n}\nconst { jaar, maand, weergave, creator } = calendarEl.dataset;\nif (jaar == null || maand == null || weergave == null || creator == null) {\n    throw new Error('Agenda opties niet gezet');\n}\nconst defaultView = {\n    maand: 'dayGridMonth',\n    week: 'timeGridWeek',\n    dag: 'timeGridDay',\n    agenda: 'listMonth',\n}[weergave];\nlet editable = false;\nconst options = {\n    plugins: [dayGridPlugin, timeGridPlugin, listPlugin, interaction],\n    height: 'auto',\n    nowIndicator: true,\n    defaultView,\n    locale: nlLocale,\n    customButtons: {\n        nieuw: {\n            text: 'Nieuw',\n            click: () => {\n                const datum = fmt(calendar.getDate());\n                ajaxRequest('POST', '/agenda/toevoegen', {\n                    begin_moment: datum,\n                    eind_moment: datum,\n                }, false, domUpdate);\n            },\n        },\n        bewerken: {\n            text: 'Bewerken',\n            click() {\n                editable = !editable;\n                calendar.setOption('editable', editable);\n                calendar.setOption('selectable', editable);\n                calendar.refetchEvents();\n                // De button wordt ververst door fullcalendar, zorg ervoor dat de laatste wordt gepakt.\n                setTimeout(() => {\n                    const button = calendarEl.querySelector('.fc-bewerken-button');\n                    if (editable) {\n                        button.classList.add('fc-button-active');\n                    }\n                    else {\n                        button.classList.remove('fc-button-active');\n                    }\n                });\n            },\n        },\n    },\n    eventDataTransform: (event) => {\n        if (event.editable === true) {\n            event.editable = editable;\n        }\n        return event;\n    },\n    header: {\n        left: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth',\n        center: 'title',\n        right: 'today prevYear,prev,next,nextYear',\n    },\n    defaultDate: new Date(Number(jaar), Number(maand) - 1),\n    firstDay: 0,\n    events: '/agenda/feed',\n    selectable: editable && creator === 'true',\n    select: (selectionInfo) => {\n        ajaxRequest('POST', '/agenda/toevoegen', {\n            begin_moment: fmt(selectionInfo.start),\n            eind_moment: fmt(selectionInfo.end),\n        }, false, domUpdate);\n    },\n    eventClick: (info) => {\n        axios.get(`/agenda/details/${info.event.id}?jaar=${(info.event.start.getFullYear())}`).then((response) => {\n            const card = htmlParse(response.data)[0];\n            card.style.zIndex = '100';\n            card.style.position = 'absolute';\n            card.querySelector('.close').addEventListener('click', () => {\n                card.remove();\n                return false;\n            });\n            document.body.append(card);\n            ctx.init(card);\n            // tslint:disable-next-line:no-unused-expression\n            new Popper(info.el, card, { placement: 'bottom' });\n            // Na deze klik een event listener\n            setTimeout(() => {\n                const clickListener = (e) => {\n                    if (!card.contains(e.target)) {\n                        card.remove();\n                        document.body.removeEventListener('click', clickListener);\n                    }\n                };\n                document.body.addEventListener('click', clickListener);\n            });\n        });\n    },\n    eventDrop(dropInfo) {\n        axios.post(`/agenda/verplaatsen/${dropInfo.event.id}`, {\n            begin_moment: fmt(dropInfo.event.start),\n            eind_moment: fmt(dropInfo.event.end),\n        }).then(() => calendar.refetchEvents());\n    },\n    eventResize(resizeInfo) {\n        axios.post(`/agenda/verplaatsen/${resizeInfo.event.id}`, {\n            begin_moment: fmt(resizeInfo.event.start),\n            eind_moment: fmt(resizeInfo.event.end),\n        }).then(() => calendar.refetchEvents());\n    },\n};\nctx.addHandler('.ReloadAgenda', (el) => el.addEventListener('click', () => setTimeout(() => calendar.refetchEvents())));\n// Creator krijgt nieuw knoppen\nif (creator === 'true') {\n    const header = options.header;\n    header.right = 'bewerken,nieuw ' + header.right;\n}\nconst calendar = new Calendar(calendarEl, options);\ncalendar.render();\n$(document.body).on('modalClose', () => calendar.refetchEvents());\n"],"sourceRoot":""}