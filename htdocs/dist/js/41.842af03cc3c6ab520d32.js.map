{"version":3,"sources":["webpack:///./js/fotoalbum/with-tags.ts"],"names":["constructor","albums","params","super","this","tagMode","root","tagContainer","previewElement","appendChild","tagIcon","tagButton","children","style","color","backgroundColor","background","textColor","transform","content","appendControlsElements","window","addEventListener","event","key","activeTag","removeTag","preventDefault","tagFormDiv","exitTagForm","moveTagDivs","duringTagMode","moveTagForm","classList","add","remove","hideTags","imageElement","cursor","left","display","right","getElement","querySelector","preview","size","contain","querySelectorAll","forEach","tag","item","currentItem","goToItem","then","loadTags","t","moveTag","JSON","parse","dataset","pos","getScreenPos","height","x","top","y","width","tagPosition","fullUrl","replace","innerHTML","url","getUrl","data","FormData","append","decodeURI","a","post","response","drawTags","tags","Array","isArray","drawTag","position","parent","parentElement","w","clientWidth","h","clientHeight","fotoTopLeft","tagDiv","confirm","refuuid","keyword","screenPosition","name","stringify","tagMenu","btnDelTag","e","clientX","clientY","document","alert","showTags","img","removeEventListener","newTagStart","bind","Math","round","toString","drawTagForm","formHtml","zIndex","scripts","script","globalEval","innerText","setTimeout","dispatchEvent","Event","target","offset","newTag","pageX","pageY","addTag","imgActive","prevX","prevY","windowMouseMoveListener","e2","value","String","e1"],"mappings":"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","file":"js/41.842af03cc3c6ab520d32.js","sourcesContent":["import axios from 'axios';\nimport { Size } from 'jgallery/src/preview';\nimport createElement from 'jgallery/src/utils/create-element';\nimport withTooltip from 'jgallery/src/utils/with-tooltip';\nimport $ from 'jquery';\nimport { basename, dirname } from '../util';\nconst withTags = (constructor) => class extends constructor {\n    constructor(albums, params) {\n        super(albums, params);\n        this.tagMode = false;\n        this.root = params.root;\n        this.tagContainer = createElement(`<div class=\"tag-container\"></div>`);\n        this.previewElement.appendChild(this.tagContainer);\n        const tagIcon = createElement('<i class=\"fa fa-smile\"></i>');\n        const tagButton = createElement(`<span class=\"j-gallery-icon\"></span>`, {\n            children: [tagIcon],\n        });\n        withTooltip(tagButton, {\n            style: {\n                color: params.backgroundColor,\n                background: params.textColor,\n                transform: 'translateY(-8px)',\n            },\n            content: 'Leden etiketteren',\n        });\n        this.appendControlsElements([tagButton]);\n        window.addEventListener('keydown', (event) => {\n            if (event.key === 'Delete') {\n                if (this.activeTag) {\n                    this.removeTag(this.activeTag);\n                }\n            }\n            else if (event.key === 'Escape') {\n                event.preventDefault();\n                if (this.tagMode) {\n                    if (this.tagFormDiv) {\n                        this.exitTagForm();\n                    }\n                    else {\n                        this.moveTagDivs();\n                    }\n                }\n            }\n        });\n        window.addEventListener('resize', () => {\n            this.moveTagDivs();\n            if (this.tagMode) {\n                this.duringTagMode();\n                if (this.tagFormDiv) {\n                    this.moveTagForm();\n                }\n            }\n            else {\n                if (this.tagFormDiv) {\n                    this.exitTagForm();\n                }\n            }\n        });\n        tagButton.addEventListener('click', () => {\n            if (this.tagMode) {\n                this.tagMode = false;\n                tagIcon.classList.add('fa-toggle-off');\n                tagIcon.classList.remove('fa-toggle-on');\n                this.hideTags();\n                if (this.tagFormDiv) {\n                    this.exitTagForm();\n                }\n                this.imageElement.style.cursor = '';\n                this.left.style.display = 'block';\n                this.right.style.display = 'block';\n            }\n            else {\n                this.tagMode = true;\n                tagIcon.classList.add('fa-toggle-on');\n                tagIcon.classList.remove('fa-toggle-off');\n                this.duringTagMode();\n            }\n        });\n        tagButton.addEventListener('mouseenter', () => {\n            if (this.tagMode) {\n                tagIcon.classList.add('fa-toggle-on');\n                tagIcon.classList.remove('fa-toggle-off');\n            }\n            else {\n                tagIcon.classList.remove('fa-toggle-off');\n                tagIcon.classList.add('fa-toggle-off');\n            }\n        });\n        tagButton.addEventListener('mouseleave', () => {\n            tagIcon.classList.remove('fa-toggle-on', 'fa-toggle-off');\n            tagIcon.classList.add('fa-smile');\n        });\n        this.getElement().querySelector('.j-gallery-screen-icon').addEventListener('click', () => {\n            if (this.preview.size !== Size.contain) {\n                this.tagContainer.querySelectorAll('.fototag').forEach((tag) => tag.classList.add('verborgen'));\n            }\n            else {\n                this.tagContainer.querySelectorAll('.fototag').forEach((tag) => tag.classList.remove('verborgen'));\n            }\n        });\n    }\n    get imageElement() {\n        return this.previewElement.querySelector('.j-gallery-preview-content');\n    }\n    get left() {\n        return this.previewElement.querySelector('.j-gallery-left');\n    }\n    get right() {\n        return this.previewElement.querySelector('.j-gallery-right');\n    }\n    goToItem(item) {\n        this.currentItem = item;\n        return super.goToItem(item).then(() => {\n            if (this.tagMode) {\n                this.duringTagMode();\n            }\n            this.loadTags();\n        });\n    }\n    moveTagDivs() {\n        this.tagContainer.querySelectorAll('.fototag')\n            .forEach((t) => this.moveTag(t, JSON.parse(t.dataset.tag)));\n    }\n    moveTag(t, tag) {\n        const pos = this.getScreenPos(tag);\n        t.style.height = pos.size + 'px';\n        t.style.left = pos.x - pos.size / 2 + 'px';\n        t.style.top = pos.y - pos.size / 2 + 'px';\n        t.style.width = pos.size + 'px';\n    }\n    moveTagForm() {\n        if (!this.tagFormDiv) {\n            return;\n        }\n        const pos = this.getScreenPos(JSON.parse(this.tagFormDiv.dataset.tagPosition));\n        this.tagFormDiv.style.left = pos.x - (pos.size / 2) + 'px';\n        this.tagFormDiv.style.top = pos.y + pos.size + 'px';\n    }\n    getUrl() {\n        return this.currentItem.fullUrl.replace(this.root, '');\n    }\n    loadTags() {\n        this.tagContainer.innerHTML = '';\n        const url = this.getUrl();\n        const data = new FormData();\n        data.append('foto', basename(decodeURI(url)));\n        axios.post('/fotoalbum/gettags' + dirname(url), data)\n            .then((response) => this.drawTags(response.data));\n    }\n    drawTags(tags) {\n        this.tagContainer.innerHTML = '';\n        if (!Array.isArray(tags)) {\n            return;\n        }\n        for (const tag of tags) {\n            this.drawTag(tag);\n        }\n    }\n    getScreenPos(position) {\n        if (this.imageElement == null) {\n            return { size: 0, x: 0, y: 0 };\n        }\n        const parent = this.imageElement.parentElement;\n        const w = this.imageElement.clientWidth;\n        const h = this.imageElement.clientHeight;\n        const fotoTopLeft = {\n            x: (parent.clientWidth - w) / 2,\n            y: (parent.clientHeight - h) / 2,\n        };\n        return {\n            size: (w + h) / 200 * position.size,\n            x: position.x * w / 100 + fotoTopLeft.x,\n            y: position.y * h / 100 + fotoTopLeft.y,\n        };\n    }\n    removeTag(tagDiv) {\n        if (confirm('Etiket verwijderen?')) {\n            const tag = JSON.parse(tagDiv.dataset.tag);\n            const data = new FormData();\n            data.append('refuuid', tag.refuuid);\n            data.append('keyword', tag.keyword);\n            axios\n                .post('/fotoalbum/removetag', data)\n                .then((response) => this.drawTags(response.data));\n        }\n    }\n    drawTag(tag) {\n        const screenPosition = this.getScreenPos(tag);\n        const tagDiv = createElement(`<div id=\"${tag.keyword}\" class=\"fototag\" title=\"${tag.name}\"></div>`, {\n            style: {\n                height: screenPosition.size + 'px',\n                left: screenPosition.x - screenPosition.size / 2 + 'px',\n                top: screenPosition.y - screenPosition.size / 2 + 'px',\n                width: screenPosition.size + 'px',\n            },\n        });\n        this.tagContainer.appendChild(tagDiv);\n        if (this.tagMode) {\n            tagDiv.classList.add('showborder');\n        }\n        tagDiv.dataset.tag = JSON.stringify(tag);\n        tagDiv.addEventListener('click', () => {\n            if (this.activeTag) {\n                this.activeTag.classList.remove('active');\n            }\n            this.activeTag = tagDiv;\n            tagDiv.classList.add('active');\n        });\n        const tagMenu = createElement('<div id=\"tagMenu\" class=\"dropdown-menu\" role=\"menu\"></div>', {\n            style: {\n                position: 'fixed',\n                top: '0',\n                left: '0',\n            },\n        });\n        const btnDelTag = createElement(`<a id=\"btnDelTag\" tabindex=\"-1\" class=\"dropdown-item\"><i class=\"fa fa-user-times\"></i>&nbsp;Etiket verwijderen</a>`);\n        tagMenu.appendChild(btnDelTag);\n        tagDiv.appendChild(tagMenu);\n        btnDelTag.addEventListener('click', () => this.removeTag(tagDiv));\n        tagDiv.addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n            tagMenu.style.display = 'block';\n            tagMenu.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;\n        }, true);\n        document.addEventListener('mouseup', (e) => {\n            tagMenu.style.display = 'none';\n        });\n        if (this.preview.size !== Size.contain) {\n            tagDiv.classList.add('verborgen');\n        }\n        else {\n            tagDiv.classList.remove('verborgen');\n        }\n        return tagDiv;\n    }\n    showTags() {\n        this.tagContainer.querySelectorAll('.fototag').forEach((t) => t.classList.add('showborder'));\n    }\n    hideTags() {\n        this.tagContainer.querySelectorAll('.fototag').forEach((t) => t.classList.remove('showborder'));\n    }\n    exitTagForm() {\n        if (this.tagFormDiv) {\n            this.tagFormDiv.remove();\n        }\n        this.tagFormDiv = null;\n    }\n    duringTagMode() {\n        if (this.preview.size !== Size.contain) {\n            alert('Je kunt niet inzoomen tijdens het etiketteren, dat werkt nog niet.');\n        }\n        if (this.tagFormDiv) {\n            this.exitTagForm();\n        }\n        this.showTags();\n        const left = this.previewElement.querySelector('.j-gallery-left');\n        const right = this.previewElement.querySelector('.j-gallery-right');\n        left.style.display = 'none';\n        right.style.display = 'none';\n        const img = this.imageElement;\n        img.style.cursor = 'crosshair';\n        img.removeEventListener('click', this.newTagStart.bind(this));\n        img.addEventListener('click', this.newTagStart.bind(this));\n    }\n    addTag(position) {\n        const url = this.getUrl();\n        const data = new FormData();\n        data.append('foto', basename(decodeURI(url)));\n        data.append('x', Math.round(position.x).toString());\n        data.append('y', Math.round(position.y).toString());\n        data.append('size', Math.round(position.size).toString());\n        axios.post('/fotoalbum/addtag' + dirname(url), data)\n            .then((response) => {\n            if (typeof response.data === 'object') {\n                this.drawTags(response.data);\n            }\n            else {\n                this.drawTagForm(response.data, position);\n            }\n        });\n    }\n    drawTagForm(formHtml, position) {\n        const pos = this.getScreenPos(position);\n        this.tagFormDiv = createElement(formHtml, {\n            style: {\n                left: pos.x - pos.size / 2 + 'px',\n                position: 'absolute',\n                top: pos.y + pos.size / 2 + 'px',\n                zIndex: '10000',\n            },\n        });\n        this.getElement().appendChild(this.tagFormDiv);\n        const scripts = this.tagFormDiv.querySelectorAll('script');\n        for (const script of scripts) {\n            $.globalEval(script.innerText);\n        }\n        this.tagFormDiv.dataset.tagPosition = JSON.stringify(position);\n        $(this.tagFormDiv.querySelector('form')).data('submitCallback', (response) => {\n            if (this.tagFormDiv) {\n                this.exitTagForm();\n            }\n            if (typeof response === 'object') {\n                this.drawTags(response);\n            }\n            else {\n                this.drawTagForm(response, position);\n            }\n        });\n        setTimeout(() => this.tagFormDiv && this.tagFormDiv.querySelector('input[name=\"uid\"]').dispatchEvent(new Event('focus')));\n    }\n    newTagStart(e) {\n        const img = this.imageElement;\n        const target = e.target;\n        const offset = $(target).offset();\n        const width = img.clientWidth;\n        const height = img.clientHeight;\n        const newTag = {\n            keyword: 'New',\n            name: '',\n            size: 7,\n            x: (e.pageX - offset.left) * 100 / width,\n            y: (e.pageY - offset.top) * 100 / height,\n        };\n        if (this.tagFormDiv) {\n            this.exitTagForm();\n        }\n        this.addTag(newTag);\n        const tagDiv = this.drawTag(newTag);\n        tagDiv.removeEventListener('click.tag', () => ({}));\n        tagDiv.style.cursor = 'nw-resize';\n        const imgActive = this.imageElement;\n        let prevX = 0;\n        let prevY = 0;\n        const windowMouseMoveListener = (e2) => {\n            newTag.size += (e2.pageX - prevX) * 100 / imgActive.clientWidth;\n            newTag.size += (e2.pageY - prevY) * 100 / imgActive.clientHeight;\n            prevX = e2.pageX;\n            prevY = e2.pageY;\n            if (newTag.size < 1) {\n                newTag.size = 1;\n            }\n            else if (newTag.size > 99) {\n                newTag.size = 99;\n            }\n            if (this.tagFormDiv) {\n                const sizeInput = this.tagFormDiv.querySelector('input[name=\"size\"]');\n                sizeInput.value = String(Math.round(newTag.size));\n            }\n            this.moveTag(tagDiv, newTag);\n            tagDiv.dataset.size = String(newTag.size);\n        };\n        document.addEventListener('mouseup', () => document.removeEventListener('mousemove', windowMouseMoveListener));\n        tagDiv.addEventListener('mousedown', (e1) => {\n            prevX = e1.pageX;\n            prevY = e1.pageY;\n            document.addEventListener('mousemove', windowMouseMoveListener);\n        });\n    }\n};\nexport default withTags;\n"],"sourceRoot":""}