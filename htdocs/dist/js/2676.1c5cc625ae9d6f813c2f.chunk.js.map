{"version":3,"file":"js/2676.1c5cc625ae9d6f813c2f.chunk.js","mappings":"8MAAA,MAsBA,EAtB4BA,IACxB,MAAMC,EAAkB,GACxB,IAAIC,EACJ,MAAMC,EAAYC,GAAaH,EAAgBI,KAAKD,GAC9CE,EAAgB,GACtB,IAAIC,EACJ,MAAMC,EAAUJ,GAAaE,EAAcD,KAAKD,GAC1CK,EAAU,IAAIC,SAAQ,CAACC,EAASC,KAClCZ,EAASW,EAASC,EAAQT,EAAUK,GACpCN,EAAS,KACLS,EAAQ,MACRV,EAAgBY,SAAQC,GAAMA,OAElCP,EAAO,KACHI,EAAQ,MACRL,EAAcO,SAAQC,GAAMA,UAKpC,OAFAL,EAAQP,OAASA,EACjBO,EAAQF,KAAOA,EACRE,GCyZX,EArakBM,GAAgB,cAAcA,EAC5C,YAAYC,EAAQC,GAChBC,MAAMF,EAAQC,GACdE,KAAKC,SAAU,EACfD,KAAKE,KAAOJ,EAAOI,KACnBF,KAAKG,cAAe,OAAc,qCAClCH,KAAKI,eAAeC,YAAYL,KAAKG,cACrC,MAAMG,GAAU,OAAc,uDACxBC,GAAY,OAAc,uCAAwC,CACpEC,SAAU,CAACF,MAEf,OAAYC,EAAW,CACnBE,MAAO,CACHC,MAAOZ,EAAOa,gBACdC,WAAYd,EAAOe,UACnBC,UAAW,oBAEfC,QAAS,sBAEbf,KAAKgB,uBAAuB,CAACT,IAC7BU,OAAOC,iBAAiB,WAAYC,IACd,WAAdA,EAAMC,IAEFpB,KAAKqB,WACLrB,KAAKsB,UAAUtB,KAAKqB,WAGL,WAAdF,EAAMC,MAEXD,EAAMI,iBACFvB,KAAKC,UACDD,KAAKwB,WACLxB,KAAKyB,cAGLzB,KAAK0B,mBAKrBT,OAAOC,iBAAiB,UAAU,KAC9BlB,KAAK0B,cACD1B,KAAKC,SACLD,KAAK2B,gBACD3B,KAAKwB,YACLxB,KAAK4B,eAIL5B,KAAKwB,YACLxB,KAAKyB,iBAKjBlB,EAAUW,iBAAiB,SAAS,KAC5BlB,KAAKC,SACLD,KAAKC,SAAU,EACfK,EAAQuB,UAAUC,QAAQ,eAAgB,iBAC1C9B,KAAK+B,WACD/B,KAAKwB,YACLxB,KAAKyB,cAETzB,KAAKgC,aAAavB,MAAMwB,OAAS,GAGjCjC,KAAKkC,KAAKzB,MAAM0B,QAAU,QAC1BnC,KAAKoC,MAAM3B,MAAM0B,QAAU,UAG3BnC,KAAKC,SAAU,EACfK,EAAQuB,UAAUC,QAAQ,gBAAiB,gBAC3C9B,KAAK2B,oBAGbpB,EAAUW,iBAAiB,cAAc,KACjClB,KAAKC,QACLK,EAAQuB,UAAUC,QAAQ,gBAAiB,gBAG3CxB,EAAQuB,UAAUC,QAAQ,eAAgB,oBAGlDvB,EAAUW,iBAAiB,cAAc,KACrCZ,EAAQuB,UAAUQ,OAAO,eAAgB,iBACzC/B,EAAQuB,UAAUS,IAAI,eAE1B,MAAMC,GAAa,QAAO,yBAA0BvC,KAAKwC,cACzD,IAAKD,EACD,MAAM,IAAIE,MAAM,4BAEpBF,EAAWrB,iBAAiB,SAAS,KAC7BlB,KAAK0C,QAAQC,OAAS,YACtB3C,KAAKG,aACAyC,iBAAiB,YACjBlD,SAASmD,GAAQA,EAAIhB,UAAUS,IAAI,eAGxCtC,KAAKG,aACAyC,iBAAiB,YACjBlD,SAASmD,GAAQA,EAAIhB,UAAUQ,OAAO,kBAIvD,mBACI,IACI,OAAO,QAAO,6BAA8BrC,KAAKI,gBAErD,MAAO0C,GACH,OAAO,MAGf,WACI,OAAO,QAAO,kBAAmB9C,KAAKI,gBAE1C,YACI,OAAO,QAAO,mBAAoBJ,KAAKI,gBAE3C,SAAS2C,GAEL,OADA/C,KAAKgD,YAAcD,EACZ,GAAmB,CAACvD,EAASC,EAAQT,EAAUK,KAClD,MAAMC,EAAUS,MAAMkD,SAASF,GAC/B1D,GAAO,IAAMC,MAAAA,OAAyC,EAASA,EAAQF,SACvEJ,GAAS,IAAMM,MAAAA,OAAyC,EAASA,EAAQP,WACzEO,EAAQ4D,MAAK,KACLlD,KAAKC,SACLD,KAAK2B,gBAET3B,KAAKmD,WACL3D,UAIZ,cACIQ,KAAKG,aACAyC,iBAAiB,YACjBlD,SAAS0D,IAAQ,IAAIC,EAAI,OAAOrD,KAAKsD,QAAQF,EAAGG,KAAKC,MAA+B,QAAxBH,EAAKD,EAAEK,QAAQZ,WAAwB,IAAPQ,EAAgBA,EAAK,UAE1H,QAAQD,EAAGP,GACP,MAAMa,EAAM1D,KAAK2D,aAAad,GAC9BO,EAAE3C,MAAMmD,OAASF,EAAIf,KAAO,KAC5BS,EAAE3C,MAAMyB,KAAOwB,EAAIG,EAAIH,EAAIf,KAAO,EAAI,KACtCS,EAAE3C,MAAMqD,IAAMJ,EAAIK,EAAIL,EAAIf,KAAO,EAAI,KACrCS,EAAE3C,MAAMuD,MAAQN,EAAIf,KAAO,KAE/B,cACI,IAAIU,EACJ,IAAKrD,KAAKwB,WACN,OAEJ,MAAMkC,EAAM1D,KAAK2D,aAAaJ,KAAKC,MAAqD,QAA9CH,EAAKrD,KAAKwB,WAAWiC,QAAQQ,mBAAgC,IAAPZ,EAAgBA,EAAK,OACrHrD,KAAKwB,WAAWf,MAAMyB,KAAOwB,EAAIG,EAAIH,EAAIf,KAAO,EAAI,KACpD3C,KAAKwB,WAAWf,MAAMqD,IAAMJ,EAAIK,EAAIL,EAAIf,KAAO,KAEnD,SACI,OAAO3C,KAAKgD,YAAYkB,QAAQpC,QAAQ9B,KAAKE,KAAM,IAEvD,WAEIF,KAAKG,aAAagE,UAAY,GAE9B,MAAMC,EAAMpE,KAAKqE,SACXC,EAAO,IAAIC,SACjBD,EAAKE,OAAO,QAAQ,QAASC,UAAUL,KACvC,SACU,sBAAuB,QAAQA,GAAME,GAC1CpB,MAAMwB,GAAa1E,KAAK2E,SAASD,EAASJ,QAEnD,SAASM,GAGL,GADA5E,KAAKG,aAAagE,UAAY,GACzBU,MAAMC,QAAQF,GAGnB,IAAK,MAAM/B,KAAO+B,EACd5E,KAAK+E,QAAQlC,GAGrB,aAAamC,GACT,GAAyB,MAArBhF,KAAKgC,aACL,MAAO,CAAEW,KAAM,EAAGkB,EAAG,EAAGE,EAAG,GAE/B,MAAMkB,EAASjF,KAAKgC,aAAakD,cACjC,IAAKD,EACD,MAAM,IAAIxC,MAAM,4BAEpB,MAAM0C,EAAInF,KAAKgC,aAAaoD,YACtBC,EAAIrF,KAAKgC,aAAasD,aACtBC,GACEN,EAAOG,YAAcD,GAAK,EAD5BI,GAEEN,EAAOK,aAAeD,GAAK,EAEnC,MAAO,CACH1C,MAAQwC,EAAIE,GAAK,IAAOL,EAASrC,KACjCkB,EAAImB,EAASnB,EAAIsB,EAAK,IAAMI,EAC5BxB,EAAIiB,EAASjB,EAAIsB,EAAK,IAAME,GAGpC,UAAUC,GACN,IAAInC,EACJ,GAAIoC,QAAQ,uBAAwB,CAChC,MAAM5C,EAAMU,KAAKC,MAAoC,QAA7BH,EAAKmC,EAAO/B,QAAQZ,WAAwB,IAAPQ,EAAgBA,EAAK,MAC5EiB,EAAO,IAAIC,SACjBD,EAAKE,OAAO,UAAW3B,EAAI6C,SAC3BpB,EAAKE,OAAO,UAAW3B,EAAI8C,SAC3B,SACU,uBAAwBrB,GAC7BpB,MAAMwB,GAAa1E,KAAK2E,SAASD,EAASJ,SAGvD,QAAQzB,GACJ,MAAM+C,EAAiB5F,KAAK2D,aAAad,GACnC2C,GAAS,OAAc,YAAY3C,EAAI8C,mCAAmC9C,EAAIgD,eAAgB,CAChGpF,MAAO,CACHmD,OAAQgC,EAAejD,KAAO,KAC9BT,KAAM0D,EAAe/B,EAAI+B,EAAejD,KAAO,EAAI,KACnDmB,IAAK8B,EAAe7B,EAAI6B,EAAejD,KAAO,EAAI,KAClDqB,MAAO4B,EAAejD,KAAO,QAGrC3C,KAAKG,aAAaE,YAAYmF,GAC1BxF,KAAKC,SACLuF,EAAO3D,UAAUS,IAAI,cAGzBkD,EAAO/B,QAAQZ,IAAMU,KAAKuC,UAAUjD,GAEpC2C,EAAOtE,iBAAiB,SAAS,KACzBlB,KAAKqB,WACLrB,KAAKqB,UAAUQ,UAAUQ,OAAO,UAEpCrC,KAAKqB,UAAYmE,EACjBA,EAAO3D,UAAUS,IAAI,aAEzB,MAAMyD,GAAU,OAAc,6DAA8D,CACxFtF,MAAO,CACHuE,SAAU,QACVlB,IAAK,IACL5B,KAAM,OAGR8D,GAAY,OAAc,0IAmBhC,OAlBAD,EAAQ1F,YAAY2F,GACpBR,EAAOnF,YAAY0F,GACnBC,EAAU9E,iBAAiB,SAAS,IAAMlB,KAAKsB,UAAUkE,KACzDA,EAAOtE,iBAAiB,eAAgB4B,IACpCA,EAAEvB,iBACFwE,EAAQtF,MAAM0B,QAAU,QACxB4D,EAAQtF,MAAMK,UAAY,aAAagC,EAAEmD,cAAcnD,EAAEoD,gBAC1D,GACHC,SAASjF,iBAAiB,WAAW,KACjC6E,EAAQtF,MAAM0B,QAAU,UAGxBnC,KAAK0C,QAAQC,OAAS,YACtB6C,EAAO3D,UAAUS,IAAI,aAGrBkD,EAAO3D,UAAUQ,OAAO,aAErBmD,EAEX,WACIxF,KAAKG,aACAyC,iBAAiB,YACjBlD,SAAS0D,GAAMA,EAAEvB,UAAUS,IAAI,gBAExC,WACItC,KAAKG,aACAyC,iBAAiB,YACjBlD,SAAS0D,GAAMA,EAAEvB,UAAUQ,OAAO,gBAE3C,cACQrC,KAAKwB,YACLxB,KAAKwB,WAAWa,SAEpBrC,KAAKwB,WAAa,KAEtB,gBACQxB,KAAK0C,QAAQC,OAAS,aAEtByD,MAAM,sEAENpG,KAAKwB,YACLxB,KAAKyB,cAETzB,KAAKqG,WAEL,MAAMnE,EAAOlC,KAAKI,eAAekG,cAAc,mBACzClE,EAAQpC,KAAKI,eAAekG,cAAc,oBAChDpE,EAAKzB,MAAM0B,QAAU,OACrBC,EAAM3B,MAAM0B,QAAU,OAEtB,MAAMoE,EAAMvG,KAAKgC,aACjBuE,EAAI9F,MAAMwB,OAAS,YAEnBsE,EAAIC,oBAAoB,QAASxG,KAAKyG,YAAYC,KAAK1G,OACvDuG,EAAIrF,iBAAiB,QAASlB,KAAKyG,YAAYC,KAAK1G,OAExD,OAAOgF,GACH,MAAMZ,EAAMpE,KAAKqE,SACXC,EAAO,IAAIC,SACjBD,EAAKE,OAAO,QAAQ,QAASC,UAAUL,KACvCE,EAAKE,OAAO,IAAKmC,KAAKC,MAAM5B,EAASnB,GAAGgD,YACxCvC,EAAKE,OAAO,IAAKmC,KAAKC,MAAM5B,EAASjB,GAAG8C,YACxCvC,EAAKE,OAAO,OAAQmC,KAAKC,MAAM5B,EAASrC,MAAMkE,YAC9C,SAAW,qBAAsB,QAAQzC,GAAME,GAAMpB,MAAMwB,IAC1B,iBAAlBA,EAASJ,KAEhBtE,KAAK2E,SAASD,EAASJ,MAIvBtE,KAAK8G,YAAYpC,EAASJ,KAAMU,MAI5C,YAAY+B,EAAU/B,GAClB,MAAMtB,EAAM1D,KAAK2D,aAAaqB,GAC9BhF,KAAKwB,YAAa,OAAcuF,EAAU,CACtCtG,MAAO,CACHyB,KAAMwB,EAAIG,EAAIH,EAAIf,KAAO,EAAI,KAC7BqC,SAAU,WACVlB,IAAKJ,EAAIK,EAAIL,EAAIf,KAAO,EAAI,KAC5BqE,OAAQ,WAGhBhH,KAAKwC,aAAanC,YAAYL,KAAKwB,YACnC,MAAMyF,EAAUpC,MAAMqC,KAAKlH,KAAKwB,WAAWoB,iBAAiB,WAC5D,IAAK,MAAMuE,KAAUF,EACjB,eAAaE,EAAOC,WAGxBpH,KAAKwB,WAAWiC,QAAQQ,YAAcV,KAAKuC,UAAUd,GAErD,MAAMqC,EAAOrH,KAAKwB,WAAW8E,cAAc,QAC3C,IAAKe,EACD,MAAM,IAAI5E,MAAM,2BAEpB,IAAE4E,GAAM/C,KAAK,kBAAmBI,IACxB1E,KAAKwB,YACLxB,KAAKyB,cAEe,iBAAbiD,EAEP1E,KAAK2E,SAASD,GAId1E,KAAK8G,YAAYpC,EAAUM,MAInCsC,YAAW,KACP,GAAItH,KAAKwB,WAAY,CACjB,MAAM+F,EAAWvH,KAAKwB,WAAW8E,cAAc,qBAC/C,IAAKiB,EACD,MAAM,IAAI9E,MAAM,uCAEpB8E,EAASC,cAAc,IAAIC,MAAM,cAI7C,YAAY3E,GACR,MAAMyD,EAAMvG,KAAKgC,aACX0F,EAAS5E,EAAE4E,OAEXC,EAAS,IAAED,GAAQC,SACzB,IAAKA,EACD,MAAM,IAAIlF,MAAM,gCAEpB,MAAMuB,EAAQuC,EAAInB,YACZxB,EAAS2C,EAAIjB,aACbsC,EAAS,CACXjC,QAAS,MACTE,KAAM,GACNlD,KAAM,EACNkB,EAA8B,KAAzBf,EAAE+E,MAAQF,EAAOzF,MAAe8B,EACrCD,EAA6B,KAAxBjB,EAAEgF,MAAQH,EAAO7D,KAAcF,GAGpC5D,KAAKwB,YACLxB,KAAKyB,cAETzB,KAAK+H,OAAOH,GAEZ,MAAMpC,EAASxF,KAAK+E,QAAQ6C,GAE5BpC,EAAOgB,oBAAoB,aAAa,KAAM,MAE9ChB,EAAO/E,MAAMwB,OAAS,YACtB,MAAM+F,EAAYhI,KAAKgC,aACvB,IAAIiG,EAAQ,EACRC,EAAQ,EACZ,MAAMC,EAA2BC,IAW7B,GAVAR,EAAOjF,MAA8B,KAApByF,EAAGP,MAAQI,GAAgBD,EAAU5C,YACtDwC,EAAOjF,MAA8B,KAApByF,EAAGN,MAAQI,GAAgBF,EAAU1C,aACtD2C,EAAQG,EAAGP,MACXK,EAAQE,EAAGN,MACPF,EAAOjF,KAAO,EACdiF,EAAOjF,KAAO,EAETiF,EAAOjF,KAAO,KACnBiF,EAAOjF,KAAO,IAEd3C,KAAKwB,WAAY,CACCxB,KAAKwB,WAAW8E,cAAc,sBACtC+B,MAAQC,OAAO3B,KAAKC,MAAMgB,EAAOjF,OAE/C3C,KAAKsD,QAAQkC,EAAQoC,GAErBpC,EAAO/B,QAAQd,KAAO2F,OAAOV,EAAOjF,OAExCwD,SAASjF,iBAAiB,WAAW,IAAMiF,SAASK,oBAAoB,YAAa2B,KACrF3C,EAAOtE,iBAAiB,aAAcqH,IAClCN,EAAQM,EAAGV,MACXK,EAAQK,EAAGT,MACX3B,SAASjF,iBAAiB,YAAaiH","sources":["webpack:///../.yarn/cache/jgallery-https-184433fe1b-7b43bb1caa.zip/node_modules/jgallery/src/utils/cancellable-promise.ts","webpack:///./js/lib/fotoalbum/with-tags.ts"],"sourcesContent":["const cancellablePromise = (executor) => {\n    const cancelListeners = [];\n    let cancel;\n    const onCancel = (listener) => cancelListeners.push(listener);\n    const skipListeners = [];\n    let skip;\n    const onSkip = (listener) => skipListeners.push(listener);\n    const promise = new Promise((resolve, reject) => {\n        executor(resolve, reject, onCancel, onSkip);\n        cancel = () => {\n            resolve(null);\n            cancelListeners.forEach(fn => fn());\n        };\n        skip = () => {\n            resolve(null);\n            skipListeners.forEach(fn => fn());\n        };\n    });\n    promise.cancel = cancel;\n    promise.skip = skip;\n    return promise;\n};\nexport default cancellablePromise;\n","import axios from 'axios';\nimport { Size } from 'jgallery/src/preview';\nimport createElement from 'jgallery/src/utils/create-element';\nimport withTooltip from 'jgallery/src/utils/with-tooltip';\nimport $ from 'jquery';\nimport { basename, dirname } from '../util';\nimport { select } from '../dom';\nimport cancellablePromise from 'jgallery/src/utils/cancellable-promise';\nconst withTags = (constructor) => class extends constructor {\n    constructor(albums, params) {\n        super(albums, params);\n        this.tagMode = false;\n        this.root = params.root;\n        this.tagContainer = createElement(`<div class=\"tag-container\"></div>`);\n        this.previewElement.appendChild(this.tagContainer);\n        const tagIcon = createElement('<i class=\"fas fa-face-grin\" aria-hidden=\"true\"></i>');\n        const tagButton = createElement(`<span class=\"j-gallery-icon\"></span>`, {\n            children: [tagIcon],\n        });\n        withTooltip(tagButton, {\n            style: {\n                color: params.backgroundColor,\n                background: params.textColor,\n                transform: 'translateY(-8px)',\n            },\n            content: 'Leden etiketteren',\n        });\n        this.appendControlsElements([tagButton]);\n        window.addEventListener('keydown', (event) => {\n            if (event.key === 'Delete') {\n                // delete\n                if (this.activeTag) {\n                    this.removeTag(this.activeTag);\n                }\n            }\n            else if (event.key === 'Escape') {\n                // esc\n                event.preventDefault();\n                if (this.tagMode) {\n                    if (this.tagFormDiv) {\n                        this.exitTagForm();\n                    }\n                    else {\n                        this.moveTagDivs();\n                    }\n                }\n            }\n        });\n        window.addEventListener('resize', () => {\n            this.moveTagDivs();\n            if (this.tagMode) {\n                this.duringTagMode();\n                if (this.tagFormDiv) {\n                    this.moveTagForm();\n                }\n            }\n            else {\n                if (this.tagFormDiv) {\n                    this.exitTagForm();\n                }\n            }\n        });\n        // knopje taggen\n        tagButton.addEventListener('click', () => {\n            if (this.tagMode) {\n                this.tagMode = false;\n                tagIcon.classList.replace('fa-toggle-on', 'fa-toggle-off');\n                this.hideTags();\n                if (this.tagFormDiv) {\n                    this.exitTagForm();\n                }\n                this.imageElement.style.cursor = '';\n                // imgs.off('click.newtag');\n                // enable nav area on img\n                this.left.style.display = 'block';\n                this.right.style.display = 'block';\n            }\n            else {\n                this.tagMode = true;\n                tagIcon.classList.replace('fa-toggle-off', 'fa-toggle-on');\n                this.duringTagMode();\n            }\n        });\n        tagButton.addEventListener('mouseenter', () => {\n            if (this.tagMode) {\n                tagIcon.classList.replace('fa-toggle-off', 'fa-toggle-on');\n            }\n            else {\n                tagIcon.classList.replace('fa-toggle-on', 'fa-toggle-off');\n            }\n        });\n        tagButton.addEventListener('mouseleave', () => {\n            tagIcon.classList.remove('fa-toggle-on', 'fa-toggle-off');\n            tagIcon.classList.add('fa-smile');\n        });\n        const screenIcon = select('.j-gallery-screen-icon', this.getElement());\n        if (!screenIcon) {\n            throw new Error('Geen screenIcon gevonden');\n        }\n        screenIcon.addEventListener('click', () => {\n            if (this.preview.size !== Size.contain) {\n                this.tagContainer\n                    .querySelectorAll('.fototag')\n                    .forEach((tag) => tag.classList.add('verborgen'));\n            }\n            else {\n                this.tagContainer\n                    .querySelectorAll('.fototag')\n                    .forEach((tag) => tag.classList.remove('verborgen'));\n            }\n        });\n    }\n    get imageElement() {\n        try {\n            return select('.j-gallery-preview-content', this.previewElement);\n        }\n        catch (e) {\n            return null;\n        }\n    }\n    get left() {\n        return select('.j-gallery-left', this.previewElement);\n    }\n    get right() {\n        return select('.j-gallery-right', this.previewElement);\n    }\n    goToItem(item) {\n        this.currentItem = item;\n        return cancellablePromise((resolve, reject, onCancel, onSkip) => {\n            const promise = super.goToItem(item);\n            onSkip(() => promise === null || promise === void 0 ? void 0 : promise.skip());\n            onCancel(() => promise === null || promise === void 0 ? void 0 : promise.cancel());\n            promise.then(() => {\n                if (this.tagMode) {\n                    this.duringTagMode();\n                }\n                this.loadTags();\n                resolve();\n            });\n        });\n    }\n    moveTagDivs() {\n        this.tagContainer\n            .querySelectorAll('.fototag')\n            .forEach((t) => { var _a; return this.moveTag(t, JSON.parse((_a = t.dataset.tag) !== null && _a !== void 0 ? _a : '{}')); });\n    }\n    moveTag(t, tag) {\n        const pos = this.getScreenPos(tag);\n        t.style.height = pos.size + 'px';\n        t.style.left = pos.x - pos.size / 2 + 'px';\n        t.style.top = pos.y - pos.size / 2 + 'px';\n        t.style.width = pos.size + 'px';\n    }\n    moveTagForm() {\n        var _a;\n        if (!this.tagFormDiv) {\n            return;\n        }\n        const pos = this.getScreenPos(JSON.parse((_a = this.tagFormDiv.dataset.tagPosition) !== null && _a !== void 0 ? _a : '{}'));\n        this.tagFormDiv.style.left = pos.x - pos.size / 2 + 'px';\n        this.tagFormDiv.style.top = pos.y + pos.size + 'px';\n    }\n    getUrl() {\n        return this.currentItem.fullUrl.replace(this.root, '');\n    }\n    loadTags() {\n        // remove old ones\n        this.tagContainer.innerHTML = '';\n        // get new ones\n        const url = this.getUrl();\n        const data = new FormData();\n        data.append('foto', basename(decodeURI(url)));\n        axios\n            .post('/fotoalbum/gettags' + dirname(url), data)\n            .then((response) => this.drawTags(response.data));\n    }\n    drawTags(tags) {\n        // remove old ones\n        this.tagContainer.innerHTML = '';\n        if (!Array.isArray(tags)) {\n            return;\n        }\n        for (const tag of tags) {\n            this.drawTag(tag);\n        }\n    }\n    getScreenPos(position) {\n        if (this.imageElement == null) {\n            return { size: 0, x: 0, y: 0 };\n        }\n        const parent = this.imageElement.parentElement;\n        if (!parent) {\n            throw new Error('ImageElement niet in DOM');\n        }\n        const w = this.imageElement.clientWidth;\n        const h = this.imageElement.clientHeight;\n        const fotoTopLeft = {\n            x: (parent.clientWidth - w) / 2,\n            y: (parent.clientHeight - h) / 2,\n        };\n        return {\n            size: ((w + h) / 200) * position.size,\n            x: (position.x * w) / 100 + fotoTopLeft.x,\n            y: (position.y * h) / 100 + fotoTopLeft.y,\n        };\n    }\n    removeTag(tagDiv) {\n        var _a;\n        if (confirm('Etiket verwijderen?')) {\n            const tag = JSON.parse((_a = tagDiv.dataset.tag) !== null && _a !== void 0 ? _a : '{}');\n            const data = new FormData();\n            data.append('refuuid', tag.refuuid);\n            data.append('keyword', tag.keyword);\n            axios\n                .post('/fotoalbum/removetag', data)\n                .then((response) => this.drawTags(response.data));\n        }\n    }\n    drawTag(tag) {\n        const screenPosition = this.getScreenPos(tag);\n        const tagDiv = createElement(`<div id=\"${tag.keyword}\" class=\"fototag\" title=\"${tag.name}\"></div>`, {\n            style: {\n                height: screenPosition.size + 'px',\n                left: screenPosition.x - screenPosition.size / 2 + 'px',\n                top: screenPosition.y - screenPosition.size / 2 + 'px',\n                width: screenPosition.size + 'px',\n            },\n        });\n        this.tagContainer.appendChild(tagDiv);\n        if (this.tagMode) {\n            tagDiv.classList.add('showborder');\n        }\n        // set attr for move/resize\n        tagDiv.dataset.tag = JSON.stringify(tag);\n        // remove tag handler\n        tagDiv.addEventListener('click', () => {\n            if (this.activeTag) {\n                this.activeTag.classList.remove('active');\n            }\n            this.activeTag = tagDiv;\n            tagDiv.classList.add('active');\n        });\n        const tagMenu = createElement('<div id=\"tagMenu\" class=\"dropdown-menu\" role=\"menu\"></div>', {\n            style: {\n                position: 'fixed',\n                top: '0',\n                left: '0',\n            },\n        });\n        const btnDelTag = createElement(`<a id=\"btnDelTag\" tabindex=\"-1\" class=\"dropdown-item\"><i class=\"fas fa-user-xmark\" aria-hidden=\"true\"></i>&nbsp;Etiket verwijderen</a>`);\n        tagMenu.appendChild(btnDelTag);\n        tagDiv.appendChild(tagMenu);\n        btnDelTag.addEventListener('click', () => this.removeTag(tagDiv));\n        tagDiv.addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n            tagMenu.style.display = 'block';\n            tagMenu.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;\n        }, true);\n        document.addEventListener('mouseup', () => {\n            tagMenu.style.display = 'none';\n        });\n        // verberg tags tijdens zoomen\n        if (this.preview.size !== Size.contain) {\n            tagDiv.classList.add('verborgen');\n        }\n        else {\n            tagDiv.classList.remove('verborgen');\n        }\n        return tagDiv;\n    }\n    showTags() {\n        this.tagContainer\n            .querySelectorAll('.fototag')\n            .forEach((t) => t.classList.add('showborder'));\n    }\n    hideTags() {\n        this.tagContainer\n            .querySelectorAll('.fototag')\n            .forEach((t) => t.classList.remove('showborder'));\n    }\n    exitTagForm() {\n        if (this.tagFormDiv) {\n            this.tagFormDiv.remove();\n        }\n        this.tagFormDiv = null;\n    }\n    duringTagMode() {\n        if (this.preview.size !== Size.contain) {\n            // if zoomed in\n            alert('Je kunt niet inzoomen tijdens het etiketteren, dat werkt nog niet.');\n        }\n        if (this.tagFormDiv) {\n            this.exitTagForm();\n        }\n        this.showTags();\n        // disable nav area on img\n        const left = this.previewElement.querySelector('.j-gallery-left');\n        const right = this.previewElement.querySelector('.j-gallery-right');\n        left.style.display = 'none';\n        right.style.display = 'none';\n        // click handler\n        const img = this.imageElement;\n        img.style.cursor = 'crosshair';\n        // (re-)bind add new tag handler\n        img.removeEventListener('click', this.newTagStart.bind(this));\n        img.addEventListener('click', this.newTagStart.bind(this));\n    }\n    addTag(position) {\n        const url = this.getUrl();\n        const data = new FormData();\n        data.append('foto', basename(decodeURI(url)));\n        data.append('x', Math.round(position.x).toString());\n        data.append('y', Math.round(position.y).toString());\n        data.append('size', Math.round(position.size).toString());\n        axios.post('/fotoalbum/addtag' + dirname(url), data).then((response) => {\n            if (typeof response.data === 'object') {\n                // JSON tags\n                this.drawTags(response.data);\n            }\n            else {\n                // HTML form\n                this.drawTagForm(response.data, position);\n            }\n        });\n    }\n    drawTagForm(formHtml, position) {\n        const pos = this.getScreenPos(position);\n        this.tagFormDiv = createElement(formHtml, {\n            style: {\n                left: pos.x - pos.size / 2 + 'px',\n                position: 'absolute',\n                top: pos.y + pos.size / 2 + 'px',\n                zIndex: '10000',\n            },\n        });\n        this.getElement().appendChild(this.tagFormDiv);\n        const scripts = Array.from(this.tagFormDiv.querySelectorAll('script'));\n        for (const script of scripts) {\n            $.globalEval(script.innerText);\n        }\n        // set attr for move/resize\n        this.tagFormDiv.dataset.tagPosition = JSON.stringify(position);\n        // set submit handler\n        const form = this.tagFormDiv.querySelector('form');\n        if (!form) {\n            throw new Error('tag div bevat geen form');\n        }\n        $(form).data('submitCallback', (response) => {\n            if (this.tagFormDiv) {\n                this.exitTagForm();\n            }\n            if (typeof response === 'object') {\n                // JSON tags\n                this.drawTags(response);\n            }\n            else {\n                // HTML form\n                this.drawTagForm(response, position);\n            }\n        });\n        // set focus\n        setTimeout(() => {\n            if (this.tagFormDiv) {\n                const uidInput = this.tagFormDiv.querySelector('input[name=\"uid\"]');\n                if (!uidInput) {\n                    throw new Error('tagFormDiv bevat input met name uid');\n                }\n                uidInput.dispatchEvent(new Event('focus'));\n            }\n        });\n    }\n    newTagStart(e) {\n        const img = this.imageElement;\n        const target = e.target;\n        // calculate relative position to image top left\n        const offset = $(target).offset();\n        if (!offset) {\n            throw new Error('Tag target heeft geen offset');\n        }\n        const width = img.clientWidth;\n        const height = img.clientHeight;\n        const newTag = {\n            keyword: 'New',\n            name: '',\n            size: 7,\n            x: ((e.pageX - offset.left) * 100) / width,\n            y: ((e.pageY - offset.top) * 100) / height,\n        };\n        // show form\n        if (this.tagFormDiv) {\n            this.exitTagForm();\n        }\n        this.addTag(newTag);\n        // show new resizable tag\n        const tagDiv = this.drawTag(newTag);\n        // not remove-able\n        tagDiv.removeEventListener('click.tag', () => ({}));\n        // resize-able\n        tagDiv.style.cursor = 'nw-resize';\n        const imgActive = this.imageElement;\n        let prevX = 0;\n        let prevY = 0;\n        const windowMouseMoveListener = (e2) => {\n            newTag.size += ((e2.pageX - prevX) * 100) / imgActive.clientWidth;\n            newTag.size += ((e2.pageY - prevY) * 100) / imgActive.clientHeight;\n            prevX = e2.pageX;\n            prevY = e2.pageY;\n            if (newTag.size < 1) {\n                newTag.size = 1;\n            }\n            else if (newTag.size > 99) {\n                newTag.size = 99;\n            }\n            if (this.tagFormDiv) {\n                const sizeInput = this.tagFormDiv.querySelector('input[name=\"size\"]');\n                sizeInput.value = String(Math.round(newTag.size));\n            }\n            this.moveTag(tagDiv, newTag);\n            // update attr for move/resize\n            tagDiv.dataset.size = String(newTag.size);\n        };\n        document.addEventListener('mouseup', () => document.removeEventListener('mousemove', windowMouseMoveListener));\n        tagDiv.addEventListener('mousedown', (e1) => {\n            prevX = e1.pageX;\n            prevY = e1.pageY;\n            document.addEventListener('mousemove', windowMouseMoveListener);\n        });\n    }\n};\nexport default withTags;\n"],"names":["executor","cancelListeners","cancel","onCancel","listener","push","skipListeners","skip","onSkip","promise","Promise","resolve","reject","forEach","fn","constructor","albums","params","super","this","tagMode","root","tagContainer","previewElement","appendChild","tagIcon","tagButton","children","style","color","backgroundColor","background","textColor","transform","content","appendControlsElements","window","addEventListener","event","key","activeTag","removeTag","preventDefault","tagFormDiv","exitTagForm","moveTagDivs","duringTagMode","moveTagForm","classList","replace","hideTags","imageElement","cursor","left","display","right","remove","add","screenIcon","getElement","Error","preview","size","querySelectorAll","tag","e","item","currentItem","goToItem","then","loadTags","t","_a","moveTag","JSON","parse","dataset","pos","getScreenPos","height","x","top","y","width","tagPosition","fullUrl","innerHTML","url","getUrl","data","FormData","append","decodeURI","response","drawTags","tags","Array","isArray","drawTag","position","parent","parentElement","w","clientWidth","h","clientHeight","fotoTopLeft","tagDiv","confirm","refuuid","keyword","screenPosition","name","stringify","tagMenu","btnDelTag","clientX","clientY","document","alert","showTags","querySelector","img","removeEventListener","newTagStart","bind","Math","round","toString","drawTagForm","formHtml","zIndex","scripts","from","script","innerText","form","setTimeout","uidInput","dispatchEvent","Event","target","offset","newTag","pageX","pageY","addTag","imgActive","prevX","prevY","windowMouseMoveListener","e2","value","String","e1"],"sourceRoot":""}