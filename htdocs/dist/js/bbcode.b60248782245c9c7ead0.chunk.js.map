{"version":3,"sources":["webpack:///./js/lib/bbcode.ts"],"names":["initBbPreviewBtn","el","previewId","dataset","bbpreviewBtn","source","document","querySelector","target","Error","addEventListener","CsrBBPreviewEl","initBbPreview","bbpreview","event","key","params","bbcode","value","trim","innerHTML","style","display","a","post","Object","assign","data","encodeURIComponent","then","response","catch","error","alert","loadBbImage","content","getAttribute","onerror","setAttribute","width","height","classList","replace","foto","indexOf","video","parent","hasClass","hasAnchor","closest","length","parentElement","replaceChild","targetUrl","link","appendChild","activeerLidHints","textarea","editor","textcomplete","register","match","label","search","template","index","on","dropdown","items","activate","term","callback","ajax","encodeURI","done","fail"],"mappings":"0FAAA,6SAMO,MAAMA,EAAoBC,IAC7B,MAAMC,EAAYD,EAAGE,QAAQC,aACvBC,EAASC,SAASC,cAAc,IAAML,GACtCM,EAASF,SAASC,cAAc,YAAcL,GACpD,IAAKG,IAAWG,EACZ,MAAM,IAAIC,MAAM,0CAEpBR,EAAGS,iBAAiB,QAAS,IAAMC,EAAeN,EAAQG,KAEjDI,EAAiBX,IAC1B,MAAMC,EAAYD,EAAGE,QAAQU,UACvBL,EAASF,SAASC,cAAc,YAAcL,GACpD,IAAKM,EACD,MAAM,IAAIC,MAAM,uCAEpBR,EAAGS,iBAAiB,QAAUI,IACR,UAAdA,EAAMC,KACNJ,EAAeV,EAAIO,MAIlBG,EAAiB,CAACN,EAAQG,EAAQQ,EAAS,MACpD,MAAMC,EAASZ,EAAOa,MACtB,GAAsB,KAAlBD,EAAOE,OAGP,OAFAX,EAAOY,UAAY,QACnBZ,EAAOa,MAAMC,QAAU,QAG3B,EAAAC,EAAMC,KAAK,gBAAiBC,OAAOC,OAAO,CAAEC,KAAMC,mBAAmBX,IAAWD,IAASa,KAAMC,IAC3FtB,EAAOY,UAAYU,EAASH,KAC5B,YAAKnB,GACLA,EAAOa,MAAMC,QAAU,UACxBS,MAAOC,IACNC,MAAMD,MAGDE,EAAejC,IACxB,MAAMkC,EAAU,GAAK;;oBAELlC,EAAGmC,aAAa;sBACdnC,EAAGmC,aAAa;oBAClBnC,EAAGmC,aAAa,YAChCD,EAAQE,QAAU,KACdpC,EAAGqC,aAAa,QAAS,oDACzBrC,EAAGqC,aAAa,MAAO,yCACvBrC,EAAGoB,MAAMkB,MAAQ,OACjBtC,EAAGoB,MAAMmB,OAAS,OAClBvC,EAAGwC,UAAUC,QAAQ,iBAAkB,WAE3C,YAAazC,EAAGmC,aAAa,OAAQ,KACjC,MAAMO,EAAOR,EAAQC,aAAa,OAAOQ,QAAQ,yBAA2B,EACtEC,EAAQ,IAAE5C,GAAI6C,SAASA,SAASC,SAAS,oBACzCC,EAA0C,IAA9B,IAAE/C,GAAIgD,QAAQ,KAAKC,OAC/BJ,EAAS7C,EAAGkD,cAClB,GAAIR,GAAQE,GAASG,EACjBF,EAAOM,aAAajB,EAASlC,OAE5B,CACD,MAAMoD,EAA0C,MAA9BpD,EAAGmC,aAAa,WAAqBnC,EAAGmC,aAAa,OAASnC,EAAGmC,aAAa,WAC1FkB,EAAO,GAAK,kCAAkCD,wCACpDC,EAAKC,YAAYpB,GACjBW,EAAOM,aAAaE,EAAMrD,OAI/B,SAASuD,EAAiBC,GAC7B,MAAMC,EAAS,IAAI,WAASD,GACtBE,EAAe,IAAI,eAAaD,GACtCC,EAAaC,SAAS,CAAC,CAEfC,MAAO,+BACPnB,QAAQf,GACG,UAAYA,EAAKmC,MAAQ,IAEpCC,SACAC,YACD,CAECC,MAAO,EACPJ,MAAO,gDACPE,SACAC,WACAtB,QAAQf,GACG,SAAWA,EAAKmC,SAGnCH,EAAaO,GAAG,WAAY,KACpBP,EAAaQ,SAASC,MAAMlB,QAAU,GAEtCS,EAAaQ,SAASC,MAAM,GAAGC,aAI3C,SAASN,EAAOO,EAAMC,GACbD,GAAwB,IAAhBA,EAAKpB,OAId,IAAEsB,KAAK,qDAAuDC,UAAUH,IACnEI,KAAM/C,IACP4C,EAAS5C,KAERgD,KAAK,KACNJ,EAAS,MARbA,EAAS,IAYjB,SAASP,EAASrC,EAAM2C,GACpB,OAAO3C,EAAKT","file":"js/bbcode.b60248782245c9c7ead0.chunk.js","sourcesContent":["import axios from 'axios';\nimport $ from 'jquery';\n// @ts-ignore\nimport { Textarea, Textcomplete } from 'textcomplete';\nimport { init } from '../ctx';\nimport { html, preloadImage } from './util';\nexport const initBbPreviewBtn = (el) => {\n    const previewId = el.dataset.bbpreviewBtn;\n    const source = document.querySelector('#' + previewId);\n    const target = document.querySelector('#preview_' + previewId);\n    if (!source || !target) {\n        throw new Error('Bbpreview van niet bestaande elementen');\n    }\n    el.addEventListener('click', () => CsrBBPreviewEl(source, target));\n};\nexport const initBbPreview = (el) => {\n    const previewId = el.dataset.bbpreview;\n    const target = document.querySelector('#preview_' + previewId);\n    if (!target) {\n        throw new Error('Geen target gevonden voor bbpreview');\n    }\n    el.addEventListener('keyup', (event) => {\n        if (event.key === 'Enter') { // enter\n            CsrBBPreviewEl(el, target);\n        }\n    });\n};\nexport const CsrBBPreviewEl = (source, target, params = {}) => {\n    const bbcode = source.value;\n    if (bbcode.trim() === '') {\n        target.innerHTML = '';\n        target.style.display = 'none';\n        return;\n    }\n    axios.post('/tools/bbcode', Object.assign({ data: encodeURIComponent(bbcode) }, params)).then((response) => {\n        target.innerHTML = response.data;\n        init(target);\n        target.style.display = 'block';\n    }).catch((error) => {\n        alert(error);\n    });\n};\nexport const loadBbImage = (el) => {\n    const content = html `<img\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bb-img\"\n\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"${el.getAttribute('title')}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"${el.getAttribute('style')}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsrc=\"${el.getAttribute('src')}\"/>`;\n    content.onerror = () => {\n        el.setAttribute('title', 'Afbeelding bestaat niet of is niet toegankelijk!');\n        el.setAttribute('src', '/plaetjes/famfamafm/picture_error.png');\n        el.style.width = '16px';\n        el.style.height = '16px';\n        el.classList.replace('bb-img-loading', 'bb-img');\n    };\n    preloadImage(el.getAttribute('src'), () => {\n        const foto = content.getAttribute('src').indexOf('/plaetjes/fotoalbum/') >= 0;\n        const video = $(el).parent().parent().hasClass('bb-video-preview');\n        const hasAnchor = $(el).closest('a').length !== 0;\n        const parent = el.parentElement;\n        if (foto || video || hasAnchor) {\n            parent.replaceChild(content, el);\n        }\n        else {\n            const targetUrl = el.getAttribute('bb-href') == null ? el.getAttribute('src') : el.getAttribute('bb-href');\n            const link = html `<a class=\"lightbox-link\" href=\"${targetUrl}\" data-lightbox=\"page-lightbox\"></a>`;\n            link.appendChild(content);\n            parent.replaceChild(link, el);\n        }\n    });\n};\nexport function activeerLidHints(textarea) {\n    const editor = new Textarea(textarea);\n    const textcomplete = new Textcomplete(editor);\n    textcomplete.register([{\n            // @...\n            match: /(^|\\s|])@((?:[^ ]+ ?){1,5})$/,\n            replace(data) {\n                return '$1[lid=' + data.label + ']';\n            },\n            search,\n            template,\n        }, {\n            // [citaat=... of [lid=...\n            index: 3,\n            match: /(^|\\s|])\\[(citaat|lid)=(?:[0-9]{4}|([^\\]]+))$/,\n            search,\n            template,\n            replace(data) {\n                return '$1[$2=' + data.label;\n            },\n        }]);\n    textcomplete.on('rendered', () => {\n        if (textcomplete.dropdown.items.length >= 1) {\n            // Activeer eerste keuze standaard\n            textcomplete.dropdown.items[0].activate();\n        }\n    });\n}\nfunction search(term, callback) {\n    if (!term || term.length === 1) {\n        callback([]);\n    }\n    else {\n        $.ajax('/tools/naamsuggesties?vorm=user&zoekin=voorkeur&q=' + encodeURI(term))\n            .done((data) => {\n            callback(data);\n        })\n            .fail(() => {\n            callback([]);\n        });\n    }\n}\nfunction template(data, term) {\n    return data.value;\n}\n"],"sourceRoot":""}