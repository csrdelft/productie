(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{282:function(e,t,i){"use strict";i.r(t);var s=i(8),a=i.n(s),o=i(193),r=i(173),n=i(179),g=i(0),l=i.n(g),d=i(2);t.default=e=>(class extends e{constructor(e,t){super(e,t),this.tagMode=!1,this.root=t.root,this.tagContainer=Object(r.a)('<div class="tag-container"></div>'),this.previewElement.appendChild(this.tagContainer);const i=Object(r.a)('<i class="fa fa-smile"></i>'),s=Object(r.a)('<span class="j-gallery-icon"></span>',{children:[i]});Object(n.a)(s,{style:{color:t.backgroundColor,background:t.textColor,transform:"translateY(-8px)"},content:"Leden etiketteren"}),this.appendControlsElements([s]),window.addEventListener("keydown",e=>{"Delete"===e.key?this.activeTag&&this.removeTag(this.activeTag):"Escape"===e.key&&(e.preventDefault(),this.tagMode&&(this.tagFormDiv?this.exitTagForm():this.moveTagDivs()))}),window.addEventListener("resize",()=>{this.moveTagDivs(),this.tagMode?(this.duringTagMode(),this.tagFormDiv&&this.moveTagForm()):this.tagFormDiv&&this.exitTagForm()}),s.addEventListener("click",()=>{this.tagMode?(this.tagMode=!1,i.classList.add("fa-toggle-off"),i.classList.remove("fa-toggle-on"),this.hideTags(),this.tagFormDiv&&this.exitTagForm(),this.imageElement.style.cursor="",this.left.style.display="block",this.right.style.display="block"):(this.tagMode=!0,i.classList.add("fa-toggle-on"),i.classList.remove("fa-toggle-off"),this.duringTagMode())}),s.addEventListener("mouseenter",()=>{this.tagMode?(i.classList.add("fa-toggle-on"),i.classList.remove("fa-toggle-off")):(i.classList.remove("fa-toggle-off"),i.classList.add("fa-toggle-off"))}),s.addEventListener("mouseleave",()=>{i.classList.remove("fa-toggle-on","fa-toggle-off"),i.classList.add("fa-smile")}),this.getElement().querySelector(".j-gallery-screen-icon").addEventListener("click",()=>{this.preview.size!==o.a.contain?this.tagContainer.querySelectorAll(".fototag").forEach(e=>e.classList.add("verborgen")):this.tagContainer.querySelectorAll(".fototag").forEach(e=>e.classList.remove("verborgen"))})}get imageElement(){return this.previewElement.querySelector(".j-gallery-preview-content")}get left(){return this.previewElement.querySelector(".j-gallery-left")}get right(){return this.previewElement.querySelector(".j-gallery-right")}goToItem(e){return this.currentItem=e,super.goToItem(e).then(()=>{this.tagMode&&this.duringTagMode(),this.loadTags()})}moveTagDivs(){this.tagContainer.querySelectorAll(".fototag").forEach(e=>this.moveTag(e,JSON.parse(e.dataset.tag)))}moveTag(e,t){const i=this.getScreenPos(t);e.style.height=i.size+"px",e.style.left=i.x-i.size/2+"px",e.style.top=i.y-i.size/2+"px",e.style.width=i.size+"px"}moveTagForm(){if(!this.tagFormDiv)return;const e=this.getScreenPos(JSON.parse(this.tagFormDiv.dataset.tagPosition));this.tagFormDiv.style.left=e.x-e.size/2+"px",this.tagFormDiv.style.top=e.y+e.size+"px"}getUrl(){return this.currentItem.fullUrl.replace(this.root,"")}loadTags(){this.tagContainer.innerHTML="";const e=this.getUrl(),t=new FormData;t.append("foto",Object(d.a)(e)),a.a.post("/fotoalbum/gettags"+Object(d.b)(e),t).then(e=>this.drawTags(e.data))}drawTags(e){if(this.tagContainer.innerHTML="",Array.isArray(e))for(const t of e)this.drawTag(t)}getScreenPos(e){const t=this.imageElement,i=t.parentElement,s=t.clientWidth,a=t.clientHeight,o=(i.clientWidth-s)/2,r=(i.clientHeight-a)/2;return{size:(s+a)/200*e.size,x:e.x*s/100+o,y:e.y*a/100+r}}removeTag(e){if(confirm("Etiket verwijderen?")){const t=JSON.parse(e.dataset.tag),i=new FormData;i.append("refuuid",t.refuuid),i.append("keyword",t.keyword),a.a.post("/fotoalbum/removetag",i).then(e=>this.drawTags(e.data))}}drawTag(e){const t=this.getScreenPos(e),i=Object(r.a)(`<div id="${e.keyword}" class="fototag" title="${e.name}"></div>`,{style:{height:t.size+"px",left:t.x-t.size/2+"px",top:t.y-t.size/2+"px",width:t.size+"px"}});this.tagContainer.appendChild(i),this.tagMode&&i.classList.add("showborder"),i.dataset.tag=JSON.stringify(e),i.addEventListener("click",()=>{this.activeTag&&this.activeTag.classList.remove("active"),this.activeTag=i,i.classList.add("active")});const s=Object(r.a)('<div id="tagMenu" class="dropdown-menu" role="menu"></div>',{style:{position:"fixed",top:"0",left:"0"}}),a=Object(r.a)('<a id="btnDelTag" tabindex="-1" class="dropdown-item"><i class="fa fa-user-times"></i>&nbsp;Etiket verwijderen</a>');return s.appendChild(a),i.appendChild(s),a.addEventListener("click",()=>this.removeTag(i)),i.addEventListener("contextmenu",e=>{e.preventDefault(),s.style.display="block",s.style.transform=`translate(${e.clientX}px, ${e.clientY}px)`},!0),document.addEventListener("mouseup",e=>{s.style.display="none"}),this.preview.size!==o.a.contain?i.classList.add("verborgen"):i.classList.remove("verborgen"),i}showTags(){this.tagContainer.querySelectorAll(".fototag").forEach(e=>e.classList.add("showborder"))}hideTags(){this.tagContainer.querySelectorAll(".fototag").forEach(e=>e.classList.remove("showborder"))}exitTagForm(){this.tagFormDiv&&this.tagFormDiv.remove(),this.tagFormDiv=null}duringTagMode(){this.preview.size!==o.a.contain&&alert("Je kunt niet inzoomen tijdens het etiketteren, dat werkt nog niet."),this.tagFormDiv&&this.exitTagForm(),this.showTags();const e=this.previewElement.querySelector(".j-gallery-left"),t=this.previewElement.querySelector(".j-gallery-right");e.style.display="none",t.style.display="none";const i=this.imageElement;i.style.cursor="crosshair",i.removeEventListener("click",this.newTagStart.bind(this)),i.addEventListener("click",this.newTagStart.bind(this))}addTag(e){const t=this.getUrl(),i=new FormData;i.append("foto",Object(d.a)(t)),i.append("x",Math.round(e.x).toString()),i.append("y",Math.round(e.y).toString()),i.append("size",Math.round(e.size).toString()),a.a.post("/fotoalbum/addtag"+Object(d.b)(t),i).then(t=>{"object"==typeof t.data?this.drawTags(t.data):this.drawTagForm(t.data,e)})}drawTagForm(e,t){const i=this.getScreenPos(t);this.tagFormDiv=Object(r.a)(e,{style:{left:i.x-i.size/2+"px",position:"absolute",top:i.y+i.size/2+"px",zIndex:"10000"}}),this.getElement().appendChild(this.tagFormDiv);const s=this.tagFormDiv.querySelectorAll("script");for(const e of s)l.a.globalEval(e.innerText);this.tagFormDiv.dataset.tagPosition=JSON.stringify(t),l()(this.tagFormDiv.querySelector("form")).data("submitCallback",e=>{this.tagFormDiv&&this.exitTagForm(),"object"==typeof e?this.drawTags(e):this.drawTagForm(e,t)}),setTimeout(()=>this.tagFormDiv&&this.tagFormDiv.querySelector('input[name="uid"]').dispatchEvent(new Event("focus")))}newTagStart(e){const t=this.imageElement,i=e.target,s=l()(i).offset(),a=t.clientWidth,o=t.clientHeight,r={keyword:"New",name:"",size:7,x:100*(e.pageX-s.left)/a,y:100*(e.pageY-s.top)/o};this.tagFormDiv&&this.exitTagForm(),this.addTag(r);const n=this.drawTag(r);n.removeEventListener("click.tag",()=>({})),n.style.cursor="nw-resize";const g=this.imageElement;let d=0,c=0;const h=e=>{if(r.size+=100*(e.pageX-d)/g.clientWidth,r.size+=100*(e.pageY-c)/g.clientHeight,d=e.pageX,c=e.pageY,r.size<1?r.size=1:r.size>99&&(r.size=99),this.tagFormDiv){this.tagFormDiv.querySelector('input[name="size"]').value=String(Math.round(r.size))}this.moveTag(n,r),n.dataset.size=String(r.size)};document.addEventListener("mouseup",()=>document.removeEventListener("mousemove",h)),n.addEventListener("mousedown",e=>{d=e.pageX,c=e.pageY,document.addEventListener("mousemove",h)})}})}}]);
//# sourceMappingURL=38.ddcdcd185b51c493f279.js.map