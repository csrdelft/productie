(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{232:function(t,o,e){"use strict";e.r(o),e.d(o,"FotoAlbumTags",(function(){return g}));var a=e(9),i=e.n(a),n=e(0),r=e.n(n),s=e(2),g=function(){function t(o){var e=this;this.tagMode=!1,this.fotoalbum=o,o.on("afterLoadPhoto",(function(){e.tagMode&&e.duringTagMode(),e.loadTags()})),window.addEventListener("keydown",(function(t){"Delete"===t.key?r()("div.fototag.active").each((function(t,o){e.removeTag(r()(o))})):"Escape"===t.key&&(t.preventDefault(),e.tagMode&&(e.tagFormDiv?e.exitTagForm():e.moveTagDivs()))})),window.addEventListener("resize",(function(){e.moveTagDivs(),e.tagMode?(e.duringTagMode(),e.tagFormDiv&&e.moveTagForm()):e.tagFormDiv&&e.exitTagForm()}));var a=this.fotoalbum.createCMBtn("btnDelTag","Etiket verwijderen","user-times");r()("<li></li>").append(a).appendTo("#tagMenu");var i=r()('<span class="fa fa-smile jgallery-btn jgallery-btn-small" tooltip="Leden etiketteren"></span>');i.on("click",(function(){if(e.tagMode){e.tagMode=!1,i.removeClass("fa-toggle-on").addClass("fa-toggle-off"),t.hideTags(),e.tagFormDiv&&e.exitTagForm();var o=e.fotoalbum.container.find("img");o.css("cursor",""),o.off("click.newtag"),e.fotoalbum.container.find("div.right").show(),e.fotoalbum.container.find("div.left").show()}else e.tagMode=!0,i.addClass("fa-toggle-on").removeClass("fa-toggle-off"),e.duringTagMode()})),i.on("mouseenter",(function(){e.tagMode?i.addClass("fa-toggle-on").removeClass("fa-toggle-off"):i.removeClass("fa-toggle-on").addClass("fa-toggle-off")})),i.on("mouseout",(function(){return i.removeClass("fa-toggle-on").removeClass("fa-toggle-off").addClass("fa-smile-o")})),i.insertBefore(this.fotoalbum.container.find("div.icons .change-album")),this.fotoalbum.container.find(".minimalize-thumbnails.jgallery-btn").on("click",(function(){return e.moveTagDivs()}))}return t.showTags=function(){r()("div.fototag").addClass("showborder")},t.hideTags=function(){r()("div.fototag").removeClass("showborder")},t.prototype.getScreenPos=function(t){var o=this.fotoalbum.container.find("img.active"),e=o.parent(),a=o.width(),i=o.height(),n=(e.width()-a)/2,r=(e.height()-i)/2;return{size:(a+i)/200*t.size,x:t.x*a/100+n,y:t.y*i/100+r}},t.prototype.drawTag=function(t){var o=this,e=this.getScreenPos(t),a=r()('<div id="tag'+t.keyword+'" class="fototag" title="'+t.name+'"></div>').appendTo(this.fotoalbum.container);return a.css({height:e.size,left:e.x-e.size/2,top:e.y-e.size/2,width:e.size}),this.tagMode&&a.addClass("showborder"),a.data("tag",t),a.on("click.tag",(function(){r()("div.fototag.active").removeClass("active"),r()(this).addClass("active")})),a.contextMenu({menuSelected:function(){o.removeTag(a)},menuSelector:"#tagMenu"}),a},t.prototype.drawTags=function(t){var o=this;(r()("div.fototag").remove(),Array.isArray(t))&&(r.a.each(t,(function(t,e){o.drawTag(e)})),"fit"!==this.fotoalbum.container.find("div.zoom-container").attr("data-size")?r()("div.fototag").addClass("verborgen"):r()("div.fototag").removeClass("verborgen"))},t.prototype.loadTags=function(){var t=this;r()("div.fototag").remove();var o=this.fotoalbum.getUrl(),e=new FormData;e.append("foto",Object(s.a)(o)),i.a.post("/fotoalbum/gettags"+Object(s.b)(o),e).then((function(o){return t.drawTags(o.data)}))},t.prototype.removeTag=function(t){var o=this;if(confirm("Etiket verwijderen?")){var e=t.data("tag"),a=new FormData;a.append("refuuid",e.refuuid),a.append("keyword",e.keyword),i.a.post("/fotoalbum/removetag",a).then((function(t){return o.drawTags(t.data)}))}},t.prototype.moveTagDivs=function(){var t=this;r()("div.fototag").each((function(o,e){var a=r()(e).data("tag"),i=t.getScreenPos(a);r()(t).css({height:i.size,left:i.x-i.size/2,top:i.y-i.size/2,width:i.size})}))},t.prototype.drawTagForm=function(t,o){var e=this,a=this.getScreenPos(o);this.tagFormDiv=r()(t).appendTo(this.fotoalbum.container),this.tagFormDiv.css({left:a.x-a.size/2,position:"absolute",top:a.y+a.size,"z-index":1e4}),this.tagFormDiv.data("tagPosition",o),this.tagFormDiv.find("form").data("submitCallback",(function(t){e.tagFormDiv&&e.exitTagForm(),"object"==typeof t?e.drawTags(t):e.drawTagForm(t,o)})),setTimeout((function(){return e.tagFormDiv&&e.tagFormDiv.find('input[name="uid"]').trigger("focus")}))},t.prototype.moveTagForm=function(){if(this.tagFormDiv){var t=this.getScreenPos(this.tagFormDiv.data("tagPosition"));this.tagFormDiv.css({left:t.x-t.size/2,top:t.y+t.size})}},t.prototype.exitTagForm=function(){r()('div[id="tagNew"]').remove(),this.tagFormDiv&&this.tagFormDiv.remove(),this.tagFormDiv=null},t.prototype.addTag=function(t){var o=this,e=this.fotoalbum.getUrl(),a=new FormData;a.append("foto",Object(s.a)(e)),a.append("x",Math.round(t.x).toString()),a.append("y",Math.round(t.y).toString()),a.append("size",Math.round(t.size).toString()),i.a.post("/fotoalbum/addtag"+Object(s.b)(e),a).then((function(e){"object"==typeof e.data?o.drawTags(e.data):o.drawTagForm(e.data,t)}))},t.prototype.newTagStart=function(t){var o=this,e=this.fotoalbum.container.find("img.active"),a=t.target,i=r()(a).offset(),n=e.width(),s=e.height(),g={keyword:"New",name:"",size:7,x:100*(t.pageX-i.left)/n,y:100*(t.pageY-i.top)/s};this.tagFormDiv&&this.exitTagForm(),this.addTag(g);var d=this.drawTag(g);d.off("click.tag"),d.css("cursor","nw-resize"),r()(window).off("mouseup.newtag"),r()(window).on("mouseup.newtag",(function(){return r()(window).off("mousemove.newtag")})),d.on("mousedown.newtag",(function(t){var e=o.fotoalbum.container.find("img.active"),a=t.pageX,i=t.pageY;r()(window).on("mousemove.newtag",(function(t){g.size+=100*(t.pageX-a)/e.width(),g.size+=100*(t.pageY-i)/e.height(),a=t.pageX,i=t.pageY,g.size<1?g.size=1:g.size>99&&(g.size=99),o.tagFormDiv&&o.tagFormDiv.find('input[name="size"]').val(Math.round(g.size));var n=o.getScreenPos(g);d.css({height:n.size,left:n.x-n.size/2,top:n.y-n.size/2,width:n.size}),d.attr("data-size",g.size)}))}))},t.prototype.duringTagMode=function(){var o=this;"fit"!==this.fotoalbum.container.find("div.zoom-container").attr("data-size")&&alert("Je kunt niet inzoomen tijdens het etiketteren, dat werkt nog niet."),this.tagFormDiv&&this.exitTagForm(),t.showTags(),this.fotoalbum.container.find("div.right").hide(),this.fotoalbum.container.find("div.left").hide();var e=this.fotoalbum.container.find("img.active");e.css("cursor","crosshair"),e.off("click.newtag"),e.on("click",(function(t){return o.newTagStart(t)}))},t}()}}]);
//# sourceMappingURL=37.de76286b2e15f55a5a59.js.map