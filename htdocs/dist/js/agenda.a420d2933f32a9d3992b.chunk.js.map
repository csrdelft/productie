{"version":3,"sources":["webpack:///./js/page/agenda.ts"],"names":["fmt","date","format","calendarEl","document","getElementById","Error","jaar","maand","weergave","creator","dataset","defaultView","week","dag","agenda","editable","options","plugins","height","nowIndicator","locale","customButtons","nieuw","text","click","datum","calendar","getDate","begin_moment","eind_moment","bewerken","setOption","refetchEvents","setTimeout","button","querySelector","classList","toggle","eventDataTransform","event","header","left","center","right","defaultDate","Date","Number","firstDay","events","selectable","select","selectionInfo","start","end","eventClick","info","a","get","id","getFullYear","then","response","card","data","style","zIndex","position","closeButton","addEventListener","remove","body","append","init","el","placement","clickListener","e","contains","target","removeEventListener","eventDrop","async","dropInfo","post","eventResize","resizeInfo","addHandler","render","on"],"mappings":"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","file":"js/agenda.a420d2933f32a9d3992b.chunk.js","sourcesContent":["import { Calendar } from '@fullcalendar/core';\nimport nlLocale from '@fullcalendar/core/locales/nl';\nimport dayGridPlugin from '@fullcalendar/daygrid';\nimport interaction from '@fullcalendar/interaction';\nimport listPlugin from '@fullcalendar/list';\nimport timeGridPlugin from '@fullcalendar/timegrid';\nimport axios from 'axios';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport Popper from 'popper.js';\nimport ctx from '../ctx';\nimport { ajaxRequest } from '../lib/ajax';\nimport { domUpdate } from '../lib/domUpdate';\nimport { docReady, htmlParse } from '../lib/util';\ndocReady(() => {\n    const dateTimeFormat = 'YYYY-MM-DD HH:mm:ss';\n    const fmt = (date) => moment(date).format(dateTimeFormat);\n    const calendarEl = document.getElementById('agenda');\n    if (calendarEl == null) {\n        throw new Error('Agenda element niet gevonden');\n    }\n    const { jaar, maand, weergave, creator } = calendarEl.dataset;\n    if (jaar == null || maand == null || weergave == null || creator == null) {\n        throw new Error('Agenda opties niet gezet');\n    }\n    const defaultView = {\n        maand: 'dayGridMonth',\n        week: 'timeGridWeek',\n        dag: 'timeGridDay',\n        agenda: 'listMonth',\n    }[weergave];\n    let editable = false;\n    const options = {\n        plugins: [dayGridPlugin, timeGridPlugin, listPlugin, interaction],\n        height: 'auto',\n        nowIndicator: true,\n        defaultView,\n        locale: nlLocale,\n        customButtons: {\n            nieuw: {\n                text: 'Nieuw',\n                click: () => {\n                    const datum = fmt(calendar.getDate());\n                    ajaxRequest('POST', '/agenda/toevoegen', {\n                        begin_moment: datum,\n                        eind_moment: datum,\n                    }, null, domUpdate);\n                },\n            },\n            bewerken: {\n                text: 'Bewerken',\n                click() {\n                    editable = !editable;\n                    calendar.setOption('editable', editable);\n                    calendar.setOption('selectable', editable);\n                    calendar.refetchEvents();\n                    // De button wordt ververst door fullcalendar, zorg ervoor dat de laatste wordt gepakt.\n                    setTimeout(() => {\n                        const button = calendarEl.querySelector('.fc-bewerken-button');\n                        if (!button) {\n                            throw new Error(\"Geen bewerken knop gevonden\");\n                        }\n                        button.classList.toggle('fc-button-active', editable);\n                    });\n                },\n            },\n        },\n        eventDataTransform: (event) => {\n            if (event.editable === true) {\n                event.editable = editable;\n            }\n            return event;\n        },\n        header: {\n            left: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth',\n            center: 'title',\n            right: 'today prevYear,prev,next,nextYear',\n        },\n        defaultDate: new Date(Number(jaar), Number(maand) - 1),\n        firstDay: 0,\n        events: '/agenda/feed',\n        selectable: editable && creator === 'true',\n        select: (selectionInfo) => {\n            ajaxRequest('POST', '/agenda/toevoegen', {\n                begin_moment: fmt(selectionInfo.start),\n                eind_moment: fmt(selectionInfo.end),\n            }, null, domUpdate);\n        },\n        eventClick: (info) => {\n            const start = info.event.start;\n            if (!start) {\n                return;\n            }\n            axios.get(`/agenda/details/${info.event.id}?jaar=${(start.getFullYear())}`).then((response) => {\n                const card = htmlParse(response.data)[0];\n                card.style.zIndex = '100';\n                card.style.position = 'absolute';\n                const closeButton = card.querySelector('.close');\n                if (closeButton) {\n                    closeButton.addEventListener('click', () => {\n                        card.remove();\n                        return false;\n                    });\n                }\n                document.body.append(card);\n                ctx.init(card);\n                new Popper(info.el, card, { placement: 'bottom' });\n                // Na deze klik een event listener\n                setTimeout(() => {\n                    const clickListener = (e) => {\n                        if (!card.contains(e.target)) {\n                            card.remove();\n                            document.body.removeEventListener('click', clickListener);\n                        }\n                    };\n                    document.body.addEventListener('click', clickListener);\n                });\n            });\n        },\n        eventDrop: async (dropInfo) => {\n            const start = dropInfo.event.start;\n            const end = dropInfo.event.end;\n            if (!start || !end) {\n                throw new Error(\"Drop heeft geen start of end\");\n            }\n            await axios.post(`/agenda/verplaatsen/${dropInfo.event.id}`, {\n                begin_moment: fmt(start),\n                eind_moment: fmt(end),\n            });\n            calendar.refetchEvents();\n        },\n        eventResize: async (resizeInfo) => {\n            const start = resizeInfo.event.start;\n            const end = resizeInfo.event.end;\n            if (!start || !end) {\n                throw new Error(\"Resize heeft geen start of end\");\n            }\n            await axios.post(`/agenda/verplaatsen/${resizeInfo.event.id}`, {\n                begin_moment: fmt(start),\n                eind_moment: fmt(end),\n            });\n            calendar.refetchEvents();\n        },\n    };\n    ctx.addHandler('.ReloadAgenda', (el) => el.addEventListener('click', () => setTimeout(() => calendar.refetchEvents())));\n    // Creator krijgt nieuw knoppen\n    if (creator === 'true') {\n        const header = options.header;\n        header.right = 'bewerken,nieuw ' + header.right;\n    }\n    const calendar = new Calendar(calendarEl, options);\n    calendar.render();\n    $(document.body).on('modalClose', () => calendar.refetchEvents());\n});\n"],"sourceRoot":""}