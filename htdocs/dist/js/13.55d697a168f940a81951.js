(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{282:function(t,e,a){"use strict";a.r(e),a.d(e,"FotoAlbumTags",function(){return d});var o=a(0),g=a.n(o),n=a(4);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var a=0;a<e.length;a++){var o=e[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function s(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var d=function(){function o(t){var a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),s(this,"tagMode",!1),s(this,"tagFormDiv",null),(this.fotoalbum=t).on("afterLoadPhoto",function(){a.tagMode&&a.duringTagMode(),a.loadTags()}),window.addEventListener("keydown",function(t){46===t.keyCode?g()("div.fototag.active").each(function(t,e){a.removeTag(g()(e))}):27===t.keyCode&&(t.preventDefault(),a.tagMode&&(a.tagFormDiv?a.exitTagForm():a.moveTagDivs()))}),window.addEventListener("resize",function(){a.moveTagDivs(),a.tagMode?(a.duringTagMode(),a.tagFormDiv&&a.moveTagForm()):a.tagFormDiv&&a.exitTagForm()});g()("<li></li>").append('<a id="btnDelTag" class="dropdown-item" tabindex="-1"><span class="fa fa-user-times"></span> &nbsp; Etiket verwijderen</a>').appendTo("#tagMenu");var e=g()('<span class="fa fa-smile-o jgallery-btn jgallery-btn-small" tooltip="Leden etiketteren"></span>');e.on("click",function(){if(a.tagMode){a.tagMode=!1,e.removeClass("fa-toggle-on").addClass("fa-toggle-off"),o.hideTags(),a.tagFormDiv&&a.exitTagForm();var t=a.fotoalbum.container.find("img");t.css("cursor",""),t.off("click.newtag"),a.fotoalbum.container.find("div.right").show(),a.fotoalbum.container.find("div.left").show()}else a.tagMode=!0,e.addClass("fa-toggle-on").removeClass("fa-toggle-off"),a.duringTagMode()}),e.on("mouseenter",function(){a.tagMode?e.addClass("fa-toggle-on").removeClass("fa-toggle-off"):e.removeClass("fa-toggle-on").addClass("fa-toggle-off")}),e.on("mouseout",function(){return e.removeClass("fa-toggle-on").removeClass("fa-toggle-off").addClass("fa-smile-o")}),e.insertBefore(this.fotoalbum.container.find("div.icons .change-album")),this.fotoalbum.container.find(".minimalize-thumbnails.jgallery-btn").on("click",function(){return a.moveTagDivs()})}var t,e,a;return t=o,a=[{key:"showTags",value:function(){g()("div.fototag").addClass("showborder")}},{key:"hideTags",value:function(){g()("div.fototag").removeClass("showborder")}}],(e=[{key:"getScreenPos",value:function(t,e,a){var o=this.fotoalbum.container.find("img.active"),i=o.parent(),n=o.width(),r=o.height();return{x:t*n/100+(i.width()-n)/2,y:e*r/100+(i.height()-r)/2,size:(n+r)/200*a}}},{key:"drawTag",value:function(t){var e=this,a=this.getScreenPos(t.x,t.y,t.size),o=g()('<div id="tag'.concat(t.keyword,'" class="fototag" title="').concat(t.name,'"></div>')).appendTo(this.fotoalbum.container);return o.css({top:a.y-a.size/2,left:a.x-a.size/2,width:a.size,height:a.size}),this.tagMode&&o.addClass("showborder"),o.data("tag",t),o.on("click.tag",function(){g()("div.fototag.active").removeClass("active"),g()(this).addClass("active")}),o.contextMenu({menuSelector:"#tagMenu",menuSelected:function(){e.removeTag(o)}}),o}},{key:"drawTags",value:function(t){var a=this;(g()("div.fototag").remove(),Array.isArray(t))&&(g.a.each(t,function(t,e){a.drawTag(e)}),"fit"!==this.fotoalbum.container.find("div.zoom-container").attr("data-size")?g()("div.fototag").addClass("verborgen"):g()("div.fototag").removeClass("verborgen"))}},{key:"loadTags",value:function(){var e=this;g()("div.fototag").remove();var t=this.fotoalbum.getUrl();g.a.post("/fotoalbum/gettags"+Object(n.b)(t),{foto:Object(n.a)(t)},function(t){return e.drawTags(t)})}},{key:"removeTag",value:function(t){var e=this;if(confirm("Etiket verwijderen?")){var a=t.data("tag");g.a.post("/fotoalbum/removetag",{refuuid:a.refuuid,keyword:a.keyword},function(t){return e.drawTags(t)})}}},{key:"moveTagDivs",value:function(){var i=this;g()("div.fototag").each(function(t,e){var a=g()(e).data("tag"),o=i.getScreenPos(a.x,a.y,a.size);g()(i).css({top:o.y-o.size/2,left:o.x-o.size/2,width:o.size,height:o.size})})}},{key:"drawTagForm",value:function(t,e,a,o){var i=this,n=this.getScreenPos(e,a,o);this.tagFormDiv=g()(t).appendTo(this.fotoalbum.container),this.tagFormDiv.css({position:"absolute",top:n.y+n.size,left:n.x-n.size/2,"z-index":1e4}),this.tagFormDiv.attr("data-relY",a),this.tagFormDiv.attr("data-relX",e),this.tagFormDiv.attr("data-size",o),this.tagFormDiv.find("form").data("submitCallback",function(t){i.tagFormDiv&&i.exitTagForm(),"object"===r(t)?i.drawTags(t):i.drawTagForm(t,e,a,o)}),setTimeout(function(){return i.tagFormDiv.find('input[name="uid"]').trigger("focus")})}},{key:"moveTagForm",value:function(){if(this.tagFormDiv){var t=this.getScreenPos(this.tagFormDiv.attr("data-relX"),this.tagFormDiv.attr("data-relY"),this.tagFormDiv.attr("data-size"));this.tagFormDiv.css({top:t.y+t.size,left:t.x-t.size/2})}}},{key:"exitTagForm",value:function(){g()('div[id="tagNew"]').remove(),this.tagFormDiv.remove(),this.tagFormDiv=!1}},{key:"addTag",value:function(e,a,o){var i=this,t=this.fotoalbum.getUrl();g.a.post("/fotoalbum/addtag"+Object(n.b)(t),{foto:Object(n.a)(t),x:Math.round(e),y:Math.round(a),size:Math.round(o)},function(t){"object"===r(t)?i.drawTags(t):i.drawTagForm(t,e,a,o)})}},{key:"newTagStart",value:function(t){var n=this,e=this.fotoalbum.container.find("img.active"),a=g()(t.target).offset(),r={x:100*(t.pageX-a.left)/e.width(),y:100*(t.pageY-a.top)/e.height(),size:7,name:"",keyword:"New"};this.tagFormDiv&&this.exitTagForm(),this.addTag(r.x,r.y,r.size);var s=this.drawTag(r);s.off("click.tag"),s.css("cursor","nw-resize"),g()(window).off("mouseup.newtag"),g()(window).on("mouseup.newtag",function(){g()(window).off("mousemove.newtag")}),s.bind("mousedown.newtag",function(t){var a=n.fotoalbum.container.find("img.active"),o=t.pageX,i=t.pageY;g()(window).on("mousemove.newtag",function(t){r.size+=100*(t.pageX-o)/a.width(),r.size+=100*(t.pageY-i)/a.height(),o=t.pageX,i=t.pageY,r.size<1?r.size=1:99<r.size&&(r.size=99),n.tagFormDiv.find('input[name="size"]').val(Math.round(r.size));var e=n.getScreenPos(r.x,r.y,r.size);s.css({top:e.y-e.size/2,left:e.x-e.size/2,width:e.size,height:e.size}),s.attr("data-size",r.size)})})}},{key:"duringTagMode",value:function(){var e=this;"fit"!==this.fotoalbum.container.find("div.zoom-container").attr("data-size")&&alert("Je kunt niet inzoomen tijdens het etiketteren, dat werkt nog niet."),this.tagFormDiv&&this.exitTagForm(),o.showTags(),this.fotoalbum.container.find("div.right").hide(),this.fotoalbum.container.find("div.left").hide();var t=this.fotoalbum.container.find("img.active");t.css("cursor","crosshair"),t.unbind("click.newtag"),t.bind("click.newtag",function(t){return e.newTagStart(t)})}}])&&i(t.prototype,e),a&&i(t,a),o}()}}]);