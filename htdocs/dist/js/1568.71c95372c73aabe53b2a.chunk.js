"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1568],{1568:(e,t,i)=>{i.r(t),i.d(t,{default:()=>c});var s=i(1339),a=i.n(s),r=i(9856),o=i(3621),n=i(9624),g=i(6859),l=i.n(g),d=i(1364),h=i(4222);const c=e=>class extends e{constructor(e,t){super(e,t),this.tagMode=!1,this.root=t.root,this.tagContainer=(0,o.Z)('<div class="tag-container"></div>'),this.previewElement.appendChild(this.tagContainer);const i=(0,o.Z)('<i class="fas fa-face-grin" aria-hidden="true"></i>'),s=(0,o.Z)('<span class="j-gallery-icon"></span>',{children:[i]});(0,n.Z)(s,{style:{color:t.backgroundColor,background:t.textColor,transform:"translateY(-8px)"},content:"Leden etiketteren"}),this.appendControlsElements([s]),window.addEventListener("keydown",(e=>{"Delete"===e.key?this.activeTag&&this.removeTag(this.activeTag):"Escape"===e.key&&(e.preventDefault(),this.tagMode&&(this.tagFormDiv?this.exitTagForm():this.moveTagDivs()))})),window.addEventListener("resize",(()=>{this.moveTagDivs(),this.tagMode?(this.duringTagMode(),this.tagFormDiv&&this.moveTagForm()):this.tagFormDiv&&this.exitTagForm()})),s.addEventListener("click",(()=>{this.tagMode?(this.tagMode=!1,i.classList.replace("fa-toggle-on","fa-toggle-off"),this.hideTags(),this.tagFormDiv&&this.exitTagForm(),this.imageElement.style.cursor="",this.left.style.display="block",this.right.style.display="block"):(this.tagMode=!0,i.classList.replace("fa-toggle-off","fa-toggle-on"),this.duringTagMode())})),s.addEventListener("mouseenter",(()=>{this.tagMode?i.classList.replace("fa-toggle-off","fa-toggle-on"):i.classList.replace("fa-toggle-on","fa-toggle-off")})),s.addEventListener("mouseleave",(()=>{i.classList.remove("fa-toggle-on","fa-toggle-off"),i.classList.add("fa-smile")}));const a=(0,h.Ys)(".j-gallery-screen-icon",this.getElement());if(!a)throw new Error("Geen screenIcon gevonden");a.addEventListener("click",(()=>{this.preview.size!==r.$.contain?this.tagContainer.querySelectorAll(".fototag").forEach((e=>e.classList.add("verborgen"))):this.tagContainer.querySelectorAll(".fototag").forEach((e=>e.classList.remove("verborgen")))}))}get imageElement(){try{return(0,h.Ys)(".j-gallery-preview-content",this.previewElement)}catch(e){return null}}get left(){return(0,h.Ys)(".j-gallery-left",this.previewElement)}get right(){return(0,h.Ys)(".j-gallery-right",this.previewElement)}goToItem(e){return this.currentItem=e,super.goToItem(e).then((()=>{this.tagMode&&this.duringTagMode(),this.loadTags()}))}moveTagDivs(){this.tagContainer.querySelectorAll(".fototag").forEach((e=>{var t;return this.moveTag(e,JSON.parse(null!==(t=e.dataset.tag)&&void 0!==t?t:"{}"))}))}moveTag(e,t){const i=this.getScreenPos(t);e.style.height=i.size+"px",e.style.left=i.x-i.size/2+"px",e.style.top=i.y-i.size/2+"px",e.style.width=i.size+"px"}moveTagForm(){var e;if(!this.tagFormDiv)return;const t=this.getScreenPos(JSON.parse(null!==(e=this.tagFormDiv.dataset.tagPosition)&&void 0!==e?e:"{}"));this.tagFormDiv.style.left=t.x-t.size/2+"px",this.tagFormDiv.style.top=t.y+t.size+"px"}getUrl(){return this.currentItem.fullUrl.replace(this.root,"")}loadTags(){this.tagContainer.innerHTML="";const e=this.getUrl(),t=new FormData;t.append("foto",(0,d.EZ)(decodeURI(e))),a().post("/fotoalbum/gettags"+(0,d.XX)(e),t).then((e=>this.drawTags(e.data)))}drawTags(e){if(this.tagContainer.innerHTML="",Array.isArray(e))for(const t of e)this.drawTag(t)}getScreenPos(e){if(null==this.imageElement)return{size:0,x:0,y:0};const t=this.imageElement.parentElement;if(!t)throw new Error("ImageElement niet in DOM");const i=this.imageElement.clientWidth,s=this.imageElement.clientHeight,a=(t.clientWidth-i)/2,r=(t.clientHeight-s)/2;return{size:(i+s)/200*e.size,x:e.x*i/100+a,y:e.y*s/100+r}}removeTag(e){var t;if(confirm("Etiket verwijderen?")){const i=JSON.parse(null!==(t=e.dataset.tag)&&void 0!==t?t:"{}"),s=new FormData;s.append("refuuid",i.refuuid),s.append("keyword",i.keyword),a().post("/fotoalbum/removetag",s).then((e=>this.drawTags(e.data)))}}drawTag(e){const t=this.getScreenPos(e),i=(0,o.Z)(`<div id="${e.keyword}" class="fototag" title="${e.name}"></div>`,{style:{height:t.size+"px",left:t.x-t.size/2+"px",top:t.y-t.size/2+"px",width:t.size+"px"}});this.tagContainer.appendChild(i),this.tagMode&&i.classList.add("showborder"),i.dataset.tag=JSON.stringify(e),i.addEventListener("click",(()=>{this.activeTag&&this.activeTag.classList.remove("active"),this.activeTag=i,i.classList.add("active")}));const s=(0,o.Z)('<div id="tagMenu" class="dropdown-menu" role="menu"></div>',{style:{position:"fixed",top:"0",left:"0"}}),a=(0,o.Z)('<a id="btnDelTag" tabindex="-1" class="dropdown-item"><i class="fas fa-user-xmark" aria-hidden="true"></i>&nbsp;Etiket verwijderen</a>');return s.appendChild(a),i.appendChild(s),a.addEventListener("click",(()=>this.removeTag(i))),i.addEventListener("contextmenu",(e=>{e.preventDefault(),s.style.display="block",s.style.transform=`translate(${e.clientX}px, ${e.clientY}px)`}),!0),document.addEventListener("mouseup",(()=>{s.style.display="none"})),this.preview.size!==r.$.contain?i.classList.add("verborgen"):i.classList.remove("verborgen"),i}showTags(){this.tagContainer.querySelectorAll(".fototag").forEach((e=>e.classList.add("showborder")))}hideTags(){this.tagContainer.querySelectorAll(".fototag").forEach((e=>e.classList.remove("showborder")))}exitTagForm(){this.tagFormDiv&&this.tagFormDiv.remove(),this.tagFormDiv=null}duringTagMode(){this.preview.size!==r.$.contain&&alert("Je kunt niet inzoomen tijdens het etiketteren, dat werkt nog niet."),this.tagFormDiv&&this.exitTagForm(),this.showTags();const e=this.previewElement.querySelector(".j-gallery-left"),t=this.previewElement.querySelector(".j-gallery-right");e.style.display="none",t.style.display="none";const i=this.imageElement;i.style.cursor="crosshair",i.removeEventListener("click",this.newTagStart.bind(this)),i.addEventListener("click",this.newTagStart.bind(this))}addTag(e){const t=this.getUrl(),i=new FormData;i.append("foto",(0,d.EZ)(decodeURI(t))),i.append("x",Math.round(e.x).toString()),i.append("y",Math.round(e.y).toString()),i.append("size",Math.round(e.size).toString()),a().post("/fotoalbum/addtag"+(0,d.XX)(t),i).then((t=>{"object"==typeof t.data?this.drawTags(t.data):this.drawTagForm(t.data,e)}))}drawTagForm(e,t){const i=this.getScreenPos(t);this.tagFormDiv=(0,o.Z)(e,{style:{left:i.x-i.size/2+"px",position:"absolute",top:i.y+i.size/2+"px",zIndex:"10000"}}),this.getElement().appendChild(this.tagFormDiv);const s=Array.from(this.tagFormDiv.querySelectorAll("script"));for(const e of s)l().globalEval(e.innerText);this.tagFormDiv.dataset.tagPosition=JSON.stringify(t);const a=this.tagFormDiv.querySelector("form");if(!a)throw new Error("tag div bevat geen form");l()(a).data("submitCallback",(e=>{this.tagFormDiv&&this.exitTagForm(),"object"==typeof e?this.drawTags(e):this.drawTagForm(e,t)})),setTimeout((()=>{if(this.tagFormDiv){const e=this.tagFormDiv.querySelector('input[name="uid"]');if(!e)throw new Error("tagFormDiv bevat input met name uid");e.dispatchEvent(new Event("focus"))}}))}newTagStart(e){const t=this.imageElement,i=e.target,s=l()(i).offset();if(!s)throw new Error("Tag target heeft geen offset");const a=t.clientWidth,r=t.clientHeight,o={keyword:"New",name:"",size:7,x:100*(e.pageX-s.left)/a,y:100*(e.pageY-s.top)/r};this.tagFormDiv&&this.exitTagForm(),this.addTag(o);const n=this.drawTag(o);n.removeEventListener("click.tag",(()=>({}))),n.style.cursor="nw-resize";const g=this.imageElement;let d=0,h=0;const c=e=>{if(o.size+=100*(e.pageX-d)/g.clientWidth,o.size+=100*(e.pageY-h)/g.clientHeight,d=e.pageX,h=e.pageY,o.size<1?o.size=1:o.size>99&&(o.size=99),this.tagFormDiv){this.tagFormDiv.querySelector('input[name="size"]').value=String(Math.round(o.size))}this.moveTag(n,o),n.dataset.size=String(o.size)};document.addEventListener("mouseup",(()=>document.removeEventListener("mousemove",c))),n.addEventListener("mousedown",(e=>{d=e.pageX,h=e.pageY,document.addEventListener("mousemove",c)}))}}}}]);
//# sourceMappingURL=1568.71c95372c73aabe53b2a.chunk.js.map