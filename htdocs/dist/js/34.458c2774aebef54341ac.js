(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{310:function(t,o,e){"use strict";e.r(o),e.d(o,"FotoAlbumTags",function(){return s});var a=e(10),n=e.n(a),i=e(0),d=e.n(i),r=e(4),s=function(){function i(t){var e=this;this.tagMode=!1,(this.fotoalbum=t).on("afterLoadPhoto",function(){e.tagMode&&e.duringTagMode(),e.loadTags()}),window.addEventListener("keydown",function(t){"Delete"===t.key?d()("div.fototag.active").each(function(t,o){e.removeTag(d()(o))}):"Escape"===t.key&&(t.preventDefault(),e.tagMode&&(e.tagFormDiv?e.exitTagForm():e.moveTagDivs()))}),window.addEventListener("resize",function(){e.moveTagDivs(),e.tagMode?(e.duringTagMode(),e.tagFormDiv&&e.moveTagForm()):e.tagFormDiv&&e.exitTagForm()});var o=this.fotoalbum.createCMBtn("btnDelTag","Etiket verwijderen","user-times");d()("<li></li>").append(o).appendTo("#tagMenu");var a=d()('<span class="fa fa-smile-o jgallery-btn jgallery-btn-small" tooltip="Leden etiketteren"></span>');a.on("click",function(){if(e.tagMode){e.tagMode=!1,a.removeClass("fa-toggle-on").addClass("fa-toggle-off"),i.hideTags(),e.tagFormDiv&&e.exitTagForm();var t=e.fotoalbum.container.find("img");t.css("cursor",""),t.off("click.newtag"),e.fotoalbum.container.find("div.right").show(),e.fotoalbum.container.find("div.left").show()}else e.tagMode=!0,a.addClass("fa-toggle-on").removeClass("fa-toggle-off"),e.duringTagMode()}),a.on("mouseenter",function(){e.tagMode?a.addClass("fa-toggle-on").removeClass("fa-toggle-off"):a.removeClass("fa-toggle-on").addClass("fa-toggle-off")}),a.on("mouseout",function(){return a.removeClass("fa-toggle-on").removeClass("fa-toggle-off").addClass("fa-smile-o")}),a.insertBefore(this.fotoalbum.container.find("div.icons .change-album")),this.fotoalbum.container.find(".minimalize-thumbnails.jgallery-btn").on("click",function(){return e.moveTagDivs()})}return i.showTags=function(){d()("div.fototag").addClass("showborder")},i.hideTags=function(){d()("div.fototag").removeClass("showborder")},i.prototype.getScreenPos=function(t){var o=this.fotoalbum.container.find("img.active"),e=o.parent(),a=o.width(),i=o.height(),n=(e.width()-a)/2,r=(e.height()-i)/2;return{size:(a+i)/200*t.size,x:t.x*a/100+n,y:t.y*i/100+r}},i.prototype.drawTag=function(t){var o=this,e=this.getScreenPos(t),a=d()('<div id="tag'+t.keyword+'" class="fototag" title="'+t.name+'"></div>').appendTo(this.fotoalbum.container);return a.css({height:e.size,left:e.x-e.size/2,top:e.y-e.size/2,width:e.size}),this.tagMode&&a.addClass("showborder"),a.data("tag",t),a.on("click.tag",function(){d()("div.fototag.active").removeClass("active"),d()(this).addClass("active")}),a.contextMenu({menuSelected:function(){o.removeTag(a)},menuSelector:"#tagMenu"}),a},i.prototype.drawTags=function(t){var e=this;(d()("div.fototag").remove(),Array.isArray(t))&&(d.a.each(t,function(t,o){e.drawTag(o)}),"fit"!==this.fotoalbum.container.find("div.zoom-container").attr("data-size")?d()("div.fototag").addClass("verborgen"):d()("div.fototag").removeClass("verborgen"))},i.prototype.loadTags=function(){var o=this;d()("div.fototag").remove();var t=this.fotoalbum.getUrl(),e=new FormData;e.append("foto",Object(r.a)(t)),n.a.post("/fotoalbum/gettags"+Object(r.b)(t),e).then(function(t){return o.drawTags(t.data)})},i.prototype.removeTag=function(t){var o=this;if(confirm("Etiket verwijderen?")){var e=t.data("tag"),a=new FormData;a.append("refuuid",e.refuuid),a.append("keyword",e.keyword),n.a.post("/fotoalbum/removetag",a).then(function(t){return o.drawTags(t.data)})}},i.prototype.moveTagDivs=function(){var i=this;d()("div.fototag").each(function(t,o){var e=d()(o).data("tag"),a=i.getScreenPos(e);d()(i).css({height:a.size,left:a.x-a.size/2,top:a.y-a.size/2,width:a.size})})},i.prototype.drawTagForm=function(t,o){var e=this,a=this.getScreenPos(o);this.tagFormDiv=d()(t).appendTo(this.fotoalbum.container),this.tagFormDiv.css({left:a.x-a.size/2,position:"absolute",top:a.y+a.size,"z-index":1e4}),this.tagFormDiv.data("tagPosition",o),this.tagFormDiv.find("form").data("submitCallback",function(t){e.tagFormDiv&&e.exitTagForm(),"object"==typeof t?e.drawTags(t):e.drawTagForm(t,o)}),setTimeout(function(){return e.tagFormDiv&&e.tagFormDiv.find('input[name="uid"]').trigger("focus")})},i.prototype.moveTagForm=function(){if(this.tagFormDiv){var t=this.getScreenPos(this.tagFormDiv.data("tagPosition"));this.tagFormDiv.css({left:t.x-t.size/2,top:t.y+t.size})}},i.prototype.exitTagForm=function(){d()('div[id="tagNew"]').remove(),this.tagFormDiv&&this.tagFormDiv.remove(),this.tagFormDiv=null},i.prototype.addTag=function(o){var e=this,t=this.fotoalbum.getUrl(),a=new FormData;a.append("foto",Object(r.a)(t)),a.append("x",Math.round(o.x).toString()),a.append("y",Math.round(o.y).toString()),a.append("size",Math.round(o.size).toString()),n.a.post("/fotoalbum/addtag"+Object(r.b)(t),a).then(function(t){"object"==typeof t.data?e.drawTags(t.data):e.drawTagForm(t.data,o)})},i.prototype.newTagStart=function(t){var n=this,o=this.fotoalbum.container.find("img.active"),e=t.target,a=d()(e).offset(),i=o.width(),r=o.height(),s={keyword:"New",name:"",size:7,x:100*(t.pageX-a.left)/i,y:100*(t.pageY-a.top)/r};this.tagFormDiv&&this.exitTagForm(),this.addTag(s);var g=this.drawTag(s);g.off("click.tag"),g.css("cursor","nw-resize"),d()(window).off("mouseup.newtag"),d()(window).on("mouseup.newtag",function(){return d()(window).off("mousemove.newtag")}),g.on("mousedown.newtag",function(t){var e=n.fotoalbum.container.find("img.active"),a=t.pageX,i=t.pageY;d()(window).on("mousemove.newtag",function(t){s.size+=100*(t.pageX-a)/e.width(),s.size+=100*(t.pageY-i)/e.height(),a=t.pageX,i=t.pageY,s.size<1?s.size=1:99<s.size&&(s.size=99),n.tagFormDiv&&n.tagFormDiv.find('input[name="size"]').val(Math.round(s.size));var o=n.getScreenPos(s);g.css({height:o.size,left:o.x-o.size/2,top:o.y-o.size/2,width:o.size}),g.attr("data-size",s.size)})})},i.prototype.duringTagMode=function(){var o=this;"fit"!==this.fotoalbum.container.find("div.zoom-container").attr("data-size")&&alert("Je kunt niet inzoomen tijdens het etiketteren, dat werkt nog niet."),this.tagFormDiv&&this.exitTagForm(),i.showTags(),this.fotoalbum.container.find("div.right").hide(),this.fotoalbum.container.find("div.left").hide();var t=this.fotoalbum.container.find("img.active");t.css("cursor","crosshair"),t.off("click.newtag"),t.on("click",function(t){return o.newTagStart(t)})},i}()}}]);